<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UM General Atmosphere: /home/wilfred/PhD/UM/src/atmosphere/UKCA/asad_ftoy.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="unified_model_logo_2.jpeg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UM General Atmosphere
   &#160;<span id="projectnumber">8.6</span>
   </div>
   <div id="projectbrief">UK Met Offices Unified Model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.xhtml">src</a></li><li class="navelem"><a class="el" href="dir_1df14ea1ac826f73bc3062fa8a76e0c2.xhtml">atmosphere</a></li><li class="navelem"><a class="el" href="dir_3b087d695daa154bfcb7242bcfd0fbd3.xhtml">UKCA</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">asad_ftoy.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="asad__ftoy_8f90_source.xhtml">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aec702c6eac425c713c6d64baf7932890"><td class="memItemLeft" align="right" valign="top"><a class="el" href="interfacesubroutine.xhtml">subroutine</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asad__ftoy_8f90.xhtml#aec702c6eac425c713c6d64baf7932890">asad_ftoy</a> (ofirst, iter, n_points)</td></tr>
<tr class="memdesc:aec702c6eac425c713c6d64baf7932890"><td class="mdescLeft">&#160;</td><td class="mdescRight">(c) [University of Cambridge] [2008]. All rights reserved.  <a href="#aec702c6eac425c713c6d64baf7932890">More...</a><br /></td></tr>
<tr class="separator:aec702c6eac425c713c6d64baf7932890"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aec702c6eac425c713c6d64baf7932890"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec702c6eac425c713c6d64baf7932890">&#9670;&nbsp;</a></span>asad_ftoy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="interfacesubroutine.xhtml">subroutine</a> asad_ftoy </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>ofirst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="eg__hash_8c.xhtml#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>, intent(inout)&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="eg__hash_8c.xhtml#a3b6ee100a473e8866bcea6d1fc4041d9">integer</a>, intent(in)&#160;</td>
          <td class="paramname"><em>n_points</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(c) [University of Cambridge] [2008]. All rights reserved. </p>
<p>(c) [University of Cambridge] [2008]. All rights reserved. This routine has been licensed to the Met Office for use and distribution under the UKCA collaboration agreement, subject!&gt; to the terms and conditions set out therein. [Met Office Ref SC138]!&gt; Purpose: Sets the species concentrations prior to calculating the chemistry tendencies. This includes partitioning families. Part of the UKCA model, a community model supported by The Met Office and NCAS, with components provided initially by The University of Cambridge, University of Leeds and The Met. Office. See www.ukca.ac.uk Called from ASAD_CDRIVE and ASAD_IMPACT This file belongs in section: UKCA Interface !&gt; Must always be called before diffun. Arguments: ofirst Should be .true. if this is first call to ftoy during the current model/dynamical timestep. iter Maximum number of iterations. Method !&gt; After initialisation, the family member concentrations and steady state species are iterated until they converge to a solution. Firstly, the ratios for family members and steady state concentrations for the non-family steady state species are computed. Then, the family member concentrations are evaluated using the ratios. A convergence test is performed for all species at all spatial points. If convergence is not achieved for any species at any point, the iterations continue until either convergence is achieved or the maximum number of iterations is reached. In/out species are determined to be in or out of the family on the first call to ftoy during a model timestep according to their lifetime compared with some threshold value. If the species is found to be 'in' the family, its concentration is added to the family f concentration before the sum is partitioned amongst the members. The in/out test is performed at all spatial points. This species then stays in the family for the rest of the call to cdrive. The species is subtracted from the family at the end of cdrive. If the species self reacts, the steady state concentration is found by solving a quadratic. Otherwise, it is simply found by dividing the production rate by the loss rate. The self reacting term, qa, has previously been calculated in fyself. Note qa is +ve. The ratio of a minor family member to the major member is determined by dividing the steady state concentration of the minor member from fystst by the family member concentration: R1m = Y1/Ym, R2m = Y2/Ym .... The ratio of the major member to the family as a whole is determined from the minor member ratios weighted by the number of odd atoms in each species: Rmf = 1 / ( Nm + N1*R1m +N2*R2m + .....) The concentrations are then found from: Ym = Rmf*Z, Y1 = R1m*Ym, Y2 = R2m*Ym, ..... where Z is the remaining family concentration after the appropriate in/out species concentrations have been subtracted. Although ASAD supports the user of deposition and emissions, we do not include these terms in the calculation of the ratios even though they represent a loss or production from or in to the family. This is because, family members are assumed to be in steady state, generally taken to be a 'chemical' steady state, one that is controlled by the concentrations of other species. If for instance, a strong emission source was present, for NO, this would give a high bogus value for the NO ratio, which would be wrong because by assuming steady state we assume that the extra NO has already reacted to reach a new equilibrium with its family members. Externals !&gt; fyinit Sets initial species concentrations. fyself Calculates self-reacting terms. fyfixr Calculates family member concentrations using ratios computed on a previous call. fystst Calculates concentration of a species in steady state. prls Calculates production &amp; loss terms. Local variables !&gt; ifam Index of family to which species belongs. imaj Index of major member of family to which species belongs. itr Index of model tracer to which species corresponds. gconv .true. if convergence has been achieved. gonce .true. for only the first call to this routine. zthresh Threshold value of loss rate to determine whether in/out species are in or out of family. zy Value of y on previous iteration. ilstmin List of species which are either steady state, 'SS', family members ('FM' and 'FT') but EXCLUDING major family species. </p>

<p class="definition">Definition at line <a class="el" href="asad__ftoy_8f90_source.xhtml#l00120">120</a> of file <a class="el" href="asad__ftoy_8f90_source.xhtml">asad_ftoy.f90</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="asad__ftoy_8f90_aec702c6eac425c713c6d64baf7932890_cgraph.svg" width="100%" height="508"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="asad__ftoy_8f90_aec702c6eac425c713c6d64baf7932890_icgraph.svg" width="100%" height="460"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
