<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UM General Atmosphere: /home/wilfred/PhD/UM/src/atmosphere/convection/pevp_bcb-5a.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="unified_model_logo_2.jpeg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UM General Atmosphere
   &#160;<span id="projectnumber">8.6</span>
   </div>
   <div id="projectbrief">UK Met Offices Unified Model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.xhtml">src</a></li><li class="navelem"><a class="el" href="dir_1df14ea1ac826f73bc3062fa8a76e0c2.xhtml">atmosphere</a></li><li class="navelem"><a class="el" href="dir_c7cc3e4dc8dce4a958919661145604f9.xhtml">convection</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">pevp_bcb-5a.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="pevp__bcb-5a_8f90.xhtml">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">SUBROUTINE </span><a class="code" href="pevp__bcb-5a_8f90.xhtml#a8e21b919ee020fc23b978f8fe834452f" title="Evaporate rain below cloud base if no downdraught. ">pevp_bcb</a> (npnts,k,iccb,th,pk,q,qse,delp,rain,snow,         &amp;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                     dthbydt,dqbydt,exk,timestep,cca)</div><div class="line"><a name="l00008"></a><span class="lineno"><a class="line" href="pevp__bcb-5a_8f90.xhtml#a8e21b919ee020fc23b978f8fe834452f">    8</a></span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keywordtype">USE </span><a class="code" href="namespacecv__param__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">cv_param_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacecv__param__mod.xhtml#a1bb82e7a0904d7225288c17e2c2ad0f2">cldarea</a></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">USE </span>earth_constants_mod<span class="keywordtype">, ONLY</span>: g</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keywordtype">USE </span>atmos_constants_mod<span class="keywordtype">, ONLY</span>: r, cp</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keywordtype">USE </span>water_constants_mod<span class="keywordtype">, ONLY</span>: lc, lf</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keywordtype">USE </span>yomhook<span class="keywordtype">, ONLY</span>: lhook, dr_hook</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keywordtype">USE </span>parkind1<span class="keywordtype">, ONLY</span>: jprb, jpim</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordtype">IMPLICIT NONE</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">! Description:  Evaporate rain below cloud base if no downdraught.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;-</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: &amp;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  npnts                &amp; <span class="comment">! Vector length</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; ,k                      <span class="comment">! present model layer</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: &amp;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  iccb(npnts)            <span class="comment">! convective cloud base layer   </span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(IN)</span> ::    &amp;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  th(npnts)            &amp; <span class="comment">! Potential temperature (K)</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; ,pk(npnts)            &amp; <span class="comment">! Pressure (Pa)</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; ,q(npnts)             &amp; <span class="comment">! Mixing ratio (kg/kg)</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; ,qse(npnts)           &amp; <span class="comment">! Environmental qsat Mixing ratio (kg/kg)</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; ,delp(npnts)          &amp; <span class="comment">! Change in pressure across layer k-1 (Pa)</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; ,exk(npnts)           &amp; <span class="comment">! Exner ratio of layer k</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; ,timestep             &amp; <span class="comment">! Convection timestep (s)</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; ,cca(npnts)             <span class="comment">! Convective cloud amount</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::   &amp;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  rain(npnts)            &amp; <span class="comment">! IN  Amount of falling rain (kg/m**2/s)</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                           <span class="comment">! OUT Updated amount of falling rain</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; ,snow(npnts)            &amp; <span class="comment">! IN  Amount of falling snow (kg/m**2/s)</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                           <span class="comment">! OUT Updated amount of falling snow</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; ,dthbydt(npnts)         &amp; <span class="comment">! IN  Increment to model potential temperature</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                           <span class="comment">! OUT Updated Increment to model potential</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                           <span class="comment">!     temperature (K/s)</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; ,dqbydt(npnts)            <span class="comment">! IN  Increment to model mixing ratio (kg/kg/s)</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                           <span class="comment">! OUT Updated Increment to model mixing ratio</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                           <span class="comment">!     after evaporation below cloud base.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keywordtype">INTEGER</span> ::        &amp;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  i                 <span class="comment">! loop counter</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keywordtype">LOGICAL</span> ::        &amp;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  bevap(npnts)          &amp; <span class="comment">! Mask for those points where evaporation occurs</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; ,l_rates_adjusted      &amp; <span class="comment">! True if evaporation / sublimation rates have</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                          <span class="comment">! been adjusted to give saturation ,full_evap_rain(npnts) &amp; ! True if full rain evap in evp ,full_evap_snow(npnts)   ! True if full snow evap in evp</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">REAL</span> ::               &amp;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  t(npnts)            &amp; <span class="comment">! Model temperature (K)</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; ,evap_rain(npnts)    &amp; <span class="comment">! Amount of evaporation of rain</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; ,sub_snow(npnts)     &amp; <span class="comment">! Amount of snow sublimation</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; ,qsate(npnts)        &amp; <span class="comment">! Saturation mixing ratio in environment (kg/kg)</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; ,delq(npnts)         &amp; <span class="comment">! Change in mixing ratio across layer k  (kg/kg)</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; ,ths(npnts)          &amp; <span class="comment">! Saturated parcel potential temperature (K)</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; ,qs(npnts)           &amp; <span class="comment">! Saturated parcel parcel mixing ratio (kg/kg)</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; ,dthbydt_evp(npnts)  &amp; <span class="comment">! Increment to potential temperature due to                        ! evaporation (K)</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; ,dqbydt_evp(npnts)   &amp; <span class="comment">! Increment to mixing ratio due to                        ! evaporation (kg/kg)</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; ,dthbydt_sat(npnts)  &amp; <span class="comment">! Increment to potential temperature due to                        ! saturation (K)</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; ,factor(npnts)       &amp; <span class="comment">! dthbydt_sat/dthbydt_evp</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; ,rho(npnts)            <span class="comment">! Density of air in parcel</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keywordtype">REAL</span> ::               &amp;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  cloud_fraction      &amp; <span class="comment">! cca*cldarea</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; ,rtimestep             <span class="comment">! 1/timestep</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">INTEGER(KIND=jpim)</span>, <span class="keywordtype">PARAMETER</span> :: zhook_in  = 0</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keywordtype">INTEGER(KIND=jpim)</span>, <span class="keywordtype">PARAMETER</span> :: zhook_out = 1</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keywordtype">REAL(KIND=jprb)</span>               :: zhook_handle</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;PEVP_BCB&#39;</span>,zhook_in,zhook_handle)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keywordflow">DO</span> i=1,npnts</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  t(i) = th(i)*exk(i)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  bevap(i) = .false.</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordflow">END DO</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keywordflow">DO</span> i=1,npnts</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">IF</span> (k  &lt;   iccb(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    delq(i) = qse(i)-q(i)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;       <span class="comment">! Check if evaporation possible</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   </div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">IF</span> ((rain(i) &gt;  0.0 .OR. snow(i) &gt;  0.0) .AND.                 &amp;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        delq(i)  &gt;   0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      bevap(i) = .true.</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      rho(i) = pk(i) / (r*t(i))</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordflow">    END IF</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordflow">  END IF</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordflow">END DO</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">! Calculate evaporation</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">! DEPENDS ON: evp</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keyword">CALL </span><a class="code" href="evp-evp3a_8f90.xhtml#a1f5f8c5d680d3475f55a0e4d9037eae0" title="Calculates the evaporation of precipitation. ">evp</a> (npnts,1,bevap,<a class="code" href="namespacecv__param__mod.xhtml#a1bb82e7a0904d7225288c17e2c2ad0f2">cldarea</a>,rain,t,cca,rho,delq,delp,      &amp;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            pk,evap_rain,full_evap_rain)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">! DEPENDS ON: evp</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">CALL </span><a class="code" href="evp-evp3a_8f90.xhtml#a1f5f8c5d680d3475f55a0e4d9037eae0" title="Calculates the evaporation of precipitation. ">evp</a> (npnts,2,bevap,<a class="code" href="namespacecv__param__mod.xhtml#a1bb82e7a0904d7225288c17e2c2ad0f2">cldarea</a>,snow,t,cca,rho,delq,delp,      &amp;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            pk,sub_snow,full_evap_snow)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">! Calculate temperature and mixing ratio if layer brought to saturation</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">! by evaporation and sublimation</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">! DEPENDS ON: satcal</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">CALL </span><a class="code" href="satcal-5a_8f90.xhtml#a47ac06b51422732dd6027cd7c3fbfc69" title="Calculate saturated temperature. ">satcal</a>(npnts,k,t,th,pk,exk,q,th,qse,qs,ths)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;rtimestep = 1.0/timestep</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordflow">DO</span> i=1,npnts</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">IF</span> (bevap(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    dthbydt_evp(i) = -((lc*evap_rain(i))+((lc+lf)*sub_snow(i)))*g/       &amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                       (cp*exk(i)*delp(i))</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    dqbydt_evp(i)  = (evap_rain(i)+sub_snow(i))*g/delp(i)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    dthbydt_sat(i) = (ths(i)-th(i))*rtimestep</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    l_rates_adjusted = .false.</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">IF</span> (dthbydt_evp(i) &lt;  dthbydt_sat(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">! Adjust evaporation and sublimation rates to give saturation</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         l_rates_adjusted = .true.</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      factor(i) = dthbydt_sat(i)/dthbydt_evp(i)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      dthbydt_evp(i) = dthbydt_sat(i)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      dqbydt_evp(i) = dqbydt_evp(i)*factor(i)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      evap_rain(i) = evap_rain(i)*factor(i)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      sub_snow(i) = sub_snow(i)*factor(i)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordflow">    END IF</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">! Update increments and rainfall and adjust back to gridbox means</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;       cloud_fraction = cca(i)*<a class="code" href="namespacecv__param__mod.xhtml#a1bb82e7a0904d7225288c17e2c2ad0f2">cldarea</a></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    dthbydt(i) = dthbydt(i)+dthbydt_evp(i)*cloud_fraction</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    dqbydt(i)  = dqbydt(i) +dqbydt_evp(i)*cloud_fraction</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    rain(i) = rain(i)-evap_rain(i)*cloud_fraction</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    snow(i) = snow(i)-sub_snow(i)*cloud_fraction</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">! If the call to evp has produced an evaporation rate that evaporates! all the precipitation, and there was no adjustment of the rate to! account for saturation, logic dictates that the precipitation rate! should now be exactly zero. However, because of rounding effects it is! possible to end up with slightly non-zero rates. To get around this,! we directly reset to zero:    IF (.NOT.l_rates_adjusted) THEN      IF (full_evap_rain(i)) rain(i) = 0.0      IF (full_evap_snow(i)) snow(i) = 0.0    END IF</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keywordflow">  END IF</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keywordflow">END DO</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;PEVP_BCB&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keywordflow">RETURN</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">END SUBROUTINE </span><a class="code" href="pevp__bcb-5a_8f90.xhtml#a8e21b919ee020fc23b978f8fe834452f" title="Evaporate rain below cloud base if no downdraught. ">pevp_bcb</a></div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
