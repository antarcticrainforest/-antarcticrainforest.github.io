<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UM General Atmosphere: /home/wilfred/PhD/UM/src/atmosphere/UKCA/ukca_surfddr.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="unified_model_logo_2.jpeg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UM General Atmosphere
   &#160;<span id="projectnumber">8.6</span>
   </div>
   <div id="projectbrief">UK Met Offices Unified Model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.xhtml">src</a></li><li class="navelem"><a class="el" href="dir_1df14ea1ac826f73bc3062fa8a76e0c2.xhtml">atmosphere</a></li><li class="navelem"><a class="el" href="dir_3b087d695daa154bfcb7242bcfd0fbd3.xhtml">UKCA</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ukca_surfddr.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ukca__surfddr_8f90.xhtml">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">! Description:</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">! Code description:</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="ukca__surfddr_8f90.xhtml#a98959a39ca7cd17ef0e451681caa9f10" title="(C) Crown copyright Met Office. All rights reserved.!&gt; For further details please refer to the file C...">ukca_surfddr</a>(row_length, rows, ntype, npft,            &amp;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                  sinlat, t0, p0, rh, smr, gsf, stcon, t0tile,          &amp;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                  lai_ft, canwc, so4_vd, rc, o3_stom_frac)</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="ukca__surfddr_8f90.xhtml#a98959a39ca7cd17ef0e451681caa9f10">   21</a></span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      <span class="keywordtype">USE </span>asad_mod<span class="keywordtype">,              ONLY</span>: ndepd, nldepd, speci</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      <span class="keywordtype">USE </span>ukca_constants<span class="keywordtype">,        ONLY</span>: rmol,rhow</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;      <span class="keywordtype">USE </span>ukca_option_mod<span class="keywordtype">,       ONLY</span>: l_ukca_exttc, jpdd</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      <span class="keywordtype">USE </span>nstypes<span class="keywordtype">,               ONLY</span>: soil</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      <span class="keywordtype">USE </span>parkind1<span class="keywordtype">, ONLY</span>: jprb, jpim</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      <span class="keywordtype">USE </span>yomhook<span class="keywordtype">, ONLY</span>: lhook, dr_hook</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceereport__mod.xhtml" title="This file belongs in section: Misc. ">ereport_mod</a><span class="keywordtype">, ONLY</span> : <a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;      <span class="keywordtype">USE </span>um_parvars</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">PARAMETER</span> :: r_null = 1.0e50</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: row_length         <span class="comment">! number columns</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: rows               <span class="comment">! number of rows</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: ntype              <span class="comment">! number of surface types</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: npft               <span class="comment">! number of plant functional types</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows)</span>, <span class="keywordtype">INTENT(IN)</span> :: sinlat</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                      <span class="comment">! Sine(latitude)                               REAL, DIMENSION(row_length,rows), INTENT(IN) :: t0                       ! Surface temperature (K)                      REAL, DIMENSION(row_length,rows), INTENT(IN) :: p0                      ! Surface pressure (Pa)                        REAL, DIMENSION(row_length,rows), INTENT(IN) :: rh                         ! Relative humidity (fraction)          REAL, DIMENSION(row_length,rows), INTENT(IN) :: smr                         ! Soil moisture content (Fraction by volume)</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows,ntype)</span>, <span class="keywordtype">INTENT(IN)</span> :: gsf</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                      <span class="comment">! Global surface fractions                     REAL, DIMENSION(row_length,rows,ntype), INTENT(IN) :: t0tile</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                      <span class="comment">! Surface temperature on tiles (K)</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows,npft)</span>, <span class="keywordtype">INTENT(IN)</span> ::  stcon</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                      <span class="comment">! Stomatal conductance (m s-1)                 REAL, DIMENSION(row_length,rows,npft), INTENT(IN) :: lai_ft</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                      <span class="comment">! Leaf area index (m2 leaf m-2)                REAL, DIMENSION(row_length,rows,npft), INTENT(IN) :: canwc                        ! Canopy water content (mm)</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;           <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows)</span>,      <span class="keywordtype">INTENT(IN)</span> :: so4_vd                         <span class="comment">! Aerosol deposition velocity (m s-1)</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                      <span class="comment">!(assumed to be the same for SO4 and other aerosols)</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows,ntype,jpdd)</span>, <span class="keywordtype">INTENT(OUT)</span> :: rc</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows)</span>, <span class="keywordtype">INTENT(OUT)</span> :: o3_stom_frac</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordtype">INTEGER</span> :: errcode                   <span class="comment">! error code</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">SAVE</span> :: first = .true.</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordtype">CHARACTER(LEN=72)</span> :: cmessage</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keywordtype">INTEGER</span> :: i         <span class="comment">! Loop count over longitudes</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordtype">INTEGER</span> :: k         <span class="comment">! Loop count over latitudes                    INTEGER :: j         ! Loop count over species that deposit         INTEGER :: n         ! Loop count over tiles</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordtype">REAL</span> :: sm            <span class="comment">! Soil moisture content of gridbox</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordtype">REAL</span> :: rr            <span class="comment">! General temporary store for resistances.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordtype">REAL</span> :: ts            <span class="comment">! Temperature of a particular tile.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordtype">REAL</span> :: f             <span class="comment">! Factor to modify CH4 uptake fluxes</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordtype">REAL</span> :: mml = 1.008e5 <span class="comment">! Factor to convert methane flux to dry dep vel.</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordtype">REAL</span> :: r_wet_o3 = 500.0  <span class="comment">! Wet soil surface resistance for ozone (s m-1)</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordtype">REAL</span> :: cuticle_o3 = 5000.0 <span class="comment">! Constant for caln of O3 cuticular resistance</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordtype">REAL</span> :: tundra_s_limit = 0.866 <span class="comment">! Southern limit for tundra (SIN(60))</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,npft)</span> :: r_cut_o3 <span class="comment">! Cuticular Resistance for O3</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(row_length,rows,npft,5)</span> :: r_stom <span class="comment">! Stomatal resistance</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">SAVE</span> :: rsurf(:,:)        <span class="comment">! Standard surface resistances</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">PARAMETER</span> :: TAR_scaling = 15.0</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">PARAMETER</span> :: glmin       = 1.0e-6  <span class="comment">! Minimum leaf conductance</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(9)</span>, <span class="keywordtype">SAVE</span> :: zero</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(9)</span>, <span class="keywordtype">SAVE</span> :: rooh</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(9)</span>, <span class="keywordtype">SAVE</span> :: hno3</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(9)</span>, <span class="keywordtype">SAVE</span> :: aerosol</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(9)</span>, <span class="keywordtype">SAVE</span> :: ch4_up_flux</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(5)</span>, <span class="keywordtype">SAVE</span> :: h2dd_c</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(5)</span>, <span class="keywordtype">SAVE</span> :: h2dd_m</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordtype">REAL</span> :: h2dd_q = 0.27 <span class="comment">! Quadratic term for H2 loss to savannah</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">!     Resistances for Tundra if different to standard value in rsurf().</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(5)</span> :: r_tundra =                                 &amp;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        (/ 1200.0, 25000.0, 800.0, 3850.0, 1100.0/)          <span class="comment">!           NO2      CO      O3      H2     PAN</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">!     CH4 loss to tundra - Cubic polynomial fit to data.!     N.B. Loss flux is in units of ug(CH4) m-2 s-1</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(4)</span> :: ch4dd_tun = (/ -4.757e-6, 4.0288e-3,       &amp;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                           -1.13592, 106.636 /)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">!     HNO3 dry dep to ice; quadratic dependence</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(3)</span> :: hno3dd_ice = (/ -13.57, 6841.9, -857410.6 /)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">!     SO2 dry dep to snow/ice; quadratic dependence</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(3)</span> :: so2dd_ice = (/ 0.0001, 0.003308, 0.1637 /)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">!   Diffusion correction for stomatal conductance Wesley (1989) Atmos. Env. 23, 1293.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">DIMENSION(5)</span> :: dif = (/ 1.6, 1.6, 2.6, 1.9, 0.97 /)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">!                                    NO2   O3  PAN  SO2  NH3</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">DIMENSION(row_length,rows,ntype)</span> ::                     &amp;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        todo     <span class="comment">! True if tile fraction &gt; 0.0</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">DIMENSION(row_length,rows)</span> ::                           &amp;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        microb   <span class="comment">! True if T &gt; 5 C and RH &gt; 40%</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!                  (i.e. microbes in soil are active).</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordtype">INTEGER(KIND=jpim)</span>, <span class="keywordtype">PARAMETER</span> :: zhook_in  = 0</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordtype">INTEGER(KIND=jpim)</span>, <span class="keywordtype">PARAMETER</span> :: zhook_out = 1</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordtype">REAL(KIND=jprb)</span>               :: zhook_handle</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">! Set up standard resistance array rsurf on first call only</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;UKCA_SURF_DD_RES&#39;</span>,zhook_in,zhook_handle)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">IF</span> (first) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keyword">ALLOCATE</span>(rsurf(ntype,jpdd))</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        rsurf(:,:) = r_null</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        zero(:)    = r_null</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        hno3(:)    = 10.0</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">IF</span> (<span class="keyword">SIZE</span>(rooh) /= ntype) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          errcode = ntype</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          cmessage=<span class="stringliteral">&#39;Changed ntype, initialisation arrays now incorrect&#39;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          <span class="keyword">CALL </span><a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a>(<span class="stringliteral">&#39;UKCA_SURFDDR&#39;</span>,errcode,cmessage)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">IF</span> (<span class="keyword">SIZE</span>(h2dd_c) /= npft) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          errcode = npft</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          cmessage=<span class="stringliteral">&#39;Changed npft, initialisation arrays now incorrect&#39;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;          <span class="keyword">CALL </span><a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a>(<span class="stringliteral">&#39;UKCA_SURFDDR&#39;</span>,errcode,cmessage)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">DO</span> i=1,ntype</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;          <span class="keywordflow">IF</span> (i == 1) <span class="keywordflow">THEN</span>             <span class="comment">! Broadleaf trees</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            rooh(i) = 30.0</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            ch4_up_flux(i) = 39.5</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==2) <span class="keywordflow">THEN</span>          <span class="comment">! Needleleaf trees</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            ch4_up_flux(i) = 50.0</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==3) <span class="keywordflow">THEN</span>          <span class="comment">! C3 grass</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            ch4_up_flux(i) = 30.0</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==4) <span class="keywordflow">THEN</span>          <span class="comment">! C4 grass</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            ch4_up_flux(i) = 37.0</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==5) <span class="keywordflow">THEN</span>          <span class="comment">! Shrub</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            ch4_up_flux(i) = 27.5</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==6) <span class="keywordflow">THEN</span>          <span class="comment">! Urban</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            ch4_up_flux(i) = 0.0</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==7) <span class="keywordflow">THEN</span>          <span class="comment">! Water</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            aerosol(i) = 1000.0</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            ch4_up_flux(i) = 0.0</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==8) <span class="keywordflow">THEN</span>          <span class="comment">! Bare Soil</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            aerosol(i) = r_null</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            ch4_up_flux(i) = 27.5</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==9) <span class="keywordflow">THEN</span>          <span class="comment">! Ice</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            rooh(i) = 10.0</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            aerosol(i) = 20000.0</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            ch4_up_flux(i) = 0.0</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">DO</span> i=1,npft</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          <span class="keywordflow">IF</span> (i == 1) <span class="keywordflow">THEN</span>             <span class="comment">! Broadleaf trees</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            h2dd_c(i) = 0.00197</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            h2dd_m(i) = -0.00419</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==2) <span class="keywordflow">THEN</span>          <span class="comment">! Needleleaf trees</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            h2dd_c(i) = 0.00197</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            h2dd_m(i) = -0.00419</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==3) <span class="keywordflow">THEN</span>          <span class="comment">! C3 grass</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            h2dd_c(i) = 0.00177</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            h2dd_m(i) = -0.00414</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==4) <span class="keywordflow">THEN</span>          <span class="comment">! C4 grass</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            h2dd_c(i) = 1.2346</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            h2dd_m(i) = -0.472</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (i==5) <span class="keywordflow">THEN</span>          <span class="comment">! Shrub</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            h2dd_c(i) = 0.0001</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            h2dd_m(i) = 0.0</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">! Standard surface resistances (s m-1). Values are for 9 tiles in</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">! order: Broadleaved trees, Needleleaf trees, C3 Grass, C4 Grass,</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">! Shrub, Urban, Water, Bare Soil, Ice.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">DO</span> n = 1, ndepd</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;          <span class="keywordflow">SELECT CASE</span> (speci(nldepd(n)))</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;O3        &#39;</span>,<span class="stringliteral">&#39;O3S       &#39;</span>)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        rsurf(:,n)=(/200.,200.,200.,200.,400.,800.,2200.,800.,         &amp;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          2500. /)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;NO2       &#39;</span>,<span class="stringliteral">&#39;NO3       &#39;</span>)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        rsurf(:,n)=(/225.,225.,400.,400.,600.,1200.,2600.,1200.,       &amp;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          3500. /)</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="comment">! NO = 6*NO2 except for water where = r_null (Giann. &#39;98)</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;NO        &#39;</span>)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        rsurf(:,n)=(/1350.,1350.,2400.,2400.,3600.,72000.,r_null,72000.,&amp;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;          21000. /)                   <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;HNO3      &#39;</span>,<span class="stringliteral">&#39;HONO2     &#39;</span>,<span class="stringliteral">&#39;ISON      &#39;</span>,<span class="stringliteral">&#39;B2ndry    &#39;</span>, &amp;                  <span class="stringliteral">&#39;A2ndry    &#39;</span>,<span class="stringliteral">&#39;N2O5      &#39;</span>,<span class="stringliteral">&#39;HO2NO2    &#39;</span>,<span class="stringliteral">&#39;HNO4      &#39;</span> )</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        rsurf(:,n)=hno3</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;H2O2      &#39;</span>,<span class="stringliteral">&#39;HOOH      &#39;</span>,<span class="stringliteral">&#39;HO2H      &#39;</span>)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        rsurf(:,n)=hno3</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;CH3OOH    &#39;</span>,<span class="stringliteral">&#39;MeOOH     &#39;</span>,<span class="stringliteral">&#39;C2H5OOH   &#39;</span>,<span class="stringliteral">&#39;EtOOH     &#39;</span>, &amp;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                  <span class="stringliteral">&#39;n_C3H7OOH &#39;</span>,<span class="stringliteral">&#39;i_C3H7OOH &#39;</span>,<span class="stringliteral">&#39;n-PrOOH   &#39;</span>,<span class="stringliteral">&#39;i-PrOOH   &#39;</span>, &amp;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                  <span class="stringliteral">&#39;MeCOCH2OOH&#39;</span>,<span class="stringliteral">&#39;ISOOH     &#39;</span>,<span class="stringliteral">&#39;MACROOH   &#39;</span>,<span class="stringliteral">&#39;MeCO3H    &#39;</span>, &amp;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                  <span class="stringliteral">&#39;MeCO2H    &#39;</span>,<span class="stringliteral">&#39;HCOOH     &#39;</span>,<span class="stringliteral">&#39;PropeOOH  &#39;</span>,<span class="stringliteral">&#39;MEKOOH    &#39;</span>, &amp;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                  <span class="stringliteral">&#39;ALKAOOH   &#39;</span>,<span class="stringliteral">&#39;AROMOOH   &#39;</span>,<span class="stringliteral">&#39;BSVOC1    &#39;</span>,<span class="stringliteral">&#39;BSVOC2    &#39;</span>, &amp;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                  <span class="stringliteral">&#39;ASVOC1    &#39;</span>,<span class="stringliteral">&#39;ASVOC2    &#39;</span>,<span class="stringliteral">&#39;ISOSVOC1  &#39;</span>,<span class="stringliteral">&#39;ISOSVOC2  &#39;</span>, &amp;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                  <span class="stringliteral">&#39;s-BuOOH   &#39;</span>,<span class="stringliteral">&#39;MVKOOH    &#39;</span>,<span class="stringliteral">&#39;HACET     &#39;</span>)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        rsurf(:,n)=rooh</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;PAN       &#39;</span>,<span class="stringliteral">&#39;PPAN      &#39;</span>,<span class="stringliteral">&#39;MPAN      &#39;</span>,<span class="stringliteral">&#39;OnitU     &#39;</span>)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        rsurf(:,n)=(/500.,500.,500.,500.,500.,r_null,12500.,           &amp;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          500.0, 12500. /)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;NH3       &#39;</span>)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        rsurf(:,n)=hno3</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;CO        &#39;</span>)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        rsurf(:,n)=(/3700.,7300.,4550.,1960.,4550.0,r_null,r_null,     &amp;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          4550.0,r_null /)  <span class="comment">! Shrub+bare soil set to C3 grass (guess)</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;CH4       &#39;</span>)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        rsurf(:,n)=zero</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;HONO      &#39;</span>)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        rsurf(:,n)=zero</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;H2        &#39;</span>)</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        rsurf(:,n)=zero</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;SO2       &#39;</span>)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        rsurf(:,n)=(/100.,100.,150.,350.,400.,400.,10.0,700.0,         &amp;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                     r_null /)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;BSOA      &#39;</span>,<span class="stringliteral">&#39;ASOA      &#39;</span>,<span class="stringliteral">&#39;ISOSOA    &#39;</span>,<span class="stringliteral">&#39;ORGNIT    &#39;</span>)        rsurf(:,n)=aerosol             <span class="comment">! HCHO and MecHO are roughly based on the numbers from Zhang e al</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="comment">! These give deposition velocities for land surface types not</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="comment">! exactly corresponding to those in UM (plus give wet/dry surfaces)</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="comment">! Use exisiting rates (eg SO2 and PAN) to infer below rates</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="comment">! This obviously introduces an element of uncertainty into these numbers!</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;HCHO      &#39;</span>)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        rsurf(:,n)=(/100.,100.,150.,350.,600.,400.,200.,700.,700./)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">CASE</span> (<span class="stringliteral">&#39;MeCHO     &#39;</span>,<span class="stringliteral">&#39;EtCHO     &#39;</span>,<span class="stringliteral">&#39;MACR      &#39;</span>,<span class="stringliteral">&#39;NALD      &#39;</span>, &amp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                  <span class="stringliteral">&#39;MGLY      &#39;</span>)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        rsurf(:,n)=(/1200.,1200.,1200.,1200.,1000.,2400.,r_null,r_null, &amp;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    r_null/)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordflow">            CASE DEFAULT</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;              <span class="keywordflow">IF</span> (first) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                cmessage = <span class="stringliteral">&#39; Surface resistance values not set for &#39;</span>// &amp;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                           speci(nldepd(n))</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                errcode = -1</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="keyword">CALL </span><a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a>(<span class="stringliteral">&#39;UKCA_SURFDDR&#39;</span>,errcode,cmessage)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="keywordflow">              ENDIF</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keywordflow">          END SELECT</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordflow">       END DO</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;       first = .false.</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">!      icounter=0</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordflow">             END IF</span> <span class="comment">!first</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      o3_stom_frac = 0.0</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">!     rco3global = 0.0</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">!     gsfglobal = 0.0</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">!     Set logical for surface types</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordflow">DO</span> n = 1, ntype</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            todo(i,k,n) = (gsf(i,k,n) &gt; 0.0)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">! Set microb</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      microb(:,:) = (rh(:,:) &gt; 0.4 .AND. t0(:,:) &gt; 278.0)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">!     Set surface resistances to standard values. rsurf is the!     resistance of the soil, rock, water etc. Set all tiles to!     standard values. These values will be modified below as!     necessary. Extra terms for vegetated tiles (stomatal, cuticular)!     will be added if required. Loop over all parts of array rc to!     ensure all of it is assigned a value.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">DO</span> n = 1, ntype</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;              <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a> = 1, ndepd</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = rsurf(n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;              <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a> = 1, ndepd</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = r_null</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">!     Calculate stomatal resistances</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">IF</span> (todo(i,k,n) .AND. stcon(i,k,n) &gt; glmin) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;              r_stom(i,k,n,1) = 1.5 * dif(1) / stcon(i,k,n) <span class="comment">! NO2</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;              r_stom(i,k,n,2) = dif(2) / stcon(i,k,n)       <span class="comment">! O3</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;              r_stom(i,k,n,3) = dif(3) / stcon(i,k,n)       <span class="comment">! PAN</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;              r_stom(i,k,n,4) = dif(4) / stcon(i,k,n)       <span class="comment">! SO2</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;              r_stom(i,k,n,5) = dif(5) / stcon(i,k,n)       <span class="comment">! NH3</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;              r_stom(i,k,n,1) = r_null</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;              r_stom(i,k,n,2) = r_null</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;              r_stom(i,k,n,3) = r_null</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;              r_stom(i,k,n,4) = r_null</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;              r_stom(i,k,n,5) = r_null</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">!     Now begin assigning specific surface resistances.</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a> = 1, ndepd</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">!       O3: Change land deposition values if surface is wet;!       soil moisture value of 0.3 fairly arbitrary.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;O3        &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;              <span class="keywordflow">IF</span> (smr(i,k) &gt; 0.3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = r_wet_o3</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keywordflow">                  END IF</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,soil)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                  rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = r_wet_o3</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">!           Change values for tundra regions</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            n = npft</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;              <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(3)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(3)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">!           Cuticular resistance for ozone.</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n) .AND. lai_ft(i,k,n) &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                  r_cut_o3(i,n) = cuticle_o3 / lai_ft(i,k,n)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                  r_cut_o3(i,n) = r_null</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">!           Calculate plant deposition terms.</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                  rr = (1.0/r_stom(i,k,n,2)) +                         &amp;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                       (1.0/r_cut_o3(i,n)) +                           &amp;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                       (1.0/rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>))</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                  o3_stom_frac(i,k) = o3_stom_frac(i,k) +              &amp;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    gsf(i,k,n) / (rr * r_stom(i,k,n,2))</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">!       NO2</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;NO2       &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">!           Change values for tundra regions</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            n = npft</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;              <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(1)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(1)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">!           Calculate plant deposition terms.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                  rr = (1.0/r_stom(i,k,n,1)) + (1.0/rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>))</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">!       PAN</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;PAN       &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">!           Change values for tundra regions</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            n = npft</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;              <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">!           Calculate plant deposition terms.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                  rr = (1.0/r_stom(i,k,n,3)) + (1.0/rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>))</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">!         PPAN</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;PPAN      &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">!            IF (L_ukca_exttc) THEN</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;              <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">!               Change values for tundra regions</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                n = npft</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                  <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                    <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                    <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keywordflow">                  END IF</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">!               Calculate plant deposition terms.</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                  <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                      rr = (1.0/r_stom(i,k,n,3)) + (1.0/rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>))</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                      rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordflow">                  END DO</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">!            ENDIF ! End of L_ukca_exttc</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">!         MPAN</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;MPAN      &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">!             Change values for tundra regions</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;              n = npft</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">!             Calculate plant deposition terms.</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;              <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                    rr = (1.0/r_stom(i,k,n,3)) + (1.0/rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>))</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="keywordflow">                  END IF</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">!         ONITU</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;ONITU     &#39;</span>) <span class="keywordflow">THEN</span>           <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">!             Change values for tundra regions</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;             n = npft             <span class="keywordflow">DO</span> i = 1, row_length               <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span>                 <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)                 <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(5)<span class="keywordflow">               END IF</span><span class="keywordflow">             END DO</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">!             Calculate plant deposition terms.</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;             <span class="keywordflow">DO</span> n = 1, npft               <span class="keywordflow">DO</span> i = 1, row_length                 <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span>                   rr = (1.0/r_stom(i,k,n,3)) + (1.0/rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>))                   rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr<span class="keywordflow">                 END IF</span><span class="keywordflow">               END DO</span><span class="keywordflow">             END DO</span><span class="keywordflow">           END DO</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">!       H2 dry dep vel has linear dependence on soil moisture</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">!       Limit sm to avoid excessively high deposition velocities</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;H2        &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">DO</span> n = 1, npft-2</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n) .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                  sm = max(smr(i,k),0.1)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / (h2dd_m(n) * sm + h2dd_c(n))</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">!           C4 grass: H2 dry dep has quadratic-log dependence on!           soil moisture</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            n = npft - 1</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;              <span class="keywordflow">IF</span> (todo(i,k,n) .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                sm = log(max(smr(i,k),0.1))</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                rr = (h2dd_c(4) + sm*(h2dd_m(4) + sm*h2dd_q)) * 1.0e-4</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordflow">IF</span> (rr &gt; 0.00131) rr = 0.00131 <span class="comment">! Conrad/Seiler Max value</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / rr</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">!           Shrub: H2 dry dep velocity has no dependence on!           soil moisture</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            n = npft</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            rr = 1.0 / h2dd_c(n)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;              <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n) .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = rr</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                  rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = rr</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">!           Bare soil</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;              <span class="keywordflow">IF</span> (sinlat(i,k) &lt;= tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n) .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                  sm = max(smr(i,k),0.1)</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / (h2dd_m(3) * sm + h2dd_c(3))</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                  rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = 1.0 / (h2dd_m(3) * sm + h2dd_c(3))</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">!       CH4</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;CH4       &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">!        CH4: Calculate an uptake flux initially. The uptake!        flux depends on soil moisture, based on results of!        Reay et al. (2001). Do the PFTs Broadleaf, Needleleaf,!        C3 and C4 grasses first.</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;              <span class="keywordflow">IF</span> (microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                sm = smr(i,k)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                <span class="keywordflow">IF</span> (sm &lt; 0.16) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                  f = sm / 0.16</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (sm &gt; 0.30) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                  f = (0.50 - sm) / 0.20</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                  f = 1.0</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                f = max(f,0.0)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,1)) rc(i,k,1,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = ch4_up_flux(1) * f</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,2)) rc(i,k,2,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = ch4_up_flux(2) * f</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,3)) rc(i,k,3,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = ch4_up_flux(3) * f</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,4)) rc(i,k,4,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = ch4_up_flux(4) * f</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">!         Now do shrub and bare soil, assumed to be tundra if!         latitude &gt; 60N; Ctherwise, calculate an uptake flux!         initially. The uptake flux depends on soil moisture,!         based on results of Reay et al. (2001).</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          n = npft</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;              <span class="keywordflow">IF</span> (microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                  ts = t0tile(i,k,n)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                  rr = ch4dd_tun(4) + ts * (ch4dd_tun(3) +             &amp;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    ts * (ch4dd_tun(2) + ts * ch4dd_tun(1)))</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                  rr = rr * 3600.0 <span class="comment">! Convert from s-1 to h-1</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = max(rr,0.0)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = max(rr,0.0)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                  sm = smr(i,k)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                  <span class="keywordflow">IF</span> (sm &lt; 0.16) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    f = sm / 0.16</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                  <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (sm &gt; 0.30) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    f = (0.50 - sm) / 0.20</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                  <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                    f = 1.0</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keywordflow">                  END IF</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                  f = max(f,0.0)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,n)) rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = ch4_up_flux(n) * f</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                  <span class="keywordflow">IF</span> (todo(i,k,soil)) rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) =                 &amp;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                    ch4_up_flux(soil) * f</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">!         Convert CH4 uptake fluxes (ug m-2 h-1) to!         resistance (s m-1).</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">DO</span> n = 1, npft</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n) .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                  rr = rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                  <span class="keywordflow">IF</span> (rr &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                    rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = p0(i,k) * mml /                      &amp;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                      (rmol * t0tile(i,k,n) * rr)</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                  <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = r_null</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keywordflow">                  END IF</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            n = soil</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;              <span class="keywordflow">IF</span> (todo(i,k,n) .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                rr = rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                <span class="keywordflow">IF</span> (rr &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = p0(i,k) * mml /                        &amp;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    (rmol * t0tile(i,k,n) * rr * tar_scaling)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = r_null</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;CO        &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">!         Only assign values for CO if microbes are active.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          n = npft</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;              <span class="keywordflow">IF</span> (sinlat(i,k) &gt; tundra_s_limit .AND. microb(i,k)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(2)       <span class="comment">! CO</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                <span class="keywordflow">IF</span> (todo(i,k,soil)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                  rc(i,k,soil,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)  = r_tundra(2)    <span class="comment">! CO</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">!       HONO2</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">!       Calculate resistances for HONO2 deposition to ice, which</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">!       depend on temperature. Ensure resistance for HONO2 does not fall</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">!       below 10 s m-1.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;HNO3      &#39;</span> .OR.                 &amp;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                 speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;HONO2     &#39;</span>  .OR.                &amp;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                 speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;ISON      &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          n = ntype</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;              <span class="keywordflow">IF</span> (todo(i,k,n)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">!               Limit temperature to a minimum of 252K. Curve used!               only used data between 255K and 273K.</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                ts = max(t0tile(i,k,n), 252.0)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                rr = hno3dd_ice(3) + ts * (hno3dd_ice(2) +             &amp;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                     ts * hno3dd_ice(1))</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = max(rr,10.0)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">!       ORGNIT is treated as an aerosol.</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">!       Assume vd is valid for all land types and aerosol types.</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;               <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;ORGNIT    &#39;</span>  .OR.                &amp;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                 speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;BSOA      &#39;</span>  .OR.                &amp;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                 speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;ASOA      &#39;</span>  .OR.                &amp;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                 speci(nldepd(<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>)) == <span class="stringliteral">&#39;ISOSOA    &#39;</span>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;               <span class="keywordflow">DO</span> n = 1, npft+1    <span class="comment">!for the 5 functional plant types as</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                              <span class="comment">!well as for surface type urban (n=6)             DO k = 1, rows</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;              <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="keywordflow">IF</span> (so4_vd(i,k) &gt; 0.0 .AND. gsf(i,k,n) &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                  rr          = 1.0 / so4_vd(i,k)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                  rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = rr</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;           n = soil            <span class="comment">!for surface type soil (n=8)</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          <span class="keywordflow">DO</span> k = 1, rows</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;              <span class="keywordflow">IF</span> (so4_vd(i,k) &gt; 0.0 .AND. gsf(i,k,n) &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                rr          = 1.0 / so4_vd(i,k)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                rc(i,k,n,<a class="code" href="arg__atm__fields_8h.xhtml#a00a9fc8d0f901f46d72445df9f6f4127">j</a>) = rr</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="keywordflow">        END IF</span> <span class="comment">! End of IF (speci == species name)</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="keywordflow">      END DO</span>  <span class="comment">! End of DO j = 1, ndepd</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;UKCA_SURF_DD_RES&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="keyword">      END SUBROUTINE </span><a class="code" href="ukca__surfddr_8f90.xhtml#a98959a39ca7cd17ef0e451681caa9f10" title="(C) Crown copyright Met Office. All rights reserved.!&gt; For further details please refer to the file C...">ukca_surfddr</a></div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
