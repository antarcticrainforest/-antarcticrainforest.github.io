<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UM General Atmosphere: /home/wilfred/PhD/UM/src/control/top_level/atmos_physics1.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="unified_model_logo_2.jpeg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UM General Atmosphere
   &#160;<span id="projectnumber">8.6</span>
   </div>
   <div id="projectbrief">UK Met Offices Unified Model</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.xhtml">src</a></li><li class="navelem"><a class="el" href="dir_b81b067251166617f9d0a8c0cfc3a4a9.xhtml">control</a></li><li class="navelem"><a class="el" href="dir_b65d766d7948d607099cfdc8ce198b76.xhtml">top_level</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">atmos_physics1.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="atmos__physics1_8f90.xhtml">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="atmos__physics1_8f90.xhtml#ae8d55d89da6ed68f5f8d7e9eec99bc76" title="Interface to Atmos Physics parametrizations before S-L advection. ">atmos_physics1</a>(                                        &amp;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;!&gt; Parallel variables</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;     &amp;  global_row_length, global_rows, n_proc, n_procx, n_procy        &amp;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;     &amp;, g_rows, g_row_length                                            &amp;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;!&gt; model dimensions</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;     &amp;, row_length, rows, n_rows, land_points, model_levels, wet_levels &amp;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;     &amp;, bl_levels, dst_levels, dsm_levels, Ozone_levels, cloud_levels   &amp;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;     &amp;, land_ice_points, soil_points, n_cca_levels, ntiles, nice_use    &amp;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;     &amp;, salt_dim1, salt_dim2, salt_dim3, tr_levels, tr_ukca             &amp;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      , cdnc_dim1, cdnc_dim2, cdnc_dim3                                 &amp;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;     &amp;, co2_dim_len, co2_dim_row, co2_dim_lev                           &amp;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;     &amp;, n_arcl_species, n_arcl_compnts, i_arcl_compnts                  &amp;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;!&gt; model switches</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;     &amp;, L_regular, L_lbc_old                                            &amp;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;     &amp;, L_Rad_Step, L_Rad_Step_diag, L_Rad_Step_prog                    &amp;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;     &amp;, L_CAL360, Ltimer                                                &amp;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;     &amp;, L_mixing_ratio                                                  &amp;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      , L_ukca_chem, L_ukca_set_trace_gases                             &amp;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;     &amp;, L_ukca_strat, L_ukca_strattrop                                  &amp;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;     &amp;, L_ukca_prescribech4, L_USE_ARCL                                 &amp;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;!&gt; model Parameters</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;     &amp;, rhcrit                                                          &amp;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;     &amp;, min_trop_level, max_trop_level                                  &amp;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;!&gt; Position of greenhouse gases in tracer_ukca array     &amp;, ngrgas, grgas_addr, Ntot_land, Ntot_sea                         &amp;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;!&gt; parameter for stochastic physics random parameters</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;     &amp;, M_CI                                                            &amp;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;!&gt; in coordinate information</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;     &amp;, delta_lambda, delta_phi, lat_rot_NP, long_rot_NP                &amp;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;!&gt; in time stepping information.</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;     &amp;, val_year, val_day_number, val_hour, val_minute                  &amp;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;     &amp;, val_second, PREVIOUS_TIME,                                      &amp;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;!&gt; diagnostic info</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;#include &quot;argsts.h&quot;</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="atmos__physics1_8f90.xhtml#ae8d55d89da6ed68f5f8d7e9eec99bc76">   47</a></span>&#160;       STASHwork1,STASHwork2,STASHwork4,STASHwork6,STASHwork14,         &amp;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;       STASHwork21                                                      &amp;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;!</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;!&gt; Additional variables for SCM diagnostics</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;     &amp;, nSCMDpkgs, L_SCMDiags                                           &amp;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;!</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;!&gt; in data fields.</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      , theta, q, qcl, qcf, qcf2, qrain, qgraup, rho, u, v, w,          &amp;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        p, p_star                                                       &amp;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;     &amp;, exner_rho_levels, exner_theta_levels                            &amp;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;     &amp;, land_sea_mask, p_theta_levels,fland_ctile                       &amp;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;     &amp;, frac_control                                                    &amp;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      , ukca_cdnc                                                       &amp;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;!&gt; ancillary fields and fields needed to be kept from timestep to</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;!&gt; timestep</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;     &amp;, land_index,rgrain,soot,ntml,cumulus                             &amp;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;     &amp;, ice_fract,ice_fract_cat,ice_thick_cat                           &amp;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      , cca_dp, cca_md, cca_sh                                          &amp;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;     &amp;, cca,ccb,cct,cclwp                                               &amp;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;     &amp;, ccw,lcbase                                                      &amp;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;     &amp;, t_surf, tstar_land_ctile, tstar_sea_ctile, tstar_sice_ctile     &amp;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;     &amp;, sice_alb_ctile,land_alb_ctile,snow_depth,snow_depth_sea_cat     &amp;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;     &amp;, ozone, SW_incs, LW_incs, dirpar_inc                             &amp;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;     &amp;, O3_trop_level, O3_trop_height, T_trop_level, T_trop_height      &amp;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;     &amp;, zh, sd_orog_land , orog_grad_xx_land, orog_grad_xy_land         &amp;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;     &amp;, orog_grad_yy_land, area_cloud_fraction, cf, cfl, cff            &amp;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;     &amp;, aerosol_em, arcl                                                &amp;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      , albsoil, albobs_sw, albobs_vis, albobs_nir, lai, snow_tile      &amp;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      , tile_frac, tstar_tile, z0_tile                                  &amp;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;     &amp;, dOLR_rts, LW_down, SW_tile_rts, ES_SPACE_INTERP, RAD_MASK       &amp;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;     &amp;, cos_zenith_angle                                                &amp;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;!&gt; Variables for COSP</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      , cosp_crain_3d,cosp_csnow_3d                                     &amp;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;!&gt; IN/OUT JULES prognostics</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      , snowdepth_p,lake_h_ice_p, z0m_sea, chloro_sea                   &amp;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;!&gt; in/out</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;     &amp;, theta_star, q_star, qcl_star, qcf_star, qcf2_star, qrain_star   &amp;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;     &amp;, qgraup_star, cf_star, cfl_star, cff_star, u_inc, v_inc          &amp;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;     &amp;, energy_correction, sum_eng_fluxes, sum_moist_flux, AEROSOL      &amp;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      , flash_pot                                                       &amp;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;     &amp;, DUST_DIV1,DUST_DIV2,DUST_DIV3,DUST_DIV4,DUST_DIV5,DUST_DIV6     &amp;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;     &amp;, SO2, SO4_AITKEN, SO4_ACCU, SO4_DISS, NH3                        &amp;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;     &amp;, soot_new, soot_agd, soot_cld, bmass_new, bmass_agd, bmass_cld   &amp;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;     &amp;, ocff_new, ocff_agd, ocff_cld, nitr_acc, nitr_diss               &amp;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;     &amp;, co2, tracer_ukca, BIOGENIC, ASTEPS_SINCE_TRIFFID, ukca_radaer   &amp;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;!&gt; out fields</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;     &amp;, ls_rain, ls_snow, micro_tends, unscaled_dry_rho                 &amp;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;     &amp;, photosynth_act_rad, rad_hr, surf_radflux, dOLR, SW_tile         &amp;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;!&gt; error information</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;     &amp;, Error_code  )</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacedynamics__input__mod.xhtml" title="Input control for dynamics. Input control for dynamics. ">dynamics_input_mod</a><span class="keywordtype">, ONLY</span>: l_endgame, <a class="code" href="namespacedynamics__input__mod.xhtml#a7c6b718ea6d9c2ebe60128c60caab726">l_check_moist_inc</a></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacedynamics__grid__mod.xhtml" title="Input control for dynamics. Input control for dynamics. ">dynamics_grid_mod</a><span class="keywordtype">,  ONLY</span>: <a class="code" href="namespacedynamics__grid__mod.xhtml#a036d3b3153977d2911df89624e310dc2">l_vatpoles</a></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordtype">USE </span>atmos_constants_mod<span class="keywordtype">, ONLY</span>: kappa, p_zero, cp</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          <span class="keywordtype">USE </span>water_constants_mod<span class="keywordtype">, ONLY</span>: lc, lf, tfs</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordtype">USE </span>atm_fields_bounds_mod</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;           <span class="keywordtype">USE </span><a class="code" href="namespacecv__run__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">cv_run_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacecv__run__mod.xhtml#a7c5e9f2b1af9e229ed225af8fc6f7112">l_pc2_diag_sh</a></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacecloud__inputs__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">cloud_inputs_mod</a><span class="keywordtype">,  ONLY</span>: <a class="code" href="namespacecloud__inputs__mod.xhtml#a141ba18395b1e45ebcc582df07691108">l_micro_eros</a>,  <a class="code" href="namespacecloud__inputs__mod.xhtml#a7c7136e2f41b93943e9467178bde33a9">l_rhcpt</a>,              &amp;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                   <a class="code" href="namespacecloud__inputs__mod.xhtml#abf452096a63f1efd4b3777a0368f544f" title="=========================================================================== INTEGER options set from ...">pc2_falliceshear_method</a>, <a class="code" href="namespacecloud__inputs__mod.xhtml#ae04fb44426849e3f308912a8311bb53b">l_pc2</a></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacepc2__constants__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">pc2_constants_mod</a><span class="keywordtype">, ONLY</span>: real_shear</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceukca__trace__gas__mixratio.xhtml" title="(C) Crown copyright Met Office. All rights reserved.!&gt; For further details please refer to the file C...">ukca_trace_gas_mixratio</a><span class="keywordtype">, ONLY</span>: <a class="code" href="interfaceukca__trace__gas__mixratio_1_1ukca__set__trace__gas__mixratio.xhtml">ukca_set_trace_gas_mixratio</a></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;           <span class="keywordtype">USE </span><a class="code" href="namespacetimestep__mod.xhtml" title="Timestepping values. Timestepping values. ">timestep_mod</a><span class="keywordtype">, ONLY</span>:                                           &amp;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;          <a class="code" href="namespacetimestep__mod.xhtml#a5eeea97eaf843661a25badef603b593a" title="Timestep information Updated at start of ATM_STEP every timestep. ">timestep_number</a>, <a class="code" href="namespacetimestep__mod.xhtml#af5057870e73925950dded81acfffb0d6">timestep</a>, <a class="code" href="namespacetimestep__mod.xhtml#aa5104500a2bd47483aed7ebb309312ba">radiation_timestep</a>,                &amp;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;          <a class="code" href="namespacetimestep__mod.xhtml#aa80abdb47ab0588458f46f56d6b1aeb4">radiation_tstep_diag</a>, <a class="code" href="namespacetimestep__mod.xhtml#a67fd8b15477673be65e61cf78b393a8d">radiation_tstep_prog</a></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacerad__input__mod.xhtml" title="Input control for radiation. Input control for radiation. ">rad_input_mod</a></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceclmchfcg__scenario__mod.xhtml" title="A module containing tunable parameters used for histories/scenarios!&gt; of climate change forcings (clm...">clmchfcg_scenario_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a11bf55d08c48e8a01b66786bbf4d6cc5">clim_fcg_nyears</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a17229bf59d1a755898038980b6d10257">clim_fcg_years</a>, &amp;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                       <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#acf9286bc7c3fa84d06409c3bb4a7f99b">clim_fcg_levls</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#ae02d6bb1748e4a05e07621afce3c0e99">clim_fcg_rates</a>,  &amp;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;           <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#aea0e3e5caca20c9fb644d446b97e7e20">s_co2</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#ac00d9759ab4d6474248743dbcf9845ce">s_n2o</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#ada9505db0da9bfb45a7b573f7dc3c64f">s_ch4</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#acaa29cff0cb367ee47ab632b352a9632">s_cfc11</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a1a80053d05ad2ea69b4113600d9f6753">s_cfc12</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#ade4feb3c781b143ba03c3e15319c2bab">s_cfc113</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#ac83c5b4e9bdac91793c41be9b29797ef">s_cfc114</a>,   &amp;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;           <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a77f40032c2c4d684200fb0061c49537c">s_hcfc22</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a0271de7776cf7d7ef64a6458a107caaf">s_hfc125</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a54f935752f48cd9208088dfb8bfda9b8">s_hfc134a</a>, <a class="code" href="namespaceclmchfcg__scenario__mod.xhtml#a5e7240816e454fa122135caab6dee0c4">lenscen</a></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">!        histories/scenarios of climate change forcings</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacearcl__mod.xhtml" title="Constants used by the aerosol climatology for NWP. ">arcl_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacearcl__mod.xhtml#a0f51a5952d7cfd5e3eeb3137e5bc29de">npd_arcl_species</a>, <a class="code" href="namespacearcl__mod.xhtml#a0051721d4a166cc49e970f78d1a245f4">npd_arcl_compnts</a></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceni__gwd__ctl__mod.xhtml" title="purpose: Interface to Atmospheric Physics GWD Schemes. ">ni_gwd_ctl_mod</a><span class="keywordtype">, ONLY</span> : <a class="code" href="namespaceni__gwd__ctl__mod.xhtml#a8b9d37bf8ca26e11c4f9090a2efde488">ni_gwd_ctl</a></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordtype">USE </span>earth_constants_mod<span class="keywordtype">, ONLY</span>: g, earth_radius           use <a class="code" href="namespacetrignometric__mod.xhtml" title="Constants necessary for Coriolis terms in advection scheme. Constants necessary for Coriolis terms in...">trignometric_mod</a>, only:                                       &amp;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          cos_theta_latitude, sin_theta_latitude,                       &amp;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          cos_theta_longitude, sin_theta_longitude,                     &amp;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          fv_cos_theta_latitude, true_latitude, true_longitude</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceglobal__2d__sums__mod.xhtml" title="Module GLOBAL_2D_SUMS_MOD. ">global_2d_sums_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceglobal__2d__sums__mod.xhtml#ac3fe3c2679168085c4635a17e5f82215">global_2d_sums</a></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceg__wave__input__mod.xhtml">g_wave_input_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceg__wave__input__mod.xhtml#a5d287f204883667d70ca5bae099821bd" title="Control logicals. ">l_gwd</a>, <a class="code" href="namespaceg__wave__input__mod.xhtml#ad781fddda1e70ff3d89fe2dc5834a60c">l_use_ussp</a></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;     <span class="comment">!     JULES</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordtype">USE </span>switches<span class="keywordtype">, ONLY</span> :                                              &amp;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        l_flake_model, can_rad_mod, l_snow_albedo, l_ctile</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordtype">USE </span>prognostics<span class="keywordtype">, ONLY</span> :                                           &amp;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        snowdepth</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordtype">USE </span>lake_mod<span class="keywordtype">, ONLY</span> :                                              &amp;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="arg__atm__fields_8h.xhtml#a077e96931fd6272adb443f0dda543638">lake_h_ice</a></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordtype">USE </span>ancil_info<span class="keywordtype">, ONLY</span>:                                             &amp;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          ssi_pts, sea_pts, sice_pts                                    &amp;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        , sice_pts_ncat, ssi_index, sea_index, sice_index               &amp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        , sice_index_ncat, fssi, sea_frac, sice_frac, sice_frac_ncat</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordtype">USE </span>parkind1<span class="keywordtype">, ONLY</span>: jprb, jpim</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordtype">USE </span>yomhook<span class="keywordtype">, ONLY</span>: lhook, dr_hook</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceukca__radaer__struct__mod.xhtml" title="Module file ukca_radaer_struct_mod. ">ukca_radaer_struct_mod</a></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceswapable__field__mod.xhtml" title="This file belongs in section: MPP. ">swapable_field_mod</a><span class="keywordtype">,    ONLY</span>: <a class="code" href="structswapable__field__mod_1_1swapable__field__pointer__type.xhtml">swapable_field_pointer_type</a></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacelevel__heights__mod.xhtml" title="Constants necessary for model level heights in advection and other schemes. Constants necessary for m...">level_heights_mod</a><span class="keywordtype">, ONLY</span>:                                      &amp;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          <a class="code" href="namespacelevel__heights__mod.xhtml#a47255d1b34083d1a399f41be0d9f703e" title="This module is used to hold levels values set in atmos_init. ">eta_theta_levels</a>, <a class="code" href="namespacelevel__heights__mod.xhtml#a70a55e4e7c1bab39c7c0f5c01579f6bb">eta_rho_levels</a>,                             &amp;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;          <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>, <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;           <span class="keywordtype">USE </span>nstypes</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacesubmodel__mod.xhtml" title="A module to contain information about submodels A module to contain information about submodels...">submodel_mod</a></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacetypstsz__mod.xhtml" title="This file belongs in section: Top_level This file belongs in section: Top_level. ">typstsz_mod</a></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceereport__mod.xhtml" title="This file belongs in section: Misc. ">ereport_mod</a><span class="keywordtype">, ONLY</span> : <a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordtype">USE </span>um_parvars</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacedomain__params.xhtml" title="This file belongs in section: MPP. ">domain_params</a></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordtype">USE </span>cosp_types_mod<span class="keywordtype">, ONLY</span>: cosp_gridbox, cosp_config</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacecosp__init__mod.xhtml">cosp_init_mod</a></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacecosp__main__mod.xhtml">cosp_main_mod</a></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordtype">USE </span>ukca_feedback_mod<span class="keywordtype">, ONLY</span>: p_o3, p_ch4, p_n2o, p_f11, p_f12,    &amp;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                   p_f113, p_f22, p_h2os</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceuv__p__pnts__mod.xhtml" title="This file belongs in section: Grids. ">uv_p_pnts_mod</a><span class="keywordtype">,   ONLY</span>: <a class="code" href="namespaceuv__p__pnts__mod.xhtml#a257717be0bd93bcfece445a2a29dede3">uv_p_pnts</a>, <a class="code" href="namespaceuv__p__pnts__mod.xhtml#a77af7b445716f46b5c0d91245f367c57">uv_p_pnts_halo</a></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceset__seasalt__mod.xhtml" title="Subroutine to calculate sea-salt aerosol number concentration. Subroutine to calculate sea-salt aeros...">set_seasalt_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceset__seasalt__mod.xhtml#a5c36f354358226be262b60f271cd9938">set_seasalt_4a</a></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceadd__eng__corr__mod.xhtml" title="SUBROUTINE ADD_ENG_CORR. ">add_eng_corr_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceadd__eng__corr__mod.xhtml#a8e04db0cfd29656fbd3d715a20951c8d">add_eng_corr</a></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacedust__parameters__mod.xhtml" title="A module containing constants/parameters used in the dust scheme. ">dust_parameters_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacedust__parameters__mod.xhtml#ac897534dc97f74f123a81079a464283b" title="Parameters fundamental to the dust scheme!&gt; (Details of dust properties/size divisions etc...">l_dust</a></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceum__input__control__mod.xhtml" title="*****************************COPYRIGHT******************************** *****************************C...">um_input_control_mod</a><span class="keywordtype">,  ONLY</span>:                                  &amp;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;           model_domain,       &amp;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;           <a class="code" href="namespaceum__input__control__mod.xhtml#afcfb603e4c2bcc2bf5d129963425fbbb">l_co2_interactive</a>,  <a class="code" href="namespaceum__input__control__mod.xhtml#aa0d1cafad497e92cb3f83decaa9ab994">l_triffid</a>,        <a class="code" href="namespaceum__input__control__mod.xhtml#a60dc82b3ef873c78cec7cf99537ba081" title="Use sea-salt aerosol in microphysics. ">l_use_seasalt_autoconv</a>,&amp;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                                 <a class="code" href="namespaceum__input__control__mod.xhtml#a1fa66a46750b83f245bd01ed2ef36cea">l_use_methox</a>,          &amp;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;           <a class="code" href="namespaceum__input__control__mod.xhtml#a5e102a877cce4f02fad05c876cd2abad">l_mr_physics1</a>,      <a class="code" href="namespaceum__input__control__mod.xhtml#a2fabd41a392e38b05134c21806d1e4f9">l_mr_physics2</a>,    <a class="code" href="namespaceum__input__control__mod.xhtml#a329e8826b00c7dd328f8e54bdecc7c06" title="Use the same number of cloud droplets for 1st and 2nd indirect effects. ">l_consistent_cdnc</a></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordtype">USE </span>ukca_option_mod<span class="keywordtype">, ONLY</span>:                                        &amp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;           l_ukca, l_ukca_aie1, l_ukca_radaer, l_ukca_radaer_sustrat,   &amp;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;           i_ukca_scenario</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacerun__aerosol__mod.xhtml" title="A module containing tunable parameters and dependent logicals!&gt; used in the aerosol scheme...">run_aerosol_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacerun__aerosol__mod.xhtml#a2a0e2fefafaaa254aac4cf8cd4a291e1" title="Control logicals for Classic aerosol options ">l_sulpc_so2</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#a49e39d25a38244027b312e0298566110" title="Soot scheme. ">l_soot</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#a08c24874ad5cdfed2445a206552c249d" title="OCFF (Organic Carbon from Fossil Fuels) scheme. ">l_ocff</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#ab289e7ad790cc1441c12d9265336b626" title="Biomass scheme. ">l_biomass</a>,  &amp;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                 l_sulpc_nh3, <a class="code" href="namespacerun__aerosol__mod.xhtml#a66e1005b9ceceb05bcd815d826b99c24" title="Ammonium nitrate aerosol. ">l_nitrate</a></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceukca__scenario__ctl__mod.xhtml" title="(c) [University of Cambridge] [2008]. All rights reserved.!&gt; This routine has been licensed to the Me...">ukca_scenario_ctl_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceukca__scenario__ctl__mod.xhtml#ad42cb3c928f7fab4b57873bca163366f" title="take LBC values from UMUI/Rose ">i_ukca_scenario_um</a></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacemphys__inputs__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">mphys_inputs_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacemphys__inputs__mod.xhtml#a1e977cd2bfc88d00f67153d185e877f8">l_mcr_qcf2</a>, <a class="code" href="namespacemphys__inputs__mod.xhtml#a3d970e6ae2e572f69c0d3cea5b5247ce">l_mcr_qgraup</a>, <a class="code" href="namespacemphys__inputs__mod.xhtml#ad580b93fb6223c38181f3f05d1b82c62">l_mcr_qrain</a>, <a class="code" href="namespacemphys__inputs__mod.xhtml#ab487b863e38ec5b9d292dec1c6d289b2">l_rain</a></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceeng__corr__inputs__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">eng_corr_inputs_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceeng__corr__inputs__mod.xhtml#afa85786376e90acd7e63aafb5fda1028" title="=========================================================================== LOGICAL options set from ...">l_emcorr</a>, <a class="code" href="namespaceeng__corr__inputs__mod.xhtml#a30fca5235cd511b8789c3817af33e02f">lflux_reset</a></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacemurk__inputs__mod.xhtml" title="*****************************COPYRIGHT************************************** ************************...">murk_inputs_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacemurk__inputs__mod.xhtml#a86d12abdf2733c53d3b7b8c6a2edbde4" title="=========================================================================== LOGICAL options set from ...">l_murk</a>, <a class="code" href="namespacemurk__inputs__mod.xhtml#aad805bdec51c79f56b6566511acd6676">l_murk_source</a>, <a class="code" href="namespacemurk__inputs__mod.xhtml#af16762db47267ecd460ee1a7b4bbbbb4" title="Define the run_murk namelist. ">l_murk_bdry</a>, <a class="code" href="namespacemurk__inputs__mod.xhtml#aa5c3d51a09795a3d2dfda1d3f53067ec">l_murk_rad</a></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacecosp__input__mod.xhtml">cosp_input_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacecosp__input__mod.xhtml#ae03035077d4522b3649cdcabe1bada14">l_cosp</a></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacediagnostics__pc2checks__mod.xhtml" title="This file belongs in section: large scale precip. ">diagnostics_pc2checks_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacediagnostics__pc2checks__mod.xhtml#adc235a43b6249fc5186d8d64ad4e7702">diagnostics_pc2checks</a></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceu__to__p__mod.xhtml" title="subroutine U_TO_p for calculating variables held at u points subroutine U_TO_p for calculating variab...">u_to_p_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaceu__to__p__mod.xhtml#abec25da0a0e72ae2bd1efd5a110125fb">u_to_p</a></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacev__to__p__mod.xhtml" title="subroutine V_TO_P for calculating variables held at v points subroutine V_TO_P for calculating variab...">v_to_p_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacev__to__p__mod.xhtml#a071d83a5fb4aa87adbf487a6218a3037">v_to_p</a></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacetrsrce__mod.xhtml" title="SUBROUTINE TRSRCE !&gt; ">trsrce_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacetrsrce__mod.xhtml#a7eefc5bc8717562e297c331a549d63f1">trsrce</a></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacecheck__dmoist__inc__mod.xhtml" title="check the column integral of moist increments !&gt; ">check_dmoist_inc_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespacecheck__dmoist__inc__mod.xhtml#a4748a83895589223ec70737e415da9b5">check_dmoist_inc</a></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacefsd__parameters__mod.xhtml" title="Global module for setting and storing parameters used in. ">fsd_parameters_mod</a></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceumprintmgr.xhtml" title="This file belongs in section: Misc. ">umprintmgr</a><span class="keywordtype">, ONLY</span> :      &amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          <a class="code" href="namespaceumprintmgr.xhtml#aae44897e556705dbf5e945a26538be9a">umprint</a>,                &amp;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          <a class="code" href="namespaceumprintmgr.xhtml#a38275af5a575d53ab2b03beb38d249b5">ummessage</a></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#if defined(SCMA)</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor"></span>      <span class="keywordtype">USE </span><a class="code" href="namespaces__scmop__mod.xhtml">s_scmop_mod</a><span class="keywordtype">, ONLY</span>: <a class="code" href="namespaces__scmop__mod.xhtml#a0de635b7af80c9bf26aa5b874f67d655">default_streams</a>                                 &amp;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#adb70a12d6474a089d0a5b0f861e193c2">t_inst</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a63ec75937e5bfb3e70894cb3e2a08738">t_avg</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a5a13db9f3d2b54dc7f02f3fa3fc19ece">t_max</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a45eef9702d217d7da71dcf394198f2d6">t_min</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a5a6f815019b3004ecc7040ec4b4d1fd4">t_acc</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a597140e5cb551f5f4651c9b4cd534865">t_div</a>, <a class="code" href="namespaces__scmop__mod.xhtml#acfaa64e6b4c579d708188c5774d8ac7d">t_mult</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a58d068616503a332fdbc2e4c7bb9f23b">t_acc_div</a>       &amp;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#acaad14680fec34a8c1c206ebeb34d239">t_acc_mult</a>, <a class="code" href="namespaces__scmop__mod.xhtml#ab61b1909fcdb9b3f9552d14f2f8839fe">t_const</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a25166a280622f5787108c0078a033004">only_radsteps</a>                                 &amp;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#a9e42893fdbe56b604355689cd9248c63">d_sl</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a5914c497075c8cbd0e5cd1d211e1a123">d_soilt</a>, <a class="code" href="namespaces__scmop__mod.xhtml#ad97dd1acaa61800db9233ae60f5b1e84">d_bl</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a0f351beba305dba0d9e82e98eeabd5d1">d_wet</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a12df05d6be37b339aab4962186c305b6">d_all</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a1462f6faadb6334b311e602285d8a286">d_soilm</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a80fd65616a49171a9ac7ecac7338d70a">d_tile</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a92a2c3b6b4b2b0dd800234719ca7207b">d_vis</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a531939b489ce23adb71e2515981989da">d_point</a> &amp;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#a11d031129d23dbffdab391dd303cdd08">d_allxtra</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a5de685a17fc8f67d938e5982544ec05f">d_land</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a049e4924fd63af8676e1697fcde11654">d_cloud</a>                                         &amp;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#a6ff96781019d621303b6d86d6d2486a5">scmdiag_gen</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a5564776c9d09d933db80c6c1c3c47b3d">scmdiag_rad</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a6099058c886f9254fabef330fa2caedd">scmdiag_bl</a>, <a class="code" href="namespaces__scmop__mod.xhtml#aa95516bacfa8a4f2932fc3e17f5f6b65">scmdiag_surf</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a89d9b3531f7c5739e1d9b9edf0583d58">scmdiag_land</a>   &amp;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#a762d12a388196f9c5a907e8090d18e3a">scmdiag_sea</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a40ccacb1e960d2ef3da728d637e5ebe2">scmdiag_lsp</a>, <a class="code" href="namespaces__scmop__mod.xhtml#abf142f0f2bdc021960cf0c6a5ecd065b">scmdiag_conv</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a73ce0babd803e10fbcb82921346b3ccc">scmdiag_lscld</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a2b946f89404f7668eb56ca960c3c3de6">scmdiag_pc2</a> &amp;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        , <a class="code" href="namespaces__scmop__mod.xhtml#a61abfb55fdd33cfc5d44f00076f252c8">scmdiag_forc</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a8a1879aca60631ef706c8ce42618ced6">scmdiag_incs</a>, <a class="code" href="namespaces__scmop__mod.xhtml#a765b6df27a911737054c8df3c0746c15">scmdiag_gwd</a></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor"></span>            <span class="keywordtype">IMPLICIT NONE</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">! Description: This version interfaces to physics schemes in sequence:</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">!    energy correction              (optional)</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">!    microphysics (cloud and large scale precipitation schemes)</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">!    radiation</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">!    gravity wave drag</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">!          CALLed before Semi-Lagrangian in atmosphere timestep.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">! Method:</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">! This file belongs in section: Top Level</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">!   Language: FORTRAN 90 + common extensions.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">!   This code is written to UMDP3 v6 programming standards.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">! System component: Control Atmos</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">! Declarations:</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">! Global variables (*CALLed COMDECKs etc...):</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#include &quot;typsts.h&quot;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">! Subroutine arguments ===============================================</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">! arguments with intent in. ie: input variables.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">! Parallel setup variables</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;     &amp;  global_row_length                                               &amp;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                           <span class="comment">! number of points on a row</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;     &amp;, global_rows                                                     &amp;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                           <span class="comment">! NUMBER OF global rows</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;     &amp;, n_proc                                                          &amp;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                   <span class="comment">! Total number of processors</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;     &amp;, n_procx                                                         &amp;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                   <span class="comment">! Number of processors in longitude</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;     &amp;, n_procy                                                         &amp;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                   <span class="comment">! Number of processors in latitude</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;     &amp;, g_rows(0:n_proc-1)                                             &amp;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;     &amp;, g_row_length(0:n_proc-1)                                      </div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">! Model dimensions</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;     &amp;  row_length                                                      &amp;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;     &amp;, rows                                                            &amp;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;     &amp;, n_rows                                                          &amp;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;     &amp;, salt_dim1                                                       &amp;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                      <span class="comment">!</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;     &amp;, salt_dim2                                                       &amp;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                      <span class="comment">! Dimensions of sea-salt aerosol arrays</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;     &amp;, salt_dim3                                                       &amp;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                      <span class="comment">!</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;     &amp;, land_points                                                     &amp;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    <span class="comment">! IN No.of land points being processed, can be 0.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;     &amp;, model_levels                                                    &amp;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;     &amp;, wet_levels                                                      &amp;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;     &amp;, bl_levels                                                       &amp;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;     &amp;, dst_levels                                                      &amp;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    <span class="comment">! number of deep soil temperature levels</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;     &amp;, dsm_levels                                                      &amp;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    <span class="comment">! number of deep soil moisture levels</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;     &amp;, ozone_levels                                                    &amp;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;     &amp;, cloud_levels                                                    &amp;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;     &amp;, land_ice_points                                                 &amp;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                        <span class="comment">! number of land ice points</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;     &amp;, soil_points                                                     &amp;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        <span class="comment">! number of soil points</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;     &amp;, n_cca_levels                                                    &amp;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                      <span class="comment">! Number of levels for conv cloud</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;     &amp;, tr_levels                                                       &amp;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                      <span class="comment">! number of tracer levels</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;     &amp;, tr_ukca                                                         &amp;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                      <span class="comment">! number of UKCA tracers</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                      <span class="comment">! amount: 1 for 2D, nlevs for 3D.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;     &amp;, ntiles                                                          &amp;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;     &amp;, nice_use                                                        &amp;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                      <span class="comment">! No. of sea ice catagories used in radiation</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;     &amp;,co2_dim_len                                                      &amp;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                     <span class="comment">!\ For dimension 3-D CO2 field to be passed</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;     &amp;,co2_dim_row                                                      &amp;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                     <span class="comment">!/ to rad_ctl</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;     &amp;,co2_dim_lev   <span class="comment">!/</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordtype">Logical</span>                                                           &amp;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;     &amp;  Ltimer   <span class="comment">! true then output some timing information</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordtype">Logical</span>                                                           &amp;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;     &amp;  L_Rad_Step                                                      &amp;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                        <span class="comment">! true if a radiation timestep</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;     &amp;, l_rad_step_diag                                                 &amp;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                         <span class="comment">! true if fast radiation timestep    (3C)</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;     &amp;, l_rad_step_prog                                                 &amp;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                         <span class="comment">! true if slow radiation timestep    (3C)</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;     &amp;, l_cal360                                                        &amp;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                        <span class="comment">! true if using 360 day calender</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;     &amp;, l_regular                                                       &amp;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                     <span class="comment">! True if NOT variable resolution</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;     &amp;, l_lbc_old                                                       &amp;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                        <span class="comment">!  false for new lbc treatment</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;     &amp;, l_mixing_ratio                                                  &amp;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                       <span class="comment">! true if mixing ratios used</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;     &amp;, l_ukca_chem                                                     &amp;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <span class="comment">! T for ukca chemistry</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;     &amp;, l_ukca_set_trace_gases                                          &amp;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <span class="comment">! Switch for prescribing atmospheric gases in UKCA</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;     &amp;, l_ukca_strat                                                    &amp;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="comment">! True for stratospheric chemistry scheme</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;     &amp;, l_ukca_strattrop                                                &amp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="comment">! True for stratospheric+tropospheric chemistry scheme</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;     &amp;, l_ukca_prescribech4                                                            <span class="comment">! Switch for prescribing surface ch4 in UKCA</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                        <span class="comment">!, Intent(IN)</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;     &amp;    ntot_land                                                     &amp;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                               <span class="comment">! Number of droplets over land / m-3</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;     &amp;   ,ntot_sea             <span class="comment">! Number of droplets over sea / m-3</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        <span class="comment">!, Intent(IN)</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;     &amp;    m_ci      <span class="comment">! variable to modify ice fall speed for LSPCON3C</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="comment">!  for stochastic physics random parameters    </span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;     &amp;  min_trop_level                                                  &amp;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                        <span class="comment">! Lowest permitted level for the tropopause</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">!                       ! used for radiative purposes.</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;     &amp;, max_trop_level  <span class="comment">! Highest permitted level for the tropopause</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">!                       ! used for radiative purposes.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;     &amp;  rhcrit(wet_levels)   <span class="comment">! IN Critical relative humidity.</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                             <span class="comment">! the values need to be tuned</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                             <span class="comment">! for the given set of levels.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">! Diagnostics info</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordtype">REAL</span>                                                              &amp;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;     &amp; STASHWORK1(*)                                                    &amp;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                         <span class="comment">! STASH workspace for section 1 (SW rad)</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;     &amp;,stashwork2(*)                                                    &amp;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                         <span class="comment">! STASH workspace for section 2 (LW rad)</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;     &amp;,stashwork4(*)                                                    &amp;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                         <span class="comment">! STASH workspace for section 4 (LS precip)</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;     &amp;,stashwork6(*)                                                    &amp;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                         <span class="comment">! STASH workspace for section 6 (gw drag)</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      ,stashwork14(*)                                                   &amp;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                         <span class="comment">! STASH workspace for section 14 (Energy cor)</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      ,stashwork21(*)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                         <span class="comment">! STASH workspace for section 21 (electric)</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">! Data arrays</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">! Small halo</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: u  (udims_s%i_start:udims_s%i_end,        &amp;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                  udims_s%j_start:udims_s%j_end,        &amp;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                  udims_s%k_start:udims_s%k_end)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: v  (vdims_s%i_start:vdims_s%i_end,        &amp;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                  vdims_s%j_start:vdims_s%j_end,        &amp;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                  vdims_s%k_start:vdims_s%k_end)</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: rho(pdims_s%i_start:pdims_s%i_end,        &amp;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                                  pdims_s%j_start:pdims_s%j_end,        &amp;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                  pdims_s%k_start:pdims_s%k_end)       <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: p  (pdims_s%i_start:pdims_s%i_end,        &amp;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                  pdims_s%j_start:pdims_s%j_end,        &amp;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                  pdims_s%k_start:pdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: <a class="code" href="varcld_8h.xhtml#acd7a57e90bb1e737ecae71f1c1830ad6">p_theta_levels</a>                            &amp;                                  (tdims_s%i_start:tdims_s%i_end,        &amp;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                  tdims_s%j_start:tdims_s%j_end,        &amp;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                  tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: theta                                     &amp;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                 (tdims_s%i_start:tdims_s%i_end,        &amp;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                  tdims_s%j_start:tdims_s%j_end,        &amp;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                  tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: exner_rho_levels                          &amp;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                 (pdims_s%i_start:pdims_s%i_end,        &amp;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                  pdims_s%j_start:pdims_s%j_end,        &amp;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                  pdims_s%k_start:pdims_s%k_end + 1)           <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: exner_theta_levels                        &amp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                 (tdims_s%i_start:tdims_s%i_end,        &amp;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                  tdims_s%j_start:tdims_s%j_end,        &amp;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                  tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">!No halo</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: p_star (pdims%i_start:pdims%i_end,        &amp;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                      pdims%j_start:pdims%j_end)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">!Large halo</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: q  (qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qcl(qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)            <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qcf(qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qcf2                                      &amp;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                 (qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qrain                                     &amp;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                 (qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qgraup                                    &amp;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                 (qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: cf (qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)            <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: cfl(qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: cff(qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;     &amp;  energy_correction</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">! ancillary arrays and fields required to be saved from timestep to</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">! timestep.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;     &amp;  T_surf(row_length, rows)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">! The following are only used if coastal tiling is switched on:</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordtype">REAL</span>                                                              &amp;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;     &amp; FLAND_CTILE(LAND_POINTS)                                         &amp;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                   <span class="comment">! IN Land fraction on land points.</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;     &amp;,tstar_land_ctile(row_length,rows)                                &amp;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">!                                  ! IN Land mean sfc temperature (K)</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;     &amp;,tstar_sea_ctile(row_length,rows)                                 &amp;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">!                                  ! IN Open sea sfc temperature (K).</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;     &amp;,tstar_sice_ctile(row_length,rows,nice_use)                       &amp;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">!                                  ! IN Sea-ice sfc temperature (K).</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;     &amp;,land_alb_ctile(row_length,rows)                                  &amp;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">!                                  ! INOUT Mean land albedo.</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;     &amp;,sice_alb_ctile(row_length,rows)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">!                                  ! INOUT Sea-ice albedo.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordtype">logical</span>                                                           &amp;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;     &amp;  land_sea_mask(row_length, rows)                                 &amp;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;     &amp;, RAD_MASK(row_length, rows)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">!  A mask which ensures a chequerboard pattern of radiation calculations</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">!  over the whole domain (not just one PE)</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;     &amp;  land_index (land_points)                                        &amp;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                      <span class="comment">! set from land_sea_mask</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;     &amp;, ntml(row_length, rows)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordtype">Logical</span>                                                           &amp;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;     &amp;  cumulus (row_length, rows) <span class="comment">! bl convection flag</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;     &amp;  snow_depth (row_length, rows)                                   &amp;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                      <span class="comment">! snow/qrclim.snow.(month)</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;     &amp;, snow_depth_sea_cat(row_length, rows, nice_use)                 &amp;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                                      <span class="comment">! snow depth on sea ice</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;     &amp;, sd_orog_land(land_points)                                      &amp;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                   <span class="comment">! orog/qrparm.orog.stdev</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;     &amp;, orog_grad_xx_land(land_points)                                  &amp;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                                       <span class="comment">! orog/qrparm.orog.sigmaxx</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;     &amp;, orog_grad_xy_land(land_points)                                  &amp;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                                       <span class="comment">! orog/qrparm.orog.sigmaxy</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;     &amp;, orog_grad_yy_land(land_points)                                  &amp;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                                       <span class="comment">! orog/qrparm.orog.sigmayy</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;     &amp;, zh(row_length, rows)                                            &amp;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                             <span class="comment">! boundary layer height</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;     &amp;, aerosol_em( 1 : row_length, 1 : rows, 1 :model_levels )</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordtype">REAL</span> ::                                                           &amp;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        snowdepth_p(land_points,ntiles)                                 &amp;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                                  <span class="comment">! Snow depth on ground on tiles (m)</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      , lake_h_ice_p(land_points)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                                  <span class="comment">! FLake lake ice thickness (m)</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;     &amp;  ozone(row_length, rows, ozone_levels)                           &amp;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;     &amp;, O3_trop_level(row_length,rows)                                  &amp;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;     &amp;, O3_trop_height(row_length,rows)                                 &amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;     &amp;, cos_zenith_angle(row_length, rows)                              &amp;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;     &amp;, T_trop_level(row_length,rows)                                   &amp;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;     &amp;, T_trop_height(row_length,rows)                                  &amp;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;     &amp;, SW_incs(row_length, rows, 0:model_levels+1)                     &amp;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;     &amp;, LW_incs(row_length, rows, 0:model_levels)                       &amp;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;     &amp;, dirpar_inc(row_length, rows)                                    &amp;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;     &amp;, soot(row_length, rows)                                          &amp;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                       <span class="comment">! Snow soot</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;     &amp;, ice_fract(row_length, rows)                                    &amp;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                                       <span class="comment">! ice/qrclim.ice.(month)</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;     &amp;, ice_fract_cat(row_length, rows, nice_use)                      &amp;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                                       <span class="comment">! ice fraction per cat</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;     &amp;, ice_thick_cat(row_length, rows, nice_use)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                       <span class="comment">! effective ice thickness per cat</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;     &amp;  albsoil(land_points)                                            &amp;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      , albobs_sw(land_points)                                          &amp;      , albobs_vis(land_points)                                         &amp;      , albobs_nir(land_points)                                         &amp;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;     &amp;, lai(land_points, npft)                                          &amp;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;     &amp;, rgrain(land_points, ntiles)                                     &amp;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;     &amp;, snow_tile(land_points, ntiles)                                  &amp;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;     &amp;, tile_frac(land_points, ntype)                                   &amp;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;     &amp;, tstar_tile(land_points, ntiles)                                 &amp;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;     &amp;, z0_tile(land_points, ntiles)                                    &amp;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      , z0m_sea(row_length, rows)                                       &amp;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      , chloro_sea(row_length, rows)                                    &amp;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;     &amp;, dOLR_rts(row_length, rows)                                      &amp;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                                         <span class="comment">! TOA - surface upward LW</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;     &amp;, lw_down(row_length, rows)                                       &amp;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                         <span class="comment">! Surface downward LW</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;     &amp;, sw_tile_rts(land_points, ntiles)                                &amp;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                         <span class="comment">! Surface net SW on land tiles</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;     &amp;, es_space_interp(4, row_length, rows)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">!              Coeffs for spatial interpolation of radiation quantities</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">! Aerosol climatology for NWP</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;           <span class="comment">! Number of requested species within the climatology</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordtype">Integer</span> n_arcl_species</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;           <span class="comment">! Corresponding number of requested components</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="keywordtype">Integer</span> n_arcl_compnts</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;           <span class="comment">! Model switch for each species</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordtype">Logical</span> L_USE_ARCL(<a class="code" href="namespacearcl__mod.xhtml#a0f51a5952d7cfd5e3eeb3137e5bc29de">npd_arcl_species</a>)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;           <span class="comment">! Mass-mixing ratios</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;     &amp;   arcl(row_length, rows, model_levels, n_arcl_compnts)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          <span class="comment">! Array index of each component</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;       <span class="keywordtype">Integer</span> i_arcl_compnts(<a class="code" href="namespacearcl__mod.xhtml#a0051721d4a166cc49e970f78d1a245f4">npd_arcl_compnts</a>)</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">! Convection Scheme</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordtype">Real</span>    :: ccw(row_length, rows, wet_levels)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordtype">Integer</span> :: lcbase(row_length, rows)</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        cca (row_length, rows, n_cca_levels)                            &amp;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      , cca_dp (qdims%i_start:qdims%i_end,                              &amp;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                qdims%j_start:qdims%j_end, n_cca_levels)                &amp;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      , cca_md (qdims%i_start:qdims%i_end,                              &amp;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                qdims%j_start:qdims%j_end, n_cca_levels)                &amp;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      , cca_sh (qdims%i_start:qdims%i_end,                              &amp;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                qdims%j_start:qdims%j_end, n_cca_levels)                &amp;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      , cclwp(row_length, rows) <span class="comment">! condensed water path (KG/M**2)</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;     &amp;  ccb (row_length, rows)                                          &amp;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;     &amp;, cct (row_length, rows)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">! Co-ordinate arrays</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordtype">REAL</span> ::                                                           &amp;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;     &amp;  delta_lambda                                                    &amp;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;     &amp;, delta_phi</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">! time information for current timestep</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;     &amp;  val_year                                                        &amp;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;     &amp;, val_day_number                                                  &amp;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;     &amp;, val_hour                                                        &amp;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;     &amp;, val_minute                                                      &amp;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;     &amp;, val_second                                                      &amp;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;     &amp;,         PREVIOUS_TIME(7)                                        &amp;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;     &amp;,     ASTEPS_SINCE_TRIFFID   <span class="comment">! INOUT  Number of atmospheric</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">!                                  !        timesteps since last call</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">!                                  !        to TRIFFID.</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">! UKCA_RADAER structure</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      type(<a class="code" href="structukca__radaer__struct__mod_1_1ukca__radaer__struct.xhtml">ukca_radaer_struct</a>) :: ukca_radaer</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">! Diagnostic variables</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;     &amp;  lat_rot_NP                                                      &amp;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;     &amp;, long_rot_NP</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;     &amp;  area_cloud_fraction(row_length, rows, wet_levels)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">! Variables for COSP</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">! 3D convective rainfall flux COSP</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordtype">REAL</span>,<span class="keywordtype">INTENT(IN)</span> :: cosp_crain_3d(row_length,rows,model_levels)</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">! 3D convective snowfall flux COSP</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordtype">REAL</span>,<span class="keywordtype">INTENT(IN)</span> :: cosp_csnow_3d(row_length,rows,model_levels)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">! arguments with intent in/out. ie: input variables changed on output.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordtype">Real</span>, <span class="keywordtype">Intent (InOut)</span> ::                                           &amp;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;     &amp;  sum_eng_fluxes(row_length,rows)                                 &amp;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                         <span class="comment">! sum atmosphere fluxes</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;     &amp;, sum_moist_flux(row_length,rows)  <span class="comment">! sum moist fluxes</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: theta_star                                &amp;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                 (tdims_s%i_start:tdims_s%i_end,        &amp;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                  tdims_s%j_start:tdims_s%j_end,        &amp;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                  tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: q_star                                    &amp;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)           <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qcl_star                                  &amp;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)           <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qcf_star                                  &amp;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qcf2_star                                 &amp;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qrain_star                                &amp;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: qgraup_star                               &amp;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: cf_star                                   &amp;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)            <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: cfl_star                                  &amp;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: cff_star                                  &amp;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                 (qdims_s%i_start:qdims_s%i_end,        &amp;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                  qdims_s%j_start:qdims_s%j_end,        &amp;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                  qdims_s%k_start:qdims_s%k_end)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: u_inc                                     &amp;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                 (udims_s%i_start:udims_s%i_end,        &amp;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                  udims_s%j_start:udims_s%j_end,        &amp;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                  udims_s%k_start:udims_s%k_end)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT (INOUT)</span> :: v_inc                                     &amp;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                 (vdims_s%i_start:vdims_s%i_end,        &amp;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                                  vdims_s%j_start:vdims_s%j_end,        &amp;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                                  vdims_s%k_start:vdims_s%k_end)  </div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  aerosol  (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  flash_pot(tdims%i_start:tdims%i_end,      &amp;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                        tdims%j_start:tdims%j_end,      &amp;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                        tdims%k_start:tdims%k_end)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  DUST_DIV1(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  DUST_DIV2(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  DUST_DIV3(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  DUST_DIV4(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  DUST_DIV5(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  DUST_DIV6(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  so2      (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  so4_aitken                                &amp;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                                       (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  so4_accu (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  so4_diss (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  nh3      (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  soot_new (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  soot_agd (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  soot_cld (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  bmass_new(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  bmass_agd(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  bmass_cld(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  ocff_new (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  ocff_agd (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  ocff_cld (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  nitr_acc (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  nitr_diss(tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  co2      (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                        tdims_s%k_start:tdims_s%k_end)      <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(INOUT)</span> ::  tracer_ukca                               &amp;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                                       (tdims_s%i_start:tdims_s%i_end,  &amp;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                                        tdims_s%j_start:tdims_s%j_end,  &amp;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                                        tdims_s%k_start:tdims_s%k_end,  &amp;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                                        tr_ukca)          <span class="keywordtype">Real</span>, <span class="keywordtype">Intent(In)</span> ::                                               &amp;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;     &amp;  biogenic(row_length, rows, model_levels)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">! arguments with intent out. ie: output variables.</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">! arrays holding information to be passed between physics</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">! routines.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;     &amp;  ls_rain(row_length, rows)                                       &amp;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;     &amp;, ls_snow(row_length, rows)                                       &amp;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;     &amp;, micro_tends(row_length, rows, 2, bl_levels)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">!                          ! Tendencies from microphys within BL levels</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">!                          ! (TL, K/s; QW, kg/kg/s)</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">! Radiation fields 1. SW &amp; common with LW.</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;     &amp;  photosynth_act_rad(row_length, rows)                            &amp;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                             <span class="comment">! Net downward</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">!                                 shortwave radiation in band 1 (w/m2).</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;     &amp;, rad_hr(row_length, rows, 2, bl_levels)                          &amp;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                               <span class="comment">!</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">!                               ! BL radiative (LW,SW) heating rates</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;     &amp;, surf_radflux(row_length, rows, nice_use)                        &amp;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;     &amp;, dolr(row_length, rows)                                          &amp;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                    <span class="comment">! TOA - surface upward LW</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;     &amp;, sw_tile(land_points, ntiles)<span class="comment">! Surface net SW on land tiles</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">! Position of greenhouse gases in tracer_ukca array</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: ngrgas</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: grgas_addr(ngrgas)</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">! UKCA cloud drop number concentration dimensions</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: cdnc_dim1</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: cdnc_dim2</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: cdnc_dim3</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">!  Additional variables for SCM diagnostics (dummy in full UM)</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;     &amp;  nSCMDpkgs             <span class="comment">! No of SCM diagnostics packages</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordtype">Logical</span>                                                           &amp;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;     &amp;  L_SCMDiags(nSCMDpkgs) <span class="comment">! Logicals for SCM diagnostics packages</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keywordtype">CHARACTER(LEN=72)</span>                                                      &amp;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;     &amp;   cmessage</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;     &amp;  Error_code</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   <span class="keywordtype">REAL</span>, <span class="keywordtype">INTENT(IN)</span>:: w(wdims_s%i_start:wdims_s%i_end,                  &amp;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        wdims_s%j_start:wdims_s%j_end,                  &amp;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        wdims_s%k_start:wdims_s%k_end)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">! === End of arguments ==============================================</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">! Local parameters:</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordtype">CHARACTER(LEN=*)</span> RoutineName</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <a class="code" href="namespaceukca__radaer__struct__mod.xhtml#a7b11899c3ce190bb3d00d3a633af780e">parameter</a>(   routinename=<span class="stringliteral">&#39;Atm_Physics1&#39;</span>)</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;     &amp;  amp                                                             &amp;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                        <span class="comment">! amplitude of diurnal variation in tracers</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;     &amp;, tau_decay                                                       &amp;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                        <span class="comment">! time constant for decay of tracer to clim</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;     &amp;, clim_murk_land                                                  &amp;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                        <span class="comment">! climatological murk value over land points</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;     &amp;, clim_murk_sea   <span class="comment">! climatological murk value over sea points</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <a class="code" href="namespaceukca__radaer__struct__mod.xhtml#a7b11899c3ce190bb3d00d3a633af780e">parameter</a>(                                                       &amp;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;     &amp;            amp=0.7                                               &amp;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;     &amp;,           tau_decay=1.728e5                                     &amp;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;     &amp;,           clim_murk_land=25.0                                   &amp;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;     &amp;,           clim_murk_sea=12.5                                    &amp;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;     &amp;           )</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">! Local scalars:</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordtype">REAL</span> :: z0_sea    <span class="comment">! Roughness length over sea (m)      REAL :: P1      REAL :: windspeed_1(salt_dim1, salt_dim2)</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordtype">REAL</span> :: windspeed_10m(salt_dim1, salt_dim2)</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">! loop counters</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;     &amp;  i, j, k                                                         &amp;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;     &amp;, l, n</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">! local variables</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordtype">Integer</span>                                                           &amp;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;     &amp;  rhc_row_length                                                  &amp;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                        <span class="comment">! Row length for RHcrit array</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;     &amp;, rhc_rows                                                        &amp;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                        <span class="comment">! Row number for RHcrit array</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;     &amp;, lspice_dim1,lspice_dim2,lspice_dim3                             &amp;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">!                       ! Required for array dimensions MCR_CTL2</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;     &amp;, sulp_dim1                                                       &amp;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                                <span class="comment">! dimensions for sulphate arrays in</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;     &amp;, dust_dim1                                                       &amp;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                                <span class="comment">! dimensions for mineral dust arrays i</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;     &amp;, dust_dim2                                                       &amp;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                <span class="comment">! in rad_ctl</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;     &amp;, biogenic_dim1                                                   &amp;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                                <span class="comment">! dimensions of biogenic arrays in</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;     &amp;, biogenic_dim2                                                   &amp;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                                <span class="comment">!</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;     &amp;, sulp_dim2                                                       &amp;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                                <span class="comment">!   RAD_CTL</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;     &amp;, soot_dim1, soot_dim2                                            &amp;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                <span class="comment">! dimensions of soot arrays in RAD_CTL</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;     &amp;, bmass_dim1, bmass_dim2                                          &amp;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                <span class="comment">! dimensions of biomass arrays in radn</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;     &amp;, ocff_dim1, ocff_dim2                                            &amp;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                                <span class="comment">! dimensions of OCFF arrays in radiation</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;     &amp;, nitrate_dim1, nitrate_dim2                                      &amp;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                <span class="comment">! dimensions of nitrate arrays in radn</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;     &amp;, arcl_dim1, arcl_dim2                                            &amp;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                     <span class="comment">! dimensions of aerosol clim for NWP arrays in radn</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;     &amp;, ukca_dim1, ukca_dim2                                            &amp;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                     <span class="comment">! dimensions of UKCA_RADAER arrays in RAD_CTL</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;     &amp;, i_start                                                         &amp;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                        <span class="comment">! Row start point for polar row tidying</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;     &amp;, istat           <span class="comment">! Status (error code) indicator</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">! Local data arrays</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;     &amp;  dirpar_local(row_length, rows)                                  &amp;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;     &amp;, u_1(salt_dim1, salt_dim2)                                       &amp;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;     &amp;, v_1(salt_dim1, salt_dim2)                                       &amp;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;     &amp;, co2_3D(co2_dim_len, co2_dim_row, co2_dim_lev)                   &amp;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;     &amp;, u_1_mean                                                        &amp;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;     &amp;, v_1_mean                                                        &amp;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;     &amp;, frac_control(land_points,ntype)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">! local arrays for a 10m windspeed on the p grid on sea points:</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">! Needed for radiation, sea salt and DMS:</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordtype">REAL</span> ::                                                                  &amp;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        height_theta(pdims%i_len, pdims%j_len, pdims%k_len),                   &amp;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">!          theta level centre height above surface</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        height_rho_1(pdims%i_len, pdims%j_len),                                &amp;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">!          theta level 1 rho centre height above surface</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        u_l1p(pdims%i_len, pdims%j_len),                                       &amp;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">!          u wind on level 1, on the p grid</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        v_l1p(pdims%i_len, pdims%j_len),                                       &amp;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">!          v wind on level 1, on the p grid</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        ws_l1p(pdims%i_len, pdims%j_len),                                      &amp;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">!          wind speed on level 1, on the p grid</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        p_l1_sea(pdims%i_len, pdims%j_len),                                    &amp;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">!          10m, in logspace with roughness, on the p grid, for sea points</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        ws_10m_sea(pdims%i_len, pdims%j_len)</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">!          wind speed at 10m, on the p grid, calculated for sea points</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="keywordtype">REAL</span> :: u_1_arr(1), v_1_arr(1)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="keywordtype">REAL</span> :: T_n   (tdims%i_start:tdims%i_end,        &amp;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                     tdims%j_start:tdims%j_end,        &amp;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                                 1:tdims%k_end)      <span class="keywordtype">REAL</span> :: q_n   (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                     qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                 1:qdims%k_end)       <span class="keywordtype">REAL</span> :: qcl_n (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                     qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                 1:qdims%k_end)            <span class="keywordtype">REAL</span> :: qcf_n (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                     qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                 1:qdims%k_end)            <span class="keywordtype">REAL</span> :: cf_n  (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                     qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                 1:qdims%k_end)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordtype">REAL</span> :: cfl_n (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                     qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                 1:qdims%k_end)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="keywordtype">REAL</span> :: cff_n (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                     qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                 1:qdims%k_end)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordtype">REAL</span> :: u_on_p(pdims%i_start:pdims%i_end,            &amp;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                     pdims%j_start:pdims%j_end,            &amp;                     pdims%k_start:pdims%k_end)      REAL :: v_on_p(pdims%i_start:pdims%i_end,            &amp;                     pdims%j_start:pdims%j_end,            &amp;                     pdims%k_start:pdims%k_end)</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="keywordtype">REAL</span> :: theta_inc (tdims%i_start:tdims%i_end,        &amp;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                         tdims%j_start:tdims%j_end,        &amp;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                     1:tdims%k_end)      <span class="keywordtype">REAL</span> :: q_inc     (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                         qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                     1:qdims%k_end)       <span class="keywordtype">REAL</span> :: qcl_inc   (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                         qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                     1:qdims%k_end)            <span class="keywordtype">REAL</span> :: qcf_inc   (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                         qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                     1:qdims%k_end)            <span class="keywordtype">REAL</span> :: cf_inc    (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                         qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                     1:qdims%k_end)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordtype">REAL</span> :: cfl_inc   (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                         qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                     1:qdims%k_end)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordtype">REAL</span> :: cff_inc   (qdims%i_start:qdims%i_end,        &amp;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                         qdims%j_start:qdims%j_end,        &amp;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                     1:qdims%k_end)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">! Potential droplet number (includes values where cloud not present)</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordtype">REAL</span> :: n_drop_pot(qdims%i_start : qdims%i_end,                   &amp;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                         qdims%j_start : qdims%j_end,                   &amp;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                     1 : qdims%k_end )</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">! COSP variables</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordtype">TYPE</span>(cosp_config)     :: cosp_cfg     <span class="comment">! Configuration options</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordtype">TYPE</span>(cosp_gridbox)    :: cosp_gbx     <span class="comment">! Gridbox-mean inputs</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordtype">INTEGER</span> :: cosp_npoints</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keywordtype">LOGICAL</span> :: L_cosp_call</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">! Local Arrays to store additional microphysics fields if in use</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordtype">Real</span>, <span class="keywordtype">Dimension (:,:,:)</span>, <span class="keywordtype">Allocatable</span> ::                           &amp;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;     &amp;  qcf2_n,   qrain_n,   qgraup_n                                   &amp;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;     &amp;, qcf2_inc, qrain_inc, qgraup_inc                                 &amp;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;     &amp;, T_inc_diag,  q_inc_diag,   qcl_inc_diag, qcf_inc_diag           &amp;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;     &amp;, cf_inc_diag, cfl_inc_diag, cff_inc_diag</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;     &amp;  p_layer_boundaries(row_length, rows, 0:model_levels)            &amp;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;              <span class="comment">! pressure at layer boundaries. Same as p except at</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;              <span class="comment">! bottom level = pstar, and at top = 0.</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;     &amp;, p_layer_centres(row_length, rows, 0:model_levels)               &amp;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;              <span class="comment">! pressure at layer centres. Same as p_theta_levels</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;              <span class="comment">!except bottom level = pstar, and at top = 0.</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;     &amp;, exner_layer_boundaries(row_length, rows, 0:model_levels)        &amp;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;     &amp;, exner_layer_centres(row_length, rows, 0:model_levels)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keywordtype">Real</span> :: moist                                                     &amp;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                 (qdims_l%i_start:qdims_l%i_end,        &amp;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                  qdims_l%j_start:qdims_l%j_end,        &amp;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                  qdims_l%k_start:qdims_l%k_end)</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="comment">! holds total moisture for conversion from wet to dry density</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordtype">REAL</span> :: unscaled_dry_rho(pdims_s%i_start:pdims_s%i_end,  &amp;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                               pdims_s%j_start:pdims_s%j_end,  &amp;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                               pdims_s%k_start:pdims_s%k_end)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="comment">! unscaled dry density</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <span class="keywordtype">Real</span> :: weight1</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordtype">Real</span> :: weight2</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <span class="keywordtype">Real</span> :: weight3</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keywordtype">Real</span> :: temp</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">TARGET</span>, <span class="keywordtype">ALLOCATABLE</span> ::                                      &amp;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        ext_p_layer_centres(:,:,:),                                     &amp;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        ext_tl(:,:,:),                                                  &amp;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        ext_ql(:,:,:),                                                  &amp;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        ext_qcf(:,:,:),                                                 &amp;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        ext_ice_frac(:,:),                                              &amp;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        ext_land_frac(:,:)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordtype">INTEGER</span> :: i_field   <span class="comment">! field counter for multivar swapbounds</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordtype">TYPE</span>(<a class="code" href="structswapable__field__mod_1_1swapable__field__pointer__type.xhtml">swapable_field_pointer_type</a>) :: fields_to_swap(4)                           <span class="comment">! mv swapbounds</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordtype">REAL</span>                                                              &amp;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;     &amp; FLAND(LAND_POINTS)                                               &amp;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                   <span class="comment">! Land fraction on land points.</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;     &amp;,tstar_sea(row_length,rows)                                       &amp;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                   <span class="comment">! Open sea sfc temperature (K).</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;     &amp;,tstar_sice_cat(row_length,rows,nice_use)                         &amp;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                   <span class="comment">! Sea-ice sfc temperature (K).</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;     &amp;,land_alb(row_length,rows)                                        &amp;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                                   <span class="comment">! Mean land albedo.</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;     &amp;,sice_alb(row_length,rows)   <span class="comment">! Sea-ice albedo.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="keywordtype">LOGICAL</span>                                                           &amp;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;     &amp; land0p5(row_length, rows)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">! Diagnostics controlled by Diagnostic switches</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">! fields output by ls_cld not using stash flag</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">! Energy correction work variables</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordtype">Real</span>                                                              &amp;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;     &amp;  tot_precip_scaled(row_length, rows)                             &amp;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;     &amp;, lclf</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">! Checking moisture incrementsREAL, ALLOCATABLE ::   &amp;</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  ep1(:,:)             &amp; <span class="comment">! method 1</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; ,ep2(:,:)             &amp; <span class="comment">! method 2</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; ,ep3(:,:)             &amp; <span class="comment">! method 3</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; ,ep4(:,:)             &amp; <span class="comment">! copy of stash diagnostics i.e. precip</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; ,q_methane(:,:,:)     &amp; <span class="comment">! Methane increment</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; ,dqt(:,:,:)           &amp; <span class="comment">! total increment to moist in units (kg/kg/s)</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; ,rho_con(:,:,:)         <span class="comment">! Density *r*r (kg/m) either wet density (specfic)</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                         <span class="comment">! or dry density (mixing ratio)</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="keywordtype">REAL</span> ::  rtimestep       <span class="comment">! 1/timestep  to convert increments to rates</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">! Temporary logicals</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="keywordtype">Logical</span>                                                           &amp;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;     &amp;  L_zero_boundaries                                               &amp;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;     &amp;, L_zero_halos                                                    &amp;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;     &amp;, L_use_dirpar</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordtype">INTEGER</span>                                                           &amp;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;     &amp;  level</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordtype">REAL</span>, <span class="keywordtype">ALLOCATABLE</span> :: grgas_field(:,:,:,:)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">!     Global topmost cloudy level</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordtype">INTEGER</span> :: global_cloud_top</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">!     Level of tropopause</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordtype">INTEGER</span> :: trindx(tdims%i_start:tdims%i_end,                      &amp;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                        tdims%j_start:tdims%j_end)</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">!     SCM Dummy variables to keep call to tropin consistent.</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="keywordtype">REAL</span> :: scm_dummy_1d(1,1), scm_dummy_2d(1,1,0:model_levels)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="keywordtype">REAL</span> ::                                                           &amp;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        sea_salt_film(salt_dim1, salt_dim2, salt_dim3),                 &amp;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">!          Film-mode sea-salt aerosol number concentration</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        sea_salt_jet(salt_dim1, salt_dim2, salt_dim3),                  &amp;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">!          Jet-mode sea-salt aerosol number concentration</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        height(salt_dim1, salt_dim2, salt_dim3)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">!          Layer-centre height above surface</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordtype">REAL</span> :: ukca_cdnc(cdnc_dim1, cdnc_dim2, cdnc_dim3)<span class="comment">!          Cloud droplet number from UKCA-MODE</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keywordtype">REAL</span> :: land_fract(tdims%i_start:tdims%i_end,                     &amp;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                         tdims%j_start:tdims%j_end)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordtype">CHARACTER*60</span> :: scheme_name  <span class="comment">! description for moisture checking</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordtype">INTEGER(KIND=jpim)</span>, <span class="keywordtype">PARAMETER</span> :: zhook_in  = 0</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="keywordtype">INTEGER(KIND=jpim)</span>, <span class="keywordtype">PARAMETER</span> :: zhook_out = 1</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordtype">REAL(KIND=jprb)</span>               :: zhook_handle</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">! needed for vatpoles for fv_cos_theta_latitude vs cos_theta_latitude</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="keywordtype">REAL</span>, <span class="keywordtype">POINTER</span> :: xx_cos_theta_latitude (:,:)</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_in,zhook_handle)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="keywordflow">IF</span> ( <a class="code" href="namespacedynamics__grid__mod.xhtml#a036d3b3153977d2911df89624e310dc2">l_vatpoles</a> ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;   xx_cos_theta_latitude =&gt; cos_theta_latitude</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="keywordflow">ELSE</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   xx_cos_theta_latitude =&gt; fv_cos_theta_latitude</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keywordflow">END IF</span> <span class="comment">! vatpoles</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">! ! Section INI. Initialisation of variables.</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">!       IF ( l_endgame ) THEN</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      z0_sea = 2.5e-04    <span class="comment">! Roughness length over sea (m)      P1     = ALOG(10.0/Z0_SEA)</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a1e977cd2bfc88d00f67153d185e877f8">l_mcr_qcf2</a>) <span class="keywordflow">Then</span>  <span class="comment">! Second cloud ice variable in use</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keyword">Allocate</span> ( qcf2_inc(row_length, rows, wet_levels) )</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        qcf2_inc(:,:,:) = 0.0</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keyword">Allocate</span> ( qcf2_inc(1,1,1) )</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#ad580b93fb6223c38181f3f05d1b82c62">l_mcr_qrain</a>) <span class="keywordflow">Then</span>  <span class="comment">! Prognostic rain in use</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keyword">Allocate</span> ( qrain_inc(row_length, rows, wet_levels) )</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        qrain_inc(:,:,:) = 0.0</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keyword">Allocate</span> ( qrain_inc(1,1,1) )</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a3d970e6ae2e572f69c0d3cea5b5247ce">l_mcr_qgraup</a>) <span class="keywordflow">Then</span>  <span class="comment">! Prognostic graupel in use</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="keyword">Allocate</span> ( qgraup_inc(row_length, rows, wet_levels) )</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        qgraup_inc(:,:,:) = 0.0</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keyword">Allocate</span> ( qgraup_inc(1,1,1) )</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">! Allocate arrays required for moisture conservation checking</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacedynamics__input__mod.xhtml#a7c6b718ea6d9c2ebe60128c60caab726">l_check_moist_inc</a> .AND. model_domain == <a class="code" href="namespacedomain__params.xhtml#aa4621b29b8014dcc312af1558bc008e3">mt_global</a> .AND.          &amp;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;           (<a class="code" href="namespacemphys__inputs__mod.xhtml#ab487b863e38ec5b9d292dec1c6d289b2">l_rain</a> .OR. <a class="code" href="namespaceum__input__control__mod.xhtml#a1fa66a46750b83f245bd01ed2ef36cea">l_use_methox</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="comment">! ep4 holds diagnostic eg total large-scale precipitation or</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="comment">! 0 for methane</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keyword">ALLOCATE</span> (ep1(row_length, rows) )</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keyword">ALLOCATE</span> (ep2(row_length, rows) )</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="keyword">ALLOCATE</span> (ep3(row_length, rows) )</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keyword">ALLOCATE</span> (ep4(row_length, rows) )</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="keyword">ALLOCATE</span> (rho_con(pdims_s%i_start:pdims_s%i_end,     &amp;                            pdims_s%j_start:pdims_s%j_end,     &amp;                            pdims_s%k_start:pdims_s%k_end) )</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keyword">ALLOCATE</span> (dqt(row_length, rows, model_levels) )</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="keywordflow">      END IF</span>    </div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespaceum__input__control__mod.xhtml#aa0d1cafad497e92cb3f83decaa9ab994">l_triffid</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">! Increment counter for number of atmosphere timesteps since last</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">! call to TRIFFID vegetation model</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        asteps_since_triffid = asteps_since_triffid + 1</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">! map JULES prognostics to module prognostics before use</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        snowdepth = snowdepth_p</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">IF</span> (l_flake_model) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <a class="code" href="arg__atm__fields_8h.xhtml#a077e96931fd6272adb443f0dda543638">lake_h_ice</a> = lake_h_ice_p</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">!$OMP  PARALLEL DEFAULT(SHARED) PRIVATE(i, j, k, l, weight2, weight1,   &amp;!$OMP&amp; weight3, temp)</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">! set p at layer boundaries.</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">! NB: some arrays have haloes but are unset, if never used they will</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">!     be removed.</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;          p_layer_boundaries(i,j,0) = p_star(i,j)</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;          p_layer_centres(i,j,0) = p_star(i,j)</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;          exner_layer_boundaries(i,j,0) = (p_layer_boundaries(i,j,0)/   &amp;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;     &amp;                                     p_zero)**kappa</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;          exner_layer_centres(i,j,0) = exner_layer_boundaries(i,j,0)</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, model_levels - 1</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            p_layer_boundaries(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = p(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>+1)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            p_layer_centres(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = <a class="code" href="varcld_8h.xhtml#acd7a57e90bb1e737ecae71f1c1830ad6">p_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            exner_layer_boundaries(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = exner_rho_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>+1)</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            exner_layer_centres(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = exner_theta_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = model_levels</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;          p_layer_boundaries(i,j,model_levels) = 0.0</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          p_layer_centres(i,j,model_levels) =                           &amp;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;     &amp;                           <a class="code" href="varcld_8h.xhtml#acd7a57e90bb1e737ecae71f1c1830ad6">p_theta_levels</a>(i,j,model_levels)</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;          exner_layer_boundaries(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;          exner_layer_centres(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = exner_theta_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)! Height of rho level 1 above the surface      DO j = pdims%j_start, pdims%j_end</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="keywordflow">DO</span> i = pdims%i_start, pdims%i_end</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            height_rho_1(i,j) = <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i-halo_i, j-halo_j, 1) -          &amp;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                                <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i-halo_i, j-halo_j, 0)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">! Height of theta levels above the surface (without orography)</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = pdims%k_start, pdims%k_end</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordflow">DO</span> j = pdims%j_start, pdims%j_end</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;          <span class="keywordflow">DO</span> i = pdims%i_start, pdims%i_end</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            height_theta(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) - <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,0)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, tdims%k_end</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">DO</span> j = tdims%j_start, tdims%j_end</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          <span class="keywordflow">DO</span> i = tdims%i_start, tdims%i_end</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, qdims%k_end</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="keywordflow">DO</span> j = qdims%j_start, qdims%j_end</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          <span class="keywordflow">DO</span> i = qdims%i_start, qdims%i_end</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;            cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;            cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = udims_s%k_start, udims_s%k_end</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">DO</span> j = udims_s%j_start, udims_s%j_end</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;          <span class="keywordflow">DO</span> i = udims_s%i_start, udims_s%i_end</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            u_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;     <span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = vdims_s%k_start, vdims_s%k_end</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        <span class="keywordflow">DO</span> j = vdims_s%j_start, vdims_s%j_end</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          <span class="keywordflow">DO</span> i = vdims_s%i_start, vdims_s%i_end</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            v_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">DO</span> j = tdims%j_start, tdims%j_end</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">DO</span> i = tdims%i_start, tdims%i_end</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;          land_fract(i,j) = 0.0</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment">! ! Set Coastal tiling dependent prognostics:</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">!       IF(L_CTILE)THEN</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordflow">DO</span> j = 1, rows</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            tstar_sea(i,j)=tstar_sea_ctile(i,j)</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            land_alb(i,j)=land_alb_ctile(i,j)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            sice_alb(i,j)=sice_alb_ctile(i,j)</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            land0p5(i,j)=.false.</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="keywordflow">          ENDDO</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="keywordflow">        ENDDO</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, nice_use</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <span class="keywordflow">DO</span> j = 1, rows</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;              tstar_sice_cat(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)=tstar_sice_ctile(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="keywordflow">            ENDDO</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="keywordflow">          ENDDO</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="keywordflow">        ENDDO</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">DO</span> l=1,land_points</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;          j=(<a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>(l)-1)/row_length + 1</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;          i = <a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>(l) - (j-1)*row_length</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          fland(l)=fland_ctile(l)</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;          <span class="keywordflow">IF</span>(fland(l) &gt;= 0.5)land0p5(i,j)=.true.</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;          land_fract(i,j) = fland(l)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="keywordflow">        ENDDO</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">! No coastal tiling so land fraction is just 1 for all land points.</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="keywordflow">DO</span> l=1,land_points</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          j=(<a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>(l)-1)/row_length + 1</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          i = <a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>(l) - (j-1)*row_length</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          fland(l) = 1.0</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;          land_fract(i,j) = 1.0</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="keywordflow">        ENDDO</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)!(Note, nice_use must = 1 if not using coastal tiling)</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <span class="keywordflow">DO</span> j = 1, rows</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            <span class="keywordflow">IF</span>(.NOT.land_sea_mask(i,j))<span class="keywordflow">THEN</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;              <span class="keywordflow">IF</span>(ice_fract(i,j) &lt;= 0.0)<span class="keywordflow">THEN</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                tstar_sea(i,j)=t_surf(i,j)</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                tstar_sice_cat(i,j,1)=t_surf(i,j)</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;              <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                tstar_sea(i,j)=tfs</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                tstar_sice_cat(i,j,1)=(t_surf(i,j)             &amp;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;     &amp;            -(1.-ice_fract(i,j))*tstar_sea(i,j))         &amp;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                      /ice_fract(i,j)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="keywordflow">              ENDIF</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;              tstar_sea(i,j)=t_surf(i,j)</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;              tstar_sice_cat(i,j,1)=t_surf(i,j)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            land0p5(i,j)=land_sea_mask(i,j)</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;            land_alb(i,j)=rmdi</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;            sice_alb(i,j)=rmdi</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keywordflow">          ENDDO</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keywordflow">        ENDDO</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">!$OMP END DO  NOWAIT</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">IF</span> (.NOT. l_endgame ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">! ! Create an unscaled dry density variable</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">! ! NOTE: Although this density variable is calculated here, it is not</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">!       actually used in this subroutine. It is, though, passed to</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">!       atmos_physics2 where it is used if L_mr_physics2 is true.</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">!       Therefore, if L_mr_physics2 is true, it is also necessary that</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">!       L_mr_physics1 also be true, so that this variable is calculated</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">!       here.</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">IF</span> (l_mixing_ratio) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <span class="keywordflow">DO</span> j = 1-halo_j, rows+halo_j</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;          <span class="keywordflow">DO</span> i = 1-halo_i, row_length+halo_i</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qcl(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qcf(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="namespacemphys__inputs__mod.xhtml#a1e977cd2bfc88d00f67153d185e877f8">l_mcr_qcf2</a>)<span class="keywordflow">THEN</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;         <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;           <span class="keywordflow">DO</span> j = 1-halo_j, rows+halo_j</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;             <span class="keywordflow">DO</span> i = 1-halo_i, row_length+halo_i</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;               moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)      = moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qcf2(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="keywordflow">             END DO</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="keywordflow">           END DO</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="namespacemphys__inputs__mod.xhtml#ad580b93fb6223c38181f3f05d1b82c62">l_mcr_qrain</a>)<span class="keywordflow">THEN</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          <span class="keywordflow">DO</span> j = 1-halo_j, rows+halo_j</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="keywordflow">DO</span> i = 1-halo_i, row_length+halo_i</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;              moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)      = moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qrain(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;           <span class="keywordflow">IF</span>(<a class="code" href="namespacemphys__inputs__mod.xhtml#a3d970e6ae2e572f69c0d3cea5b5247ce">l_mcr_qgraup</a>)<span class="keywordflow">THEN</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;          <span class="keywordflow">DO</span> j = 1-halo_j, rows+halo_j</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <span class="keywordflow">DO</span> i = 1-halo_i, row_length+halo_i</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;              moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)      = moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qgraup(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">!$OMP END DO      END IF</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordflow">DO</span> j = pdims_s%j_start, pdims_s%j_end</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;          <span class="keywordflow">DO</span> i = pdims_s%i_start, pdims_s%i_end</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            unscaled_dry_rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) /                      &amp;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;               ((1.0 + moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)) * <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)**2)</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 2, qdims_s%k_end</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <span class="keywordflow">Do</span> j = pdims_s%j_start, pdims_s%j_end</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;          <span class="keywordflow">Do</span> i = pdims_s%i_start, pdims_s%i_end</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            weight2 = <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                               &amp;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                      - <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>-1)</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            weight1 = <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                             &amp;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                      - <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            weight3 = <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                             &amp;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                      - <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>-1)</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            temp = (weight2 * moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + weight1 * moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>-1))  &amp;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                   / weight3</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            unscaled_dry_rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) /                      &amp;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;               ((1.0 + temp) * <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)**2)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = qdims_s%k_end + 1</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="keywordflow">If</span> ( <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> &lt;= pdims_s%k_end ) <span class="keywordflow">Then</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="keywordflow">Do</span> j = pdims_s%j_start, pdims_s%j_end</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          <span class="keywordflow">Do</span> i = pdims_s%i_start, pdims_s%i_end</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            weight2 = <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                               &amp;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                      - <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>-1)</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            weight1 = <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                             &amp;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                      - <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            weight3 = <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                             &amp;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                      - <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>-1)</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            temp = weight1 *  moist(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>-1) / weight3</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            unscaled_dry_rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) /                      &amp;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;               ((1.0 + temp) * <a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)**2)</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="keywordflow">      End If</span> <span class="comment">!  k &lt;= model_levels</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = qdims_s%k_end+2, pdims_s%k_end</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        <span class="keywordflow">Do</span> j = pdims_s%j_start, pdims_s%j_end</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;          <span class="keywordflow">Do</span> i = pdims_s%i_start, pdims_s%i_end</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            unscaled_dry_rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                        &amp;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                                      /(<a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)**2)</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">!$OMP END DO NOWAIT</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="keywordflow">      END IF</span>  <span class="comment">! .NOT. l_endgame</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">!$OMP END PARALLEL</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">! Initialise sea and sea-ice variables for JULES that require a land</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">! mask to be available  (also used by MOSES in the radiation scheme)</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">! Set up index for sea and sea-ice</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      ssi_pts = 0</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      ssi_index(:)=0</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          ssi_pts=ssi_pts + 1</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          <span class="keywordflow">IF</span> ( land_fract(i,j) &lt; 1.0 ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            ssi_index(ssi_pts) = (j-1)*row_length + i</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;          fssi(i,j)=1.0 - land_fract(i,j)</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">! Allocate space for and initialise sea and sea-ice indices.</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;     </div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      sea_pts = 0</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      sice_pts = 0</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      sea_index(:)=0</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      sice_index(:)=0</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      sice_frac(:)=0.0</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      sea_frac(:)=0.0</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keywordflow">DO</span> l=1,ssi_pts</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        j=(ssi_index(l)-1)/row_length + 1</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        i = ssi_index(l) - (j-1)*row_length</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="keywordflow">IF</span> (ssi_index(l) &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;          <span class="keywordflow">IF</span> (ice_fract(i,j) &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            sice_pts=sice_pts+1</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            sice_index(sice_pts)=l</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            sice_frac(l)=ice_fract(i,j)</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;          <span class="keywordflow">IF</span> (ice_fract(i,j) &lt; 1.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            sea_pts=sea_pts+1</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            sea_index(sea_pts)=l</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            sea_frac(l)=1.0 - sice_frac(l)</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">! NOTE these settings use NICE_USE not NICE so are suitable for use here and</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">! in the explicit part of the surface exchange code.  They are then updated</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">! using NICE before the call to the implicit part of the surface exchange! code</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      sice_pts_ncat(:)=0</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      sice_index_ncat(:,:)=0</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      sice_frac_ncat(:,:)=0.0</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      <span class="keywordflow">DO</span> n=1,nice_use</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">DO</span> l=1,ssi_pts</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;          j=(ssi_index(l)-1)/row_length + 1</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;          i = ssi_index(l) - (j-1)*row_length</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;          <span class="keywordflow">IF</span> (ssi_index(l) &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            <span class="keywordflow">IF</span> (ice_fract_cat(i,j,n) &gt; 0.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;              sice_pts_ncat(n)=sice_pts_ncat(n)+1</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;              sice_index_ncat(sice_pts_ncat(n),n)=l</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;              sice_frac_ncat(l,n)=ice_fract_cat(i,j,n)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment">! Interpolate the u and v winds to produce a 10m wind speed (for the radiation</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">! scheme, sea salt and DMS emission):</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">! calculate level 1 winds on p points using subroutine</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">! that deals with grids and halos</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespaceuv__p__pnts__mod.xhtml#a77af7b445716f46b5c0d91245f367c57">uv_p_pnts_halo</a>(u(:,:,udims%k_start), v(:,:,vdims%k_start),          &amp;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                          cos_theta_longitude, sin_theta_longitude,            &amp;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                          model_domain, global_row_length, gc_proc_row_group,  &amp;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                          u_l1p, v_l1p)</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">! calculate level 1 windspeed (NB on rho levels)</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="keywordflow">DO</span> j = pdims%j_start, pdims%j_end</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">DO</span> i = pdims%i_start, pdims%i_end</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          ws_l1p(i,j)=sqrt(u_l1p(i,j)**2 + v_l1p(i,j)**2)</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment">! Adjust level 1 windspeed to be 10m windspeed      DO j = pdims%j_start, pdims%j_end</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">DO</span> i = pdims%i_start, pdims%i_end</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          p_l1_sea(i,j) = alog(10.0 / z0m_sea(i,j))</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">DO</span> j = pdims%j_start, pdims%j_end</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="keywordflow">DO</span> i = pdims%i_start, pdims%i_end</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;          ws_10m_sea(i,j) = ws_l1p(i,j) * p_l1_sea(i,j) /                      &amp;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                            (alog(height_rho_1(i,j) / z0m_sea(i,j)) )</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="keywordflow">      END DO</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">! ! Section ENG.1  Add energy correction increments to temperature</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">! ! DEPENDS ON: timer</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Energy Correct.&#39;</span>,5)</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespaceeng__corr__inputs__mod.xhtml#afa85786376e90acd7e63aafb5fda1028" title="=========================================================================== LOGICAL options set from ...">l_emcorr</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">If</span> (<a class="code" href="namespaceeng__corr__inputs__mod.xhtml#a30fca5235cd511b8789c3817af33e02f">lflux_reset</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">! reinitialise net flux field at beginning of energy correction period</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;              <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;              sum_eng_fluxes(i,j)=0.0</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;              sum_moist_flux(i,j)=0.0</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="keywordflow">            Enddo</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="keywordflow">          Enddo</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="keywordflow">        Endif</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">! Add energy correction increments every timestep.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">! This is a temperature increment</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <span class="keyword">Call </span><a class="code" href="namespaceadd__eng__corr__mod.xhtml#a8e04db0cfd29656fbd3d715a20951c8d">add_eng_corr</a> (energy_correction,theta_inc,                 &amp;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="preprocessor"></span>     &amp;                         stashwork14)</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="keywordflow">      End If</span>    <span class="comment">! (L_emcorr)</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Energy Correct.&#39;</span>,6)</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">! ! Section Set-up time-level n</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">!      Do k =             1, tdims%k_end</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <span class="keywordflow">Do</span> j = tdims%j_start, tdims%j_end</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;          <span class="keywordflow">Do</span> i = tdims%i_start, tdims%i_end</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            t_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = theta(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) * exner_theta_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> =             1, qdims%k_end</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="keywordflow">Do</span> j = qdims%j_start, qdims%j_end</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          <span class="keywordflow">Do</span> i = qdims%i_start, qdims%i_end</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            q_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            qcl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcl(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            qcf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcf(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            cf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)  = cf(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            cfl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cfl(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            cff_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cff(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacecloud__inputs__mod.xhtml#abf452096a63f1efd4b3777a0368f544f" title="=========================================================================== INTEGER options set from ...">pc2_falliceshear_method</a> == real_shear) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceu__to__p__mod.xhtml#abec25da0a0e72ae2bd1efd5a110125fb">u_to_p</a> (u, udims_s%i_start,udims_s%i_end,                  &amp;                      udims_s%j_start,udims_s%j_end,                     &amp;                     pdims%i_start,pdims%i_end,                         &amp;                      pdims%j_start,pdims%j_end,                         &amp;                     model_levels,                                      &amp;                     model_domain,at_extremity, u_on_p)</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespacev__to__p__mod.xhtml#a071d83a5fb4aa87adbf487a6218a3037">v_to_p</a> (v, vdims_s%i_start,vdims_s%i_end,                  &amp;                      vdims_s%j_start,vdims_s%j_end,                     &amp;                     pdims%i_start,pdims%i_end,                         &amp;                      pdims%j_start,pdims%j_end,                         &amp;                     model_levels,                                      &amp;                     model_domain,at_extremity, v_on_p)</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="keywordflow">IF</span> (.NOT. <a class="code" href="namespacedynamics__grid__mod.xhtml#a036d3b3153977d2911df89624e310dc2">l_vatpoles</a>) <span class="keywordflow">THEN</span>    <span class="comment">! set polar values of u and v to zero.        IF (model_domain  ==  mt_global) THEN          IF (at_extremity(psouth)) THEN            DO k = 1, model_levels              DO i = 1, row_length                v_on_p(i,pdims%j_start,k) = 0.0                u_on_p(i,pdims%j_start,k) = 0.0              END DO            END DO          END IF          IF (at_extremity(pnorth)) THEN            DO k = 1, model_levels              DO i = 1, row_length                v_on_p(i,pdims%j_end,k) = 0.0                u_on_p(i,pdims%j_end,k) = 0.0              END DO            END DO          END IF        END IF  ! model_domain  ==  mt_globalEND IF ! vatpoles</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="keywordflow">      END IF</span> <span class="comment">! pc2_falliceshear_method</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespaceum__input__control__mod.xhtml#afcfb603e4c2bcc2bf5d129963425fbbb">l_co2_interactive</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;       <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, co2_dim_lev</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;         <span class="keywordflow">Do</span> j = 1, co2_dim_row</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;           <span class="keywordflow">Do</span> i = 1, co2_dim_len</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;             co2_3d(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = co2(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="keywordflow">           End Do</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="keywordflow">         End Do</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="keywordflow">       End Do</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;       co2_3d(1,1,1) = 0.0</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a1e977cd2bfc88d00f67153d185e877f8">l_mcr_qcf2</a>) <span class="keywordflow">Then</span>  <span class="comment">! Second cloud ice variable in use</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="keyword">Allocate</span> ( qcf2_n(row_length, rows, wet_levels) )</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        qcf2_n(:,:,:) = qcf2(1:row_length, 1:rows, 1:wet_levels)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        <span class="keyword">Allocate</span> ( qcf2_n(1,1,1) )</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#ad580b93fb6223c38181f3f05d1b82c62">l_mcr_qrain</a>) <span class="keywordflow">Then</span>  <span class="comment">! Prognostic rain in use</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="keyword">Allocate</span> ( qrain_n(row_length, rows, wet_levels) )</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        qrain_n(:,:,:) = qrain(1:row_length, 1:rows, 1:wet_levels)</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <span class="keyword">Allocate</span> ( qrain_n(1,1,1) )</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a3d970e6ae2e572f69c0d3cea5b5247ce">l_mcr_qgraup</a>) <span class="keywordflow">Then</span>  <span class="comment">! Prognostic graupel in use</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <span class="keyword">Allocate</span> ( qgraup_n(row_length, rows, wet_levels) )</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        qgraup_n(:,:,:) = qgraup(1:row_length, 1:rows, 1:wet_levels)</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="keyword">Allocate</span> ( qgraup_n(1,1,1) )</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      <span class="keywordflow">If</span> ( model_domain == <a class="code" href="namespacedomain__params.xhtml#a32ade8b8e805ef6caf02488733321774">mt_lam</a> .and. l_lbc_old ) <span class="keywordflow">Then</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">! In the LAM set qcl_n, qcf_n and cloud fractions to zero on model</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">! boundaries. This avoids failures due to inconsistences in these fields.</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">! As the increments on the boundary are purely from the boundary</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">! conditions we are free to do anything sensible to these values.</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">! Note that this only applies to the variables in the physics.</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        l_zero_boundaries=.true.</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        l_zero_halos=.false.</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,qcl_n,               &amp;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,qcf_n,               &amp;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a1e977cd2bfc88d00f67153d185e877f8">l_mcr_qcf2</a>)                                                 &amp;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                        <span class="comment">! prognostic second cloud ice in use</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;     &amp;   <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                  &amp;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;     &amp;    row_length,rows,0,0,wet_levels,fld_type_p,qcf2_n,             &amp;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;     &amp;    1, at_extremity,                                              &amp;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;     &amp;    l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#ad580b93fb6223c38181f3f05d1b82c62">l_mcr_qrain</a>)                                                &amp;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                         <span class="comment">! prognostic rain in use</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;     &amp;   <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                  &amp;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;     &amp;    row_length,rows,0,0,wet_levels,fld_type_p,qrain_n,            &amp;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;     &amp;    1, at_extremity,                                              &amp;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;     &amp;    l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keywordflow">If</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a3d970e6ae2e572f69c0d3cea5b5247ce">l_mcr_qgraup</a>)                                               &amp;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                          <span class="comment">! prognostic graupel in use</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;     &amp;   <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                  &amp;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;     &amp;    row_length,rows,0,0,wet_levels,fld_type_p,qgraup_n,           &amp;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;     &amp;    1, at_extremity,                                              &amp;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;     &amp;    l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,                     &amp;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;     &amp;   area_cloud_fraction,                                           &amp;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,                     &amp;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;     &amp;   cf_n,                                                          &amp;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,                     &amp;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;     &amp;   cfl_n,                                                         &amp;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,                     &amp;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;     &amp;   cff_n,                                                         &amp;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="keywordflow">      End If</span> <span class="comment">!  model_domain == mt_LAM .and. L_lbc_old</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment">! ! Section Communications.</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment">!     Find the tropopause level</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">!           IF ( (l_rad_step_diag.OR.l_rad_step_prog).AND.                    &amp;</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">!       If climatological aerosols are present, or if any diagnostics!       for fluxes at the tropopause are requested, or if any !       stratospheric aerosol optical depth diagnostics are requested, !       or if aerosol properties are to switch to sulphuric acid in !       the stratosphere, then it is necessary to find the tropopause.        ( l_climat_aerosol.OR.                                          &amp;</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;          sf_calc(237,1).OR.sf_calc(238,1).OR.                          &amp;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;          sf_calc(237,2).OR.sf_calc(238,2).OR.                          &amp;          sf_calc(251,2).OR.sf_calc(252,2).OR.                          &amp;          sf_calc(253,2).OR.sf_calc(254,2).OR.                          &amp;          sf_calc(255,2).OR.sf_calc(256,2).OR.                          &amp;          l_ukca_radaer_sustrat) ) then<span class="comment">!       The variables min_trop_level and max_trop_level</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment">!       index rho-levels in the control routines,</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">!       which start from a zeroth level at the surface.</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">!       Layer boundaries in physical routines are indexed with</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">!       the convention that the lowest is indexed by 1.</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">!       Since the first rho-level is omitted from the physics</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment">!       grid, the two methods of indexing refer to the same</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">!       horizontal level from the second rho-level upwards,</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">!       so there is actually no need to adjust these variables</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">!       for the change of indexing convention.</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">!       Set SCM dummy values to zero</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        scm_dummy_1d(:,:)   = 0.0</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        scm_dummy_2d(:,:,:) = 0.0</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment">! DEPENDS ON: tropin</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="keyword">CALL </span><a class="code" href="tropin_8f90.xhtml#a63948337840c01458102bf60cb06d23a" title="LL SUBROUTINE TROPIN LL SUBROUTINE TROPIN LL LL Purpose: Finds the tropopause &amp; returns index of wher...">tropin</a> (t_n, exner_rho_levels,                             &amp;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;          exner_theta_levels(:,:,1:tdims%k_end),                        &amp;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;          row_length, rows, model_levels, offx, offy,                   &amp;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;          at_extremity,scm_dummy_1d,scm_dummy_2d,                       &amp;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;          min_trop_level, max_trop_level, trindx )</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespacefsd__parameters__mod.xhtml#aab93ffe227d865add4022adcd0cd279c" title="Constant parameters required for parametrization of FSD. ">set_fsd_parameters</a>(                                          &amp;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment">!       Model dimensions.</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        row_length, rows, n_cca_levels, offx, offy,                     &amp;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">!       Properties of clouds</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        cca_dp, cca_md, cca_sh, xx_cos_theta_latitude,                  &amp;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="comment">!       Model switches</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        l_rad_step_diag, l_rad_step_prog, at_extremity, model_domain,   &amp;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">!       Error information</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        error_code  )</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">!     Generate sub-grid cloud field</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">!     -! DEPENDS ON: open_cloud_gen</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      <span class="keyword">CALL </span>open_cloud_gen (                                             &amp;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">!       Parallel variables</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        global_row_length, global_rows,                                 &amp;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        <a class="code" href="namespaceum__parcore.xhtml#aa2c9f33748c85a26e676730601ad75d9" title="Note: These vars were formally part of parvars, but do not &#39;switch&#39; with decomposition, and hence were inappropriately homed there, and also cause circular dependencies when used from very basic routines. ">mype</a>,n_proc, at_extremity,                                      &amp;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">!       Model dimensions.</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        row_length, rows, model_levels, wet_levels,                     &amp;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        row_length*rows, p_layer_centres, offx, offy,                   &amp;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">!       Properties of clouds</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        area_cloud_fraction, <a class="code" href="namespacerad__input__mod.xhtml#a0747f3861b22fa65edfb7869152d42c7">dp_corr_strat</a>, cct, global_cloud_top,      &amp;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        cca, n_cca_levels, ccw, qcl_n, qcf_n, xx_cos_theta_latitude,    &amp;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">!       Model switches</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        l_rad_step_diag, l_rad_step_prog, model_domain,                 &amp;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">!       Time stepping information.</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        val_year, val_day_number, val_hour, val_minute, val_second,     &amp;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">!       Error information</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        error_code  )</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">!     Diagnostic RHcrit</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="comment">!     -      IF (l_rhcpt) THEN</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment">!       Dimension diagnostic 3D RHcrit array</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        rhc_row_length = qdims%i_end - qdims%i_start + 1</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        rhc_rows       = qdims%j_end - qdims%j_start + 1</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_p_layer_centres(0:rhc_row_length+1,0:rhc_rows+1,     &amp;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                                               0:qdims%k_end))</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_tl(0:rhc_row_length+1, 0:rhc_rows+1, 1: qdims%k_end))</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_ql(0:rhc_row_length+1, 0:rhc_rows+1, 1: qdims%k_end))</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_qcf(0:rhc_row_length+1,0:rhc_rows+1, 1: qdims%k_end))</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_ice_frac(0:rhc_row_length+1,0:rhc_rows+1))</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_land_frac(0:rhc_row_length+1,0:rhc_rows+1))</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">!$OMP PARALLEL DEFAULT(SHARED) PRIVATE(i,j,k)</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, qdims%k_end</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;          <span class="keywordflow">DO</span> j = 1, rhc_rows</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            <span class="keywordflow">DO</span> i = 1, rhc_row_length</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;              ext_p_layer_centres(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = p_layer_centres(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;              <span class="keywordflow">IF</span> (<a class="code" href="namespacecloud__inputs__mod.xhtml#ae04fb44426849e3f308912a8311bb53b">l_pc2</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                ext_tl(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = t_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                               &amp;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                                - (lc * qcl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) ) / cp</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                ext_ql(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qcl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;              <span class="keywordflow">ELSE</span>  <span class="comment">! l_pc2</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                ext_tl(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = t_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                ext_ql(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="keywordflow">              END IF</span>  <span class="comment">! l_pc2</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;              ext_qcf(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="keywordflow">            END DO</span> <span class="comment">! i</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="keywordflow">          END DO</span> <span class="comment">! j</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">        END DO</span> <span class="comment">! k</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">!       Rhc_rows_do2:</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)        DO j = 1, rhc_rows</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">!         Rhc_rowlen_do2:</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;          <span class="keywordflow">DO</span> i = 1, rhc_row_length</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            ext_p_layer_centres(i,j,0) = p_layer_centres(i,j,0)</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            ext_ice_frac(i,j) = ice_fract(i,j)</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            ext_land_frac(i,j) = 0.0</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="keywordflow">          END DO</span> <span class="comment">! Rhc_rowlen_do2</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="keywordflow">        END DO</span> <span class="comment">! Rhc_rows_do2</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">!$OMP DO SCHEDULE(STATIC)</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, land_points</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;          j = (<a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>(<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)-1)/( tdims%i_end - tdims%i_start + 1) + 1</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;          i = <a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>(<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) - (j-1)*( tdims%i_end - tdims%i_start + 1)</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;          ext_land_frac(i,j) = fland(<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">!$OMP END DO</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">!$OMP END PARALLEL!       Synchronize haloes.</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        i_field = 0</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        i_field = i_field + 1</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        fields_to_swap(i_field) % field    =&gt; ext_p_layer_centres(:,:,:)</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        fields_to_swap(i_field) % field_type  =  fld_type_p</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        fields_to_swap(i_field) % levels      =  qdims%k_end+1</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        fields_to_swap(i_field) % rows        =  rhc_rows</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        fields_to_swap(i_field) % vector      =  .false.</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        i_field = i_field + 1</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        fields_to_swap(i_field) % field       =&gt; ext_tl(:,:,:)</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        fields_to_swap(i_field) % field_type  =  fld_type_p</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        fields_to_swap(i_field) % levels      =  qdims%k_end</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        fields_to_swap(i_field) % rows        =  rhc_rows</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        fields_to_swap(i_field) % vector      =  .false.</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        i_field = i_field + 1</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        fields_to_swap(i_field) % field       =&gt; ext_ql(:,:,:)</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        fields_to_swap(i_field) % field_type  =  fld_type_p</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        fields_to_swap(i_field) % levels      =  qdims%k_end</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        fields_to_swap(i_field) % rows        =  rhc_rows</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        fields_to_swap(i_field) % vector      =  .false.</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        i_field = i_field + 1</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        fields_to_swap(i_field) % field       =&gt; ext_qcf(:,:,:)</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        fields_to_swap(i_field) % field_type  =  fld_type_p</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        fields_to_swap(i_field) % levels      =  qdims%k_end</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        fields_to_swap(i_field) % rows        =  rhc_rows</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        fields_to_swap(i_field) % vector      =  .false.</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">! DEPENDS ON: swap_bounds_mv</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        <span class="keyword">CALL </span><a class="code" href="swap__bounds__mv-2c_8f90.xhtml#a7ec706a27cea514039111eeb3f669540" title="Direct MPI version of swap_bounds to deal with multiple variables. ">swap_bounds_mv</a>( fields_to_swap, i_field,                   &amp;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                         rhc_row_length, 1, 1)</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        i_field = 0</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        i_field = i_field + 1</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        fields_to_swap(i_field) % field_2d    =&gt; ext_land_frac(:,:)</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        fields_to_swap(i_field) % field_type  =  fld_type_p</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        fields_to_swap(i_field) % levels      =  1</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        fields_to_swap(i_field) % rows        =  rhc_rows</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        fields_to_swap(i_field) % vector      =  .false.</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        i_field = i_field + 1</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        fields_to_swap(i_field) % field_2d    =&gt; ext_ice_frac(:,:)</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        fields_to_swap(i_field) % field_type  =  fld_type_p</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        fields_to_swap(i_field) % levels      =  1</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        fields_to_swap(i_field) % rows        =  rhc_rows</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        fields_to_swap(i_field) % vector      =  .false.</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">! DEPENDS ON: swap_bounds_2d_mv</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        <span class="keyword">CALL </span><a class="code" href="swap__bounds__2d__mv-2c_8f90.xhtml#a1180e478d1c8e7141d38eaf14d2c021d" title="Direct MPI version of swap_bounds to deal with multiple variables. ">swap_bounds_2d_mv</a>( fields_to_swap, i_field,                &amp;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                         rhc_row_length, 1, 1)</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      <span class="keywordflow">ELSE</span> <span class="comment">! l_rhcpt</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">!       RHcrit will be a 1D parametrized array input from user interface</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        rhc_row_length = 1</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        rhc_rows = 1</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_p_layer_centres(1,1,1))</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_tl(1,1,1))</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_ql(1,1,1))</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_qcf(1,1,1))</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_ice_frac(1,1))</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="keyword">ALLOCATE</span>(ext_land_frac(1,1))</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="keywordflow">      END IF</span> <span class="comment">! l_rhcpt</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">!     Set sea salt arrays</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">!     sea_salt: IF (((l_use_seasalt_direct .OR. l_use_seasalt_indirect).AND.  &amp;</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;           (l_rad_step_diag.OR.l_rad_step_prog)) .OR.                   &amp;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            <a class="code" href="namespaceum__input__control__mod.xhtml#a60dc82b3ef873c78cec7cf99537ba081" title="Use sea-salt aerosol in microphysics. ">l_use_seasalt_autoconv</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;       <span class="keywordflow">IF</span> ( l_endgame ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment">! calculate level 1 winds on p points using subroutine</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;       <span class="keyword">CALL </span><a class="code" href="namespaceuv__p__pnts__mod.xhtml#a257717be0bd93bcfece445a2a29dede3">uv_p_pnts</a>(u(0:row_length-1,1:rows,1),v(1:row_length,0:n_rows-1,1), &amp;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;         cos_theta_longitude,sin_theta_longitude,                              &amp;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;         model_domain,global_row_length,gc_proc_row_group,u_1,v_1)</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">! calculate level 1 windspeed (NB on rho levels)</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">DO</span> j = 1, rows</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;            windspeed_1(i,j)=sqrt(u_1(i,j)**2+v_1(i,j)**2)</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">! Adjust level 1 windspeed to be 10m windspeed        DO j = 1, rows</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            windspeed_10m(i,j)=windspeed_1(i,j)*p1/(alog(height_theta(i,j,1)/z0_sea))<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespaceset__seasalt__mod.xhtml#a5c36f354358226be262b60f271cd9938">set_seasalt_4a</a>(windspeed_10m, height_theta, land_fract,    &amp;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                        ice_fract,row_length, rows, model_levels,       &amp;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                        salt_dim1, salt_dim2, salt_dim3,                &amp;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                        bl_levels, sea_salt_film, sea_salt_jet)</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="keywordflow">ELSE</span>  <span class="comment">! Not l_endgame</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;         <span class="keywordflow">DO</span> j = udims%j_start, udims%j_end</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;           <span class="keywordflow">DO</span> i = udims%i_start, udims%i_end</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;             u_1(i-udims%i_start+1, j) = u(i,j,1)</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="keywordflow">           END DO</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="keywordflow">         END DO</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;         <span class="keywordflow">DO</span> j = vdims%j_start, vdims%j_end</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;           <span class="keywordflow">DO</span> i = vdims%i_start, vdims%i_end</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;             v_1(i, j-vdims%j_start+1) = v(i,j,1)</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="keywordflow">           END DO</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="keywordflow">         END DO</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      <span class="comment">!       Tidy up at North Pole; not done at South Pole as it&#39;s land.</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">!       Polar values are mean of 1st interior row:</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;         <span class="keywordflow">IF</span> (at_extremity(<a class="code" href="namespaceum__parparams.xhtml#a575a86c6ed199d617f169b0bbd20ec88">pnorth</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">!          Start point of first interior (i.e. non-polar) row:</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;           i_start  = rows - 1</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">!          Sum over points on PEs in order along first interior row:</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;           <span class="keyword">CALL </span><a class="code" href="namespaceglobal__2d__sums__mod.xhtml#ac3fe3c2679168085c4635a17e5f82215">global_2d_sums</a>(u_1(:,i_start:i_start), row_length,      &amp;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                              1, 0, 0, 1, u_1_arr, gc_proc_row_group)</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;           <span class="keyword">CALL </span><a class="code" href="namespaceglobal__2d__sums__mod.xhtml#ac3fe3c2679168085c4635a17e5f82215">global_2d_sums</a>(v_1(:,i_start:i_start), row_length,      &amp;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                              1, 0, 0, 1, v_1_arr, gc_proc_row_group)</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;           u_1_mean = u_1_arr(1) / global_row_length</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;           v_1_mean = v_1_arr(1) / global_row_length</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;            u_1(i, rows) = u_1_mean</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;            v_1(i, rows) = v_1_mean</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="keywordflow">        END IF</span> <span class="comment">! at_extremity(PNorth)</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="comment">!$OMP  PARALLEL DO SCHEDULE(STATIC) DEFAULT(NONE)                       &amp;</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment">!$OMP&amp; SHARED(height, r_theta_levels, salt_dim1, salt_dim2,             &amp;</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">!$OMP&amp; salt_dim3) PRIVATE(i, j, k)</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, salt_dim3</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;          <span class="keywordflow">DO</span> j = 1, salt_dim2</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="keywordflow">DO</span> i = 1, salt_dim1</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;              height(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                     &amp;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                            - <a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>(i,j,0)</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment">!$OMP END PARALLEL DO</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">! DEPENDS ON: set_seasalt</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="keyword">CALL </span>set_seasalt(u_1, v_1, height, land_fract, ice_fract,       &amp;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                        row_length, rows, model_levels,                 &amp;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                        salt_dim1, salt_dim2, salt_dim3,                &amp;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                        bl_levels, sea_salt_film, sea_salt_jet)</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="keywordflow">ELSE</span> <span class="comment">! l_use_seasalt_direct etc</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        sea_salt_film(1, 1, 1) = 0.0</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        sea_salt_jet( 1, 1, 1) = 0.0</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="keywordflow">      END IF</span> sea_salt <span class="comment">! l_use_seasalt_direct etc</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">!  ^^ Keep this last in the communications section</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">!     as call to set_seasalt has a load imbalance.</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">! COSP initialization before calling mycrophysics and radiation</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      l_cosp_call = .false.</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacecosp__input__mod.xhtml#ae03035077d4522b3649cdcabe1bada14">l_cosp</a>) <span class="keyword">CALL </span><a class="code" href="namespacecosp__init__mod.xhtml#acebeaebc76fc3429c12a38ba8f28e87d" title="Routine that allocates and initialises the derived types with the gridbox-mean inputs and configurati...">cosp_init</a>(<a class="code" href="namespacecosp__input__mod.xhtml#ae03035077d4522b3649cdcabe1bada14">l_cosp</a>,l_rad_step_prog,l_radiation,       &amp;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;         row_length,rows,model_levels,cosp_crain_3d,cosp_csnow_3d,p,       &amp;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;         q_n,t_n,t_surf,p_star,<a class="code" href="varcld_8h.xhtml#acd7a57e90bb1e737ecae71f1c1830ad6">p_theta_levels</a>,<a class="code" href="namespacelevel__heights__mod.xhtml#a8eaca8430445d6f606be537e668a0fa7">r_theta_levels</a>,<a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>, &amp;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="preprocessor"></span>         l_cosp_call,cosp_npoints,cosp_cfg,cosp_gbx)</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">! ! Section Microphysics. Call microphys_ctl routine</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Microphys (AP1M)&#39;</span>,5)</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="namespacemphys__inputs__mod.xhtml#ab487b863e38ec5b9d292dec1c6d289b2">l_rain</a>)<span class="keywordflow">then</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">! Only allow dynamic allocation of full space for arrays for 3D</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">! precipitation diagnostics if they are being used. Otherwise save space</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">! and give them a minimum size of 1 by 1.</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="preprocessor">#if !defined(SCMA)</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">IF</span> ( sf(222,4) .OR. sf(223,4) .OR. sf(224,4) .OR. sf(225,4)       &amp;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;     &amp;               .OR. <a class="code" href="namespacedust__parameters__mod.xhtml#ac897534dc97f74f123a81079a464283b" title="Parameters fundamental to the dust scheme!&gt; (Details of dust properties/size divisions etc...">l_dust</a>                                        &amp;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;     &amp;               .OR. sf(227,4) .OR. <a class="code" href="namespacerun__aerosol__mod.xhtml#a2a0e2fefafaaa254aac4cf8cd4a291e1" title="Control logicals for Classic aerosol options ">l_sulpc_so2</a>                    &amp;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;     &amp;               .OR. <a class="code" href="namespacerun__aerosol__mod.xhtml#a49e39d25a38244027b312e0298566110" title="Soot scheme. ">l_soot</a> .OR. <a class="code" href="namespacerun__aerosol__mod.xhtml#ab289e7ad790cc1441c12d9265336b626" title="Biomass scheme. ">l_biomass</a> .OR. <a class="code" href="namespacerun__aerosol__mod.xhtml#a08c24874ad5cdfed2445a206552c249d" title="OCFF (Organic Carbon from Fossil Fuels) scheme. ">l_ocff</a>             &amp;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;     &amp;               .OR. l_cosp_call) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        lspice_dim1 = row_length</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        lspice_dim2 = rows</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        lspice_dim3 = wet_levels</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        lspice_dim1 = 1</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        lspice_dim2 = 1</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        lspice_dim3 = 1</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="preprocessor"></span>        lspice_dim1 = row_length</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        lspice_dim2 = rows</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        lspice_dim3 = wet_levels</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment">! DEPENDS ON: microphys_ctl</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="keyword">Call </span><a class="code" href="microphys__ctl_8f90.xhtml#a84b5cd5d89cbd475c33ce5b23e71d1d5" title="Subroutine microphys_ctl. ">microphys_ctl</a> (                                              &amp;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment">! Parallel variables</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        halo_i, halo_j, offx, offy, global_row_length,                  &amp;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        at_extremity,                                                   &amp;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">! model dimensions.</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        row_length, rows, rhc_row_length, rhc_rows, n_rows,             &amp;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        land_points, model_levels, wet_levels, bl_levels,               &amp;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        lspice_dim1,lspice_dim2,lspice_dim3,                            &amp;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        salt_dim1, salt_dim2, salt_dim3,                                &amp;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        cdnc_dim1, cdnc_dim2, cdnc_dim3,                                &amp;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">! Model switches</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        ltimer, <a class="code" href="namespacecloud__inputs__mod.xhtml#a7c7136e2f41b93943e9467178bde33a9">l_rhcpt</a>, <a class="code" href="namespacedust__parameters__mod.xhtml#ac897534dc97f74f123a81079a464283b" title="Parameters fundamental to the dust scheme!&gt; (Details of dust properties/size divisions etc...">l_dust</a>,                                        &amp;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <a class="code" href="namespacerun__aerosol__mod.xhtml#a2a0e2fefafaaa254aac4cf8cd4a291e1" title="Control logicals for Classic aerosol options ">l_sulpc_so2</a>, l_sulpc_nh3, <a class="code" href="namespacerun__aerosol__mod.xhtml#a49e39d25a38244027b312e0298566110" title="Soot scheme. ">l_soot</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#ab289e7ad790cc1441c12d9265336b626" title="Biomass scheme. ">l_biomass</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#a08c24874ad5cdfed2445a206552c249d" title="OCFF (Organic Carbon from Fossil Fuels) scheme. ">l_ocff</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#a66e1005b9ceceb05bcd815d826b99c24" title="Ammonium nitrate aerosol. ">l_nitrate</a>, &amp;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        l_cosp_call,                                                    &amp;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">! Model parameters</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;        rhcrit,                                                         &amp;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">! Primary fields passed in</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        t_n, q_n, qcl_n, qcf_n, qcf2_n, qrain_n, qgraup_n,              &amp;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        cf_n, cfl_n, cff_n,                                             &amp;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        u_on_p, v_on_p, w,                                              &amp;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        snow_depth,                                                     &amp;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        land_sea_mask, ice_fract,                                       &amp;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        p_layer_centres, p_layer_boundaries,                            &amp;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        rho, aerosol, flash_pot,                                        &amp;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        ukca_cdnc,                                                      &amp;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        dust_div1, dust_div2, dust_div3,                                &amp;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        dust_div4, dust_div5, dust_div6,                                &amp;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        so2, nh3, so4_aitken, so4_accu, so4_diss,                       &amp;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        soot_agd, soot_cld, bmass_agd, bmass_cld,                       &amp;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;        ocff_agd, ocff_cld, nitr_acc, nitr_diss, biogenic,              &amp;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        sea_salt_film, sea_salt_jet, arcl,                              &amp;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">! Other fields passed in</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        ntml, cumulus,                                                  &amp;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        fland, <a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>,                                              &amp;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">! Variables for stochastic physics random parameters</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        m_ci,                                                           &amp;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">! diagnostic info</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="preprocessor"></span>        stashwork4, stashwork21,                                        &amp;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">! SCM diagnostics switches (dummy in full UM)</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        nscmdpkgs, l_scmdiags,                                          &amp;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment">! Increment fields passed in/out</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        theta_inc, q_inc, qcl_inc, qcf_inc,                             &amp;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        qcf2_inc, qrain_inc, qgraup_inc,                                &amp;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        cf_inc, cfl_inc, cff_inc,                                       &amp;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">! Fields required elsewhere</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        ls_rain, ls_snow, micro_tends, cosp_gbx, n_drop_pot,            &amp;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">! Field for Rh crit parametrization</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        ext_p_layer_centres,                                            &amp;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        ext_tl,                                                         &amp;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        ext_ql,                                                         &amp;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;        ext_qcf,                                                        &amp;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        ext_ice_frac,                                                   &amp;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        ext_land_frac,                                                  &amp;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment">! error information</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        error_code  )</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        ls_rain(:,:) = 0.0</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        ls_snow(:,:) = 0.0</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        micro_tends(:,:,:,:) = 0.0</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">! Deallocate arrays used for RH crit parametrization</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <span class="keyword">DEALLOCATE</span>(ext_land_frac)</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      <span class="keyword">DEALLOCATE</span>(ext_ice_frac)</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keyword">DEALLOCATE</span>(ext_qcf)</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="keyword">DEALLOCATE</span>(ext_ql)</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="keyword">DEALLOCATE</span>(ext_tl)</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      <span class="keyword">DEALLOCATE</span>(ext_p_layer_centres)</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Microphys (AP1M)&#39;</span>,6)</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      -      <span class="comment">! check moisture conservation for microphysics</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      -      <span class="keywordflow">IF</span> (<a class="code" href="namespacedynamics__input__mod.xhtml#a7c6b718ea6d9c2ebe60128c60caab726">l_check_moist_inc</a> .AND. model_domain == <a class="code" href="namespacedomain__params.xhtml#aa4621b29b8014dcc312af1558bc008e3">mt_global</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        <span class="comment">! ep4 holds total large-scale precipitation</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;          <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            ep4(i,j) = ls_rain(i,j) + ls_snow(i,j)</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <span class="comment">! total moist increment</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        rtimestep = 1.0/<a class="code" href="namespacetimestep__mod.xhtml#af5057870e73925950dded81acfffb0d6">timestep</a></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;          <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;            <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                          dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)+ qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)+qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;              <span class="keywordflow">IF</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#ad580b93fb6223c38181f3f05d1b82c62">l_mcr_qrain</a> ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)+qrain_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;              <span class="keywordflow">IF</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a3d970e6ae2e572f69c0d3cea5b5247ce">l_mcr_qgraup</a> ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)+qgraup_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;              <span class="keywordflow">IF</span> (<a class="code" href="namespacemphys__inputs__mod.xhtml#a1e977cd2bfc88d00f67153d185e877f8">l_mcr_qcf2</a> ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)+qcf2_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="keywordflow">              END IF</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;              dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)*rtimestep</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <span class="comment">! Need wet or dry density depending on specific or mixing ratios</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        <span class="comment">! In this subroutine rho holds a wet density, unscaled_dry_rho</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="comment">! a dry density</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <span class="keywordflow">IF</span> (l_mixing_ratio) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;          <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;            <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;              <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                rho_con(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = unscaled_dry_rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)*<a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) &amp;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                                                    *<a class="code" href="namespacelevel__heights__mod.xhtml#ab8e97e687e5779eef705ae90cbad6419">r_rho_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        <span class="keywordflow">ELSE</span>   <span class="comment">! want wet density</span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;          <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;              <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                rho_con(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="keywordflow">        END IF</span>    <span class="comment">! test on l_mixing ratio</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        scheme_name = <span class="stringliteral">&#39;Micro-physics&#39;</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespacecheck__dmoist__inc__mod.xhtml#a4748a83895589223ec70737e415da9b5">check_dmoist_inc</a>(row_length, rows, model_levels,               &amp;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                            delta_lambda,delta_phi,<a class="code" href="namespacetimestep__mod.xhtml#af5057870e73925950dded81acfffb0d6">timestep</a>,                &amp;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                            p_layer_boundaries,rho_con,                     &amp;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                            dqt,                                            &amp;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                            ep4, scheme_name,                               &amp;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                            ep1, ep2, ep3)</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="keyword">      END </span>if<span class="comment">! ! Section Turbulence. Call pc2_turbulence_ctl routine</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment">! ! Earlier versions of PC2 had the erosion term included here,</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">! parallel with the rest of the slow physics. We have since decided to</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment">! move the erosion to be parallel with the PC2 response to convection</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">! since this results in improved numerical balances in shallow</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">! convection.! In the case of PC2 using diagnostic shallow cloud it is better</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">! to do the erosion term here so the call is now under a switch for this.</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="keywordflow">IF</span> (l_pc2 .AND. l_pc2_diag_sh .AND. .NOT. l_micro_eros ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">! DEPENDS ON: pc2_turbulence_ctl</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        <span class="keyword">Call </span><a class="code" href="pc2__turbulence__ctl_8f90.xhtml#ad8e0e4d5428106db37923bb03f658859" title="Calculates the effect of changing the width of the PDF used in PC2. ">pc2_turbulence_ctl</a> (                                       &amp;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">! Primary fields passed in, unchanged on exit</span></div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;     &amp;    t_n, q_n, qcl_n, cf_n, cfl_n, cff_n                           &amp;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;     &amp;,   p_layer_centres(1,1,1),                                       &amp;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment">! diagnostic info</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="preprocessor"></span>     &amp;    stashwork4                                                    &amp;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment">! SCM diagnostics switches (dummy in full UM)</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;     &amp;,   nscmdpkgs, l_scmdiags                                         &amp;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment">! Increment fields passed in/out, updated on exit</span></div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;     &amp;,   theta_inc, q_inc, qcl_inc, cf_inc, cfl_inc)</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="keywordflow">      END IF</span>  <span class="comment">! L_pc2 and l_pc2_diag_sh</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">! ! Section RAD   Radiation scheme.</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">!               This incorporates radiation code for non-radiation</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">!               timesteps which is in CLDCTL1.dk in the UM.</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Radiation (AP1R)&#39;</span>,5)</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="comment">!  Set dimensions of mineral dust arrays for passing to rad_ctl</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <span class="keywordflow">IF</span> (l_dust) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        dust_dim1 = row_length*rows</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        dust_dim2 = model_levels</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        dust_dim1 = 1</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        dust_dim2 = 1</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">!  Set dimensions of _SULPHATE arrays for passing to RAD_CTL</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacerun__aerosol__mod.xhtml#a2a0e2fefafaaa254aac4cf8cd4a291e1" title="Control logicals for Classic aerosol options ">l_sulpc_so2</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        sulp_dim1 = rows*row_length</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        sulp_dim2 = model_levels</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        sulp_dim1 = 1</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        sulp_dim2 = 1</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="comment">!  Set dimensions of soot arrays for passing to RAD_CTL</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacerun__aerosol__mod.xhtml#a49e39d25a38244027b312e0298566110" title="Soot scheme. ">l_soot</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        soot_dim1 = rows*row_length</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        soot_dim2 = model_levels</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        soot_dim1 = 1</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        soot_dim2 = 1</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="comment">!  Set dimensions of array for aerosol climatology for NWP</span></div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="keywordflow">If</span> (n_arcl_species &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        arcl_dim1 = rows*row_length</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        arcl_dim2 = model_levels</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        arcl_dim1 = 1</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        arcl_dim2 = 1</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="comment">!  Set dimensions of biomass arrays for passing to RAD_CTL</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <span class="keywordflow">If</span> (<a class="code" href="namespacerun__aerosol__mod.xhtml#ab289e7ad790cc1441c12d9265336b626" title="Biomass scheme. ">l_biomass</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        bmass_dim1 = rows*row_length</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        bmass_dim2 = model_levels</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        bmass_dim1 = 1</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;        bmass_dim2 = 1</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="comment">!  Set dimensions of biogenic array for passing to RAD_CTL</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      <span class="keywordflow">IF</span> (l_use_biogenic) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;        biogenic_dim1 = rows*row_length</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;        biogenic_dim2 = model_levels</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        biogenic_dim1 = 1</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        biogenic_dim2 = 1</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="comment">!  Set dimensions of OCFF array for passing to RAD_CTL</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      <span class="keywordflow">If</span> (l_ocff) <span class="keywordflow">then</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        ocff_dim1 = rows*row_length</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        ocff_dim2 = model_levels</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        ocff_dim1 = 1</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        ocff_dim2 = 1</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">!  Set dimensions of nitrate aerosol array for passing to RAD_CTL</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;      <span class="keywordflow">If</span> (l_nitrate) <span class="keywordflow">then</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        nitrate_dim1 = rows*row_length</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        nitrate_dim2 = model_levels</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      <span class="keywordflow">Else</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        nitrate_dim1 = 1</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        nitrate_dim2 = 1</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="comment">!  Set dimensions of UKCA_RADAER arrays for passing to RAD_CTL</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <span class="keywordflow">IF</span> (l_ukca_radaer) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        ukca_dim1 = rows*row_length</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        ukca_dim2 = model_levels</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        ukca_dim1 = 1</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        ukca_dim2 = 1</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="comment">!     Code to calculate mixing ratio of well-mixed greenhouse gases</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="comment">!       if scenarios for their time variation have been prescribed.</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_co2) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  CO2 level calculated</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( co2_mmr,                                      &amp;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            clim_fcg_nyears(s_co2),  clim_fcg_years(1,s_co2),           &amp;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            clim_fcg_levls(1,s_co2), clim_fcg_rates(1,s_co2),           &amp;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            lenscen, error_code)</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_n2o) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  same for N2O</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( n2ommr,                                       &amp;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;             clim_fcg_nyears(s_n2o),  clim_fcg_years(1,s_n2o),          &amp;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;             clim_fcg_levls(1,s_n2o), clim_fcg_rates(1,s_n2o),          &amp;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_ch4) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  CH4</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( ch4mmr,                                       &amp;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;             clim_fcg_nyears(s_ch4),  clim_fcg_years(1,s_ch4),          &amp;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;             clim_fcg_levls(1,s_ch4), clim_fcg_rates(1,s_ch4),          &amp;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_cfc11) &gt; 0 ) <span class="keywordflow">Then</span>   <span class="comment">!  &quot;CFC11&quot;</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( c11mmr,                                       &amp;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;             clim_fcg_nyears(s_cfc11),  clim_fcg_years(1,s_cfc11),      &amp;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;             clim_fcg_levls(1,s_cfc11), clim_fcg_rates(1,s_cfc11),      &amp;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_cfc12) &gt; 0 ) <span class="keywordflow">Then</span>   <span class="comment">!  &quot;CFC12&quot;</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( c12mmr,                                       &amp;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;             clim_fcg_nyears(s_cfc12),  clim_fcg_years(1,s_cfc12),      &amp;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;             clim_fcg_levls(1,s_cfc12), clim_fcg_rates(1,s_cfc12),      &amp;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_cfc113) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  &quot;CFC113&quot;</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( c113mmr,                                      &amp;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;             clim_fcg_nyears(s_cfc113),  clim_fcg_years(1,s_cfc113),    &amp;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;             clim_fcg_levls(1,s_cfc113), clim_fcg_rates(1,s_cfc113),    &amp;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_cfc114) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  &quot;CFC114&quot;</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( c114mmr,                                      &amp;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;             clim_fcg_nyears(s_cfc114),  clim_fcg_years(1,s_cfc114),    &amp;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;             clim_fcg_levls(1,s_cfc114), clim_fcg_rates(1,s_cfc114),    &amp;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_hcfc22) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  &quot;HCFC22&quot;</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( hcfc22mmr,                                    &amp;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;             clim_fcg_nyears(s_hcfc22),  clim_fcg_years(1,s_hcfc22),    &amp;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;             clim_fcg_levls(1,s_hcfc22), clim_fcg_rates(1,s_hcfc22),    &amp;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_hfc125) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">!  &quot;HFC125&quot;</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( hfc125mmr,                                    &amp;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;             clim_fcg_nyears(s_hfc125),  clim_fcg_years(1,s_hfc125),    &amp;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;             clim_fcg_levls(1,s_hfc125), clim_fcg_rates(1,s_hfc125),    &amp;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span>            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="keywordflow">        Endif</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        <span class="keywordflow">If</span> ( clim_fcg_nyears(s_hfc134a) &gt; 0 ) <span class="keywordflow">Then</span>  <span class="comment">! &quot;HFC134a&quot;</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment">! depends on: gas_calc</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;          <span class="keyword">Call </span><a class="code" href="gas__calc_8f90.xhtml#a8fe88020248adfee44073592dffa4de7" title="Subroutine GAS_CALC!&gt; Purpose : Subroutine GAS_CALC!&gt; Purpose : Calculates the trace gas mixing ratio...">gas_calc</a> ( hfc134ammr,                                   &amp;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;             clim_fcg_nyears(s_hfc134a),  clim_fcg_years(1,s_hfc134a),  &amp;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;             clim_fcg_levls(1,s_hfc134a), clim_fcg_rates(1,s_hfc134a),  &amp;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;             lenscen, error_code)</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;          <span class="keywordflow">If</span> ( error_code /= 0 ) <span class="keywordflow">Then</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;            <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;            <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="keywordflow">          End if</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="keywordflow">        End if</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">! Copy greenhouse gases into greenhouse gas array</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      <span class="keyword">ALLOCATE</span>(grgas_field(row_length, rows, model_levels, ngrgas))</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">! check to see if UKCA is specifying trace gases, and fill fields</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      <span class="keywordflow">DO</span> i=1,ngrgas</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        <span class="keywordflow">IF</span> (grgas_addr(i) &gt; 0) grgas_field(:,:,:,i) =                   &amp;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;         tracer_ukca(1:row_length,1:rows,1:model_levels,grgas_addr(i)) </div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">! For some configurations CFC-11 is held as a lumped species, so</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">!  rescale field by the ratio of CFC-11/field at the surface</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        <span class="keywordflow">IF</span> (i == p_f11 .AND. grgas_addr(i) &gt; 0 .AND.                    &amp;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;           (l_ukca_strat .OR. l_ukca_strattrop)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;          <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=model_levels,1,-1</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;            grgas_field(:,:,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>,p_f11) = grgas_field(:,:,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>,p_f11) *       &amp;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;              c11mmr / grgas_field(:,:,1,p_f11)</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment">! For some configurations CFC-12 is held as a lumped species, so</span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment">!  rescale field by the ratio of CFC-12/field at the surface</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        <span class="keywordflow">IF</span> (i == p_f12 .AND. grgas_addr(i) &gt; 0 .AND.                    &amp;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;           (l_ukca_strat .OR. l_ukca_strattrop)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;          <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=model_levels,1,-1</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;            grgas_field(:,:,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>,p_f12) = grgas_field(:,:,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>,p_f12) *       &amp;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;              c12mmr / grgas_field(:,:,1,p_f12)</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <span class="comment">! Make sure the field if used is all positive.</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <span class="keywordflow">IF</span> (grgas_addr(i) &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;          grgas_field(:,:,:,i) = max(grgas_field(:,:,:,i),0.0)</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;          <span class="comment">! Set to RMDI if not used.</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;          grgas_field(:,:,:,i) = rmdi</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="keywordflow">      END DO</span>    <span class="comment">! Loop over grgas species</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_o3) &lt;= 0)                                        &amp;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        grgas_field(:,:,1:ozone_levels,p_o3) = ozone</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_ch4) &lt;= 0)                                       &amp;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        grgas_field(:,:,:,p_ch4) = ch4mmr          <span class="comment">! global constant</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_n2o) &lt;= 0)                                       &amp;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        grgas_field(:,:,:,p_n2o) = n2ommr          <span class="comment">! global constant</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_f11) &lt;= 0)                                       &amp;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        grgas_field(:,:,:,p_f11) = c11mmr          <span class="comment">! global constant</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_f12) &lt;= 0)                                       &amp;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        grgas_field(:,:,:,p_f12) = c12mmr          <span class="comment">! global constant</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_f113) &lt;= 0)                                      &amp;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        grgas_field(:,:,:,p_f113) = c113mmr        <span class="comment">! global constant</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordflow">IF</span> (grgas_addr(p_f22) &lt;= 0)                                       &amp;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        grgas_field(:,:,:,p_f22) = hcfc22mmr       <span class="comment">! global constant</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      grgas_field(:,:,1:wet_levels,p_h2os) =                            &amp;        q_n(1:row_length, 1:rows, :)</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="comment">!  Write trace gas mixing ratios to module for use in UKCA. The value can be!  either that which was passed to this routine or the value calculated from!  the time interpolation, depending on whether L_CLMCHFCG is true or false.       IF (L_ukca .AND.  (((i_ukca_scenario == i_ukca_scenario_um) .OR.  &amp;</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;          l_ukca_set_trace_gases) .OR. l_ukca_prescribech4)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        <span class="keywordflow">IF</span> (l_ukca_prescribech4 .AND. (ch4mmr == rmdi)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;          cmessage = <span class="stringliteral">&#39;Missing value for ch4_mix_ratio&#39;</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;          error_code = 1</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;          <span class="keyword">CALL </span><a class="code" href="namespaceumprintmgr.xhtml#aae44897e556705dbf5e945a26538be9a">umprint</a>( &amp;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;              <span class="stringliteral">&#39;Set value in UMUI panel: atmos_Science_Section_LW_Meth&#39;</span>, &amp;</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;              src=<span class="stringliteral">&#39;atmos_physics1&#39;</span>)</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;          <span class="keyword">CALL </span><a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a>(<span class="stringliteral">&#39;Atmos_Physics1&#39;</span>,error_code,cmessage)</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        <span class="keyword">CALL </span>ukca_set_trace_gas_mixratio(                               &amp;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;              ch4mmr, co2_mmr, n2ommr, o2mmr,                           &amp;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;              c11mmr, c12mmr, c113mmr, c114mmr,                         &amp;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;              hcfc22mmr, hfc125mmr, hfc134ammr)</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="comment">!     Set number of cloud droplets to be used for the 1st indirect effect</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      <span class="keywordflow">IF</span> (l_consistent_cdnc) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="comment">!       Use the n_drop_pot array from microphysics in radiation</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        l_use_ndrop = .true.</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;      <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (l_ukca_aie1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="comment">!       Use the UKCA cdnc array in radiation</span></div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        n_drop_pot = ukca_cdnc</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        l_use_ndrop = .true.</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="keywordflow">If</span> (l_radiation) <span class="keywordflow">then</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment">! DEPENDS ON: rad_ctl</span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;       <span class="keyword">CALL </span><a class="code" href="rad__ctl_8f90.xhtml#aa6d43f369c6c2f85655ea8fc49f0132e" title="Interface to Atmospheric Physics radiation code. ">rad_ctl</a> (                                                   &amp;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="comment">! Parallel variables</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;     &amp;  halo_i, halo_j, offx, offy, global_row_length, global_rows      &amp;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;     &amp;, gc_proc_row_group, gc_proc_col_group, at_extremity              &amp;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;     &amp;, n_proc, n_procx, n_procy                                        &amp;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;     &amp;, neighbour, g_rows, g_row_length, <a class="code" href="namespaceum__parcore.xhtml#aa2c9f33748c85a26e676730601ad75d9" title="Note: These vars were formally part of parvars, but do not &#39;switch&#39; with decomposition, and hence were inappropriately homed there, and also cause circular dependencies when used from very basic routines. ">mype</a>                           &amp;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;     &amp;, global_cloud_top                                                &amp;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="comment">! model dimensions.</span></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;     &amp;, row_length, rows, n_rows                                        &amp;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;     &amp;, model_levels, wet_levels, bl_levels                             &amp;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;     &amp;, ozone_levels, cloud_levels, n_cca_levels                        &amp;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;     &amp;, ntiles, land_points, nice_use, dust_dim1, dust_dim2             &amp;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;     &amp;, biogenic_dim1                                                   &amp;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;     &amp;, biogenic_dim2, sulp_dim1, sulp_dim2, soot_dim1, soot_dim2       &amp;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;     &amp;, bmass_dim1, bmass_dim2, salt_dim1, salt_dim2, salt_dim3         &amp;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;     &amp;, co2_dim_len, co2_dim_row, co2_dim_lev, arcl_dim1, arcl_dim2     &amp;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;     &amp;, n_arcl_species, n_arcl_compnts, i_arcl_compnts                  &amp;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;     &amp;, ocff_dim1, ocff_dim2, nitrate_dim1, nitrate_dim2                &amp;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;     &amp;, ukca_dim1, ukca_dim2, ukca_radaer%n_mode, ukca_radaer%n_cpnt    &amp;</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="comment">! Model switches</span></div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;     &amp;, model_domain                                                    &amp;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;     &amp;, l_rad_step,l_rad_step_diag, l_rad_step_prog                     &amp;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;     &amp;, l_cal360                                                        &amp;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;     &amp;, l_emcorr                                                        &amp;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      , ltimer, l_snow_albedo, l_mcr_qcf2, l_mcr_qrain, l_mcr_qgraup    &amp;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;     &amp;, l_pc2, l_mixing_ratio                                           &amp;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;     &amp;, l_murk_rad                                                      &amp;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;     &amp;, l_co2_interactive                                               &amp;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;     &amp;, l_ukca                                                          &amp;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;     &amp;, l_use_arcl                                                      &amp;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;     &amp;, l_dust, <a class="code" href="namespacerun__aerosol__mod.xhtml#a2a0e2fefafaaa254aac4cf8cd4a291e1" title="Control logicals for Classic aerosol options ">l_sulpc_so2</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#a49e39d25a38244027b312e0298566110" title="Soot scheme. ">l_soot</a>, <a class="code" href="namespacerun__aerosol__mod.xhtml#ab289e7ad790cc1441c12d9265336b626" title="Biomass scheme. ">l_biomass</a>, l_ocff, l_nitrate       &amp;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      , l_cosp_call, can_rad_mod                                        &amp;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="comment">! model Parameters</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;     &amp;, min_trop_level, max_trop_level                                  &amp;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;     &amp;, ntot_land, ntot_sea                                             &amp;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="comment">! in coordinate information</span></div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;     &amp;, rho                                                             &amp;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;     &amp;, delta_lambda, delta_phi                                         &amp;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;     &amp;, lat_rot_np, long_rot_np                                         &amp;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;     &amp;, trindx                                                          &amp;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="comment">! in time stepping information.</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;     &amp;, timestep, radiation_timestep                                    &amp;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;     &amp;, radiation_tstep_diag, radiation_tstep_prog                      &amp;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;     &amp;, val_year, val_day_number, val_hour, val_minute                  &amp;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;     &amp;, val_second, timestep_number                                     &amp;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;     &amp;,         previous_time                                           &amp;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="comment">! diagnostic info</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;     &amp;     ,                                                            &amp;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="preprocessor"></span>     &amp; stashwork1,                                                      &amp;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;     &amp; stashwork2                                                       &amp;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment">! SCM diagnostics switches (dummy in full UM)</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;     &amp;, nscmdpkgs, l_scmdiags                                           &amp;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="comment">! in data fields.</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;     &amp;, p_star                                                          &amp;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;     &amp;, p_layer_boundaries, p_layer_centres                             &amp;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;     &amp;, p, <a class="code" href="varcld_8h.xhtml#acd7a57e90bb1e737ecae71f1c1830ad6">p_theta_levels</a>(tdims_s%i_start,tdims_s%j_start,1)            &amp;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;     &amp;, exner_rho_levels                                                &amp;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;     &amp;, exner_theta_levels(tdims_s%i_start,tdims_s%j_start,1)           &amp;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;     &amp;, land_sea_mask, fland,land0p5                                    &amp;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      , t_surf, tstar_sea, tstar_sice_cat, area_cloud_fraction          &amp;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;     &amp;, dust_div1(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;     &amp;, dust_div2(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;     &amp;, dust_div3(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;     &amp;, dust_div4(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;     &amp;, dust_div5(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;     &amp;, dust_div6(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;     &amp;, biogenic, so4_aitken(tdims_s%i_start,tdims_s%j_start,1)         &amp;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;     &amp;, so4_accu(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;     &amp;, so4_diss(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;     &amp;, soot_new(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;     &amp;, soot_agd(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;     &amp;, soot_cld(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;     &amp;, bmass_new(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;     &amp;, bmass_agd(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;     &amp;, bmass_cld(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;     &amp;, ocff_new(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;     &amp;, ocff_agd(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;     &amp;, ocff_cld(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;     &amp;, nitr_acc(tdims_s%i_start,tdims_s%j_start,1)                     &amp;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;     &amp;, nitr_diss(tdims_s%i_start,tdims_s%j_start,1)                    &amp;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;     &amp;, aerosol(1:row_length, 1:rows, 1:model_levels), arcl, ukca_radaer&amp;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      , sea_salt_film, sea_salt_jet, ws_10m_sea, co2_3d                 &amp;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      , frac_control, n_drop_pot                                        &amp;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment">! chemical greenhouse gas fields</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;     &amp;, ngrgas, grgas_field                                             &amp;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment">! ancillary fields and fields needed to be kept from timestep to</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="comment">! timestep</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;     &amp;, snow_depth, snow_depth_sea_cat, ice_fract, ice_fract_cat        &amp;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      , ice_thick_cat, chloro_sea, rgrain, soot                         &amp;</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;     &amp;, cca, ccb, cct, cclwp, ccw, lcbase                               &amp;</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="comment">! chemical ozone; replaces climatological ozone</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;     &amp;, grgas_field(:,:,1:ozone_levels,p_o3)                            &amp;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;     &amp;, sw_incs, lw_incs, dirpar_local                                  &amp;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;     &amp;, o3_trop_level, o3_trop_height                                   &amp;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;      , t_trop_level, t_trop_height, zh, <a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>, albsoil, albobs_sw &amp;      , albobs_vis, albobs_nir, lai, snow_tile, tile_frac, tstar_tile   &amp;      , z0_tile, dolr_rts, lw_down, sw_tile_rts                         &amp;     &amp;, land_alb,sice_alb                                               &amp;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;     &amp;, es_space_interp, rad_mask                                       &amp;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="comment">! in/out</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="comment">! chemical water replaces hydrological water</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;     &amp;, t_n, grgas_field(:,:,1:wet_levels,p_h2os)                       &amp;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;     &amp;, qcl_n, qcf_n, cf_n, cfl_n, cff_n                                &amp;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;     &amp;, qcf2_n, qrain_n, qgraup_n                                       &amp;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;     &amp;, theta_inc, q_inc, qcl_inc, cf_inc, cfl_inc                      &amp;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      , sum_eng_fluxes, cos_zenith_angle                                &amp;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="comment">! out.</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;     &amp;, photosynth_act_rad, surf_radflux, rad_hr, dolr, sw_tile         &amp;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="comment">! COSP arguments</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      , cosp_gbx                                                        &amp;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="comment">! error information</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;     &amp;, error_code  )</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="comment">! Check error condition</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        <span class="keywordflow">IF</span> (error_code &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;          <span class="keyword">CALL </span><a class="code" href="interfaceereport__mod_1_1ereport.xhtml">ereport</a>(routinename, error_code,                         &amp;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            <span class="stringliteral">&quot;Error on return from radiation code.&quot;</span>)</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        photosynth_act_rad = 0.0</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        surf_radflux = 0.0</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        rad_hr = 0.0</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        dolr = 0.0</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        sw_tile = 0.0</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Radiation (AP1R)&#39;</span>,6)</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="comment">! DEPENDS ON: close_cloud_gen</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      <span class="keyword">CALL </span>close_cloud_gen</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;      <span class="keyword">DEALLOCATE</span>(grgas_field)</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment">!     Call to COSP</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;      <span class="keywordflow">IF</span> (l_cosp_call) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;       <span class="keyword">CALL </span>cosp_main(ltimer,model_domain,at_extremity,row_length,rows, &amp;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                   n_rows,model_levels,cosp_cfg,cosp_gbx,               &amp;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="preprocessor"></span>                   stashwork2)</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;        <span class="keyword">CALL </span>free_cosp_gridbox(cosp_gbx)</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="comment">! Set dirpar_inc dependent prognostic for output to D1 array:</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="comment">! Never use prognostic dirpar</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="comment">! keeping code in case someone wants to test it in future</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;      l_use_dirpar=.false.</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                      <span class="keywordflow">IF</span> (l_use_dirpar) <span class="keywordflow">THEN</span>             <span class="keywordflow">DO</span> j=1, rows</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;           <span class="keywordflow">DO</span> i=1, row_length</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;              dirpar_inc(i,j)=dirpar_local(i,j)</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="keywordflow">           ENDDO</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="keywordflow">         ENDDO</span><span class="keywordflow">       ENDIF</span>     </div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="comment">! ! Set Coastal tiling dependent prognostics for output to D1 array:</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="comment">!       IF(L_CTILE)THEN</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <span class="keywordflow">DO</span> j = 1, rows</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;          <span class="keywordflow">DO</span> i = 1, row_length</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;            land_alb_ctile(i,j)=land_alb(i,j)</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;            sice_alb_ctile(i,j)=sice_alb(i,j)</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="keywordflow">          ENDDO</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="keywordflow">        ENDDO</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      <span class="keywordflow">If</span> (error_code  ==  0) <span class="keywordflow">Then</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="comment">! Convert temperature held in t_n to potential temperature.</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="comment">! Convert increment after call to gravity wave drag, to allow for</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="comment">! inclusion of dissipative heating term.</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;        <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> =             1, tdims%k_end</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;          <span class="keywordflow">Do</span> j = tdims%j_start, tdims%j_end</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;            <span class="keywordflow">Do</span> i = tdims%i_start, tdims%i_end</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;              t_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = theta(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="keywordflow">            End Do</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;<span class="keywordflow">      End If</span> <span class="comment">! on error code equal to zero</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;<span class="comment">! ! Section CNV.2 Energy correction code</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Conv Eng Corr&#39;</span>,5)</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <span class="keywordflow">If</span> (l_emcorr .and. error_code  ==  0) <span class="keywordflow">Then</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="comment">! Add convective + large scale, rain and snow, at the surface to the</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="comment">! diabatic heating for use in the energy correction</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="comment">! procedure.</span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="comment">! Scale variables by conversion factor so that only one call is required</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;        lclf = lc + lf</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;            tot_precip_scaled(i,j) = ls_rain(i,j) * lc +                &amp;</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;     &amp;                               ls_snow(i,j) * lclf</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="comment">! DEPENDS ON: flux_diag</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        <span class="keyword">CALL </span><a class="code" href="flux__diag-fldiag1a_8f90.xhtml#aab4a447d92bc2e0575a42e41350d169c" title="LL SUBROUTINE FLUX_DIAG!&gt;LL. ">flux_diag</a>(tot_precip_scaled, xx_cos_theta_latitude,        &amp;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                       row_length, rows ,offx, offy, 1.0,               &amp;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                       sum_eng_fluxes,timestep)</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="comment">! moist fluxes</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;            tot_precip_scaled(i,j) = -ls_rain(i,j) -ls_snow(i,j)</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">! DEPENDS ON: flux_diag</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        <span class="keyword">CALL </span><a class="code" href="flux__diag-fldiag1a_8f90.xhtml#aab4a447d92bc2e0575a42e41350d169c" title="LL SUBROUTINE FLUX_DIAG!&gt;LL. ">flux_diag</a>(tot_precip_scaled, xx_cos_theta_latitude,        &amp;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                       row_length, rows ,offx, offy, 1.0,               &amp;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                       sum_moist_flux,timestep)</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="keywordflow">      End If</span>   <span class="comment">! L_emcorr</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;      <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 Conv Eng Corr&#39;</span>,6)</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="comment">! ! Section GWD.1 Call gravity wave drag</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="comment">! l_gwd      = orographic GWD</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="comment">! l_use_ussp = middle atmosphere non-orographic GWD scheme</span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="comment">!      If ( l_gwd .or. l_use_ussp ) Then</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        <span class="keywordflow">If</span> (error_code  ==  0 ) <span class="keywordflow">Then</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;          <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 G-wave drag&#39;</span>,5)</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;<span class="comment">! reset p at layer boundaries for spectral GWD code</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;          <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, model_levels - 1</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;            <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;              <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                p_layer_boundaries(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = <a class="code" href="varcld_8h.xhtml#acd7a57e90bb1e737ecae71f1c1830ad6">p_theta_levels</a>(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="keywordflow">              End Do</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="keywordflow">            End Do</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;          <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;            <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;              p_layer_boundaries(i,j,model_levels) = 0.0</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="keywordflow">            End Do</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="keyword">Call </span>ni_gwd_ctl(                                                &amp;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;     &amp;                   halo_i, halo_j, offx, offy                     &amp;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;     &amp;,  global_row_length,n_proc, n_procy, gc_proc_row_group           &amp;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;     &amp;,                  at_extremity, neighbour                        &amp;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">! model dimensions.</span></div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;     &amp;,                  row_length, rows, n_rows, land_points          &amp;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;     &amp;,                  model_levels                                   &amp;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="comment">! Model switches</span></div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;     &amp;,                  model_domain                                   &amp;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="comment">! trig arrays</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;     &amp;,                  sin_theta_longitude, sin_theta_latitude        &amp;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment">! in coordinate information</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;     &amp;,                  delta_lambda,delta_phi,true_latitude           &amp;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;     &amp;,                  exner_theta_levels                             &amp;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment">! in time stepping information.</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;     &amp;,                  timestep, timestep_number                      &amp;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment">! diagnostic info</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;     &amp;     ,                                                            &amp;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="preprocessor">#include &quot;argsts.h&quot;</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="preprocessor"></span>     &amp; stashwork6                                                       &amp;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment">! SCM diagnostics (dummy in full UM)</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;     &amp;,                  nscmdpkgs, l_scmdiags                          &amp;</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="comment">! in data fields.</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;     &amp;,                  u, v, land_sea_mask                            &amp;</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;     &amp;,                  p_layer_boundaries                             &amp;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;     &amp;,                  rho, t_n, sd_orog_land                         &amp;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;     &amp;,                  orog_grad_xx_land, orog_grad_xy_land           &amp;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;     &amp;,                  orog_grad_yy_land, <a class="code" href="arglndm_8h.xhtml#af7438493bfc0d4d5c4b91a82131797fe">land_index</a>                  &amp;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="comment">! in/out</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;     &amp;,                  u_inc, v_inc,theta_inc                         &amp;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="comment">! error information</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;     &amp;, error_code  )</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;          <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 G-wave drag&#39;</span>,6)</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="keywordflow">        End If</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <span class="keywordflow">IF</span> (error_code  ==  0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="comment">! Now convert temperature increment to theta increment</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;        <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> =             1, tdims%k_end</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;          <span class="keywordflow">DO</span> j = tdims%j_start, tdims%j_end</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;            <span class="keywordflow">DO</span> i = tdims%i_start, tdims%i_end</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;              theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) /                     &amp;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                                 exner_theta_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;<span class="keywordflow">        END DO</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="keyword">      END </span>if<span class="comment">! on error code equal to zero</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="comment">! Tracer Source and Boundary updating where applicable</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="comment">! Aerosol</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      <span class="keywordflow">If</span> ( l_murk_source ) <span class="keywordflow">Then</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;        <span class="keywordflow">Do</span> level = 1, model_levels</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;          <span class="keyword">Call </span>trsrce(                                                  &amp;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;     &amp;       rows, row_length, offx, offy                             &amp;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;     &amp;,      halo_i, halo_j, model_levels, wet_levels                   &amp;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;     &amp;, 0, 0                                                            &amp;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;     &amp;,      theta, q_n, qcl_n, qcf_n, exner_rho_levels, rho            &amp;</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;     &amp;,      aerosol(:,:,level), aerosol_em(:,:,level )                &amp;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;     &amp;,      level, timestep, val_hour, val_minute, amp                 &amp;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;     &amp;)</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      <span class="keywordflow">If</span> ( l_murk_bdry ) <span class="keywordflow">Then</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="comment">! DEPENDS ON: trbdry</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;        <span class="keyword">Call </span><a class="code" href="trbdry-trbdry2a_8f90.xhtml#a419228d2edb80f4d4871666e9976e81c" title="*LL SUBROUTINE TRBDRY!&gt;LL ">trbdry</a>(                                                    &amp;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;     &amp;       row_length, rows, n_rows, model_levels                     &amp;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;     &amp;,      offx, offy, at_extremity                                 &amp;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;     &amp;,      p, u, v                                                    &amp;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;     &amp;,      aerosol, timestep                                          &amp;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;     &amp;)</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;      <span class="keywordflow">If</span> ( l_murk ) <span class="keywordflow">Then</span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;        <span class="keywordflow">If</span> (.NOT. l_murk_bdry) <span class="keywordflow">Then</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;          <span class="comment">! Set the external halos if not specified by the</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;          <span class="comment">! formula for UK mes.</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="comment">! DEPENDS ON: swap_bounds</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;          <span class="keyword">Call </span><a class="code" href="swap__bounds-swpbnd2a_8f90.xhtml#aa0269e41062e156c437596022ea9ccd0" title="Portable GCOM based version SWAP_BOUNDS. ">swap_bounds</a>(                                             &amp;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;     &amp;         aerosol, row_length, rows,                               &amp;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;     &amp;         model_levels, offx, offy, fld_type_p, .false.)</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="keywordflow">        End If</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="comment">! Section METHOX Call methane oxidation</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      <span class="keywordflow">If</span> (l_use_methox) <span class="keywordflow">Then</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        -        <span class="comment">! check moisture conservation for methane oxidation</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        -        <span class="keywordflow">IF</span> (l_check_moist_inc .AND. model_domain == mt_global) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;          <span class="keyword">ALLOCATE</span> (q_methane(row_length, rows, model_levels) )</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;          <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;              <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                q_methane(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   <span class="comment">! copy before</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="keywordflow">        END IF</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        <span class="keywordflow">If</span> (error_code == 0) <span class="keywordflow">Then</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;          <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 NI_methox&#39;</span>,5)</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="comment">!    call methane oxidation directly (no interface routine needed)</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;<span class="comment">! DEPENDS ON: ni_methox</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;          <span class="keyword">call </span><a class="code" href="ni__methox_8f90.xhtml#ad867e6c822846c3b1dc4a6238930f5d9" title="*****************************COPYRIGHT****************************** *****************************COP...">ni_methox</a>(                                               &amp;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="comment">! Parallel variables</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;     &amp;  halo_i, halo_j                                                  &amp;</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="comment">! model dimensions.</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;     &amp;, row_length, rows                                                &amp;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;     &amp;, model_levels, wet_levels                                        &amp;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="comment">! model levels</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;     &amp;, eta_theta_levels                                                &amp;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;<span class="comment">! in time stepping information.</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;     &amp;, timestep                                                        &amp;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="comment">! in/out</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;     &amp;,  q_n,q_inc                                                      &amp;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="comment">! error information</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;     &amp;, error_code  )</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="comment">! DEPENDS ON: timer</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;          <span class="keywordflow">If</span> (ltimer) <span class="keyword">Call </span><a class="code" href="timer-timer1a_8f90.xhtml#a9ec0272078965f809aa1a1cbc6a05ea4">timer</a> (<span class="stringliteral">&#39;AP1 NI_methox&#39;</span>,6)</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="keywordflow">        End If</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        -        <span class="comment">! check moisture conservation for methane oxidation</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        -        <span class="keywordflow">IF</span> (l_check_moist_inc .AND. model_domain == mt_global) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;          <span class="comment">! no diagnostic value of source/sink</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;          <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;            <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;              ep4(i,j) = 0.0</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;          rtimestep = 1.0/timestep</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;          <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;            <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;              <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;                <span class="comment">! increment from methane oxidation to q</span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                dqt(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = (q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) - q_methane(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>))*rtimestep</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="keywordflow">          END DO</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;          <span class="keywordflow">IF</span> (l_mixing_ratio) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;            <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;              <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                  rho_con(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = unscaled_dry_rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)*r_rho_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) &amp;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                                                    *r_rho_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;          <span class="keywordflow">ELSE</span>   <span class="comment">! want wet density</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;            <span class="keywordflow">DO</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>=1,model_levels</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;              <span class="keywordflow">DO</span> j=1,rows</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                <span class="keywordflow">DO</span> i=1,row_length</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                  rho_con(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = rho(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="keywordflow">              END DO</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="keywordflow">          END IF</span></div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;          scheme_name = <span class="stringliteral">&#39;Methane oxidation&#39;</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;          <span class="keyword">CALL </span>check_dmoist_inc(row_length, rows, model_levels,             &amp;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                            delta_lambda,delta_phi,timestep,                &amp;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                            p_layer_boundaries,rho_con,                     &amp;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                            dqt,                                            &amp;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                            ep4, scheme_name,                               &amp;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                            ep1, ep2, ep3)</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;          <span class="keyword">DEALLOCATE</span> (q_methane) </div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="keywordflow">        END IF</span>  <span class="comment">! moisture check</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;<span class="keywordflow">      End If</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="comment">! ! Copy increment arrays into star locations</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;<span class="comment">! In the LAM set physics increments on boundary to zero.</span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      <span class="keywordflow">If</span> (model_domain == mt_lam .and. l_lbc_old) <span class="keywordflow">Then</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;        l_zero_boundaries=.true.</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        l_zero_halos=.false.</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;     &amp;   row_length,rows,0,0,model_levels,fld_type_p,theta_inc,         &amp;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,q_inc,               &amp;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,qcl_inc,             &amp;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,qcf_inc,             &amp;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="keywordflow">If</span> (l_mcr_qcf2)                                                 &amp;</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;                        <span class="comment">! prognostic second cloud ice in use</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;     &amp;   <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                  &amp;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;     &amp;    row_length,rows,0,0,wet_levels,fld_type_p,qcf2_inc,           &amp;</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;     &amp;    1, at_extremity,                                              &amp;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;     &amp;    l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        <span class="keywordflow">If</span> (l_mcr_qrain)                                                &amp;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                         <span class="comment">! prognostic rain in use</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;     &amp;   <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                  &amp;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;     &amp;    row_length,rows,0,0,wet_levels,fld_type_p,qrain_inc,          &amp;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;     &amp;    1, at_extremity,                                              &amp;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;     &amp;    l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        <span class="keywordflow">If</span> (l_mcr_qgraup)                                               &amp;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                          <span class="comment">! prognostic graupel in use</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;     &amp;   <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                  &amp;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;     &amp;    row_length,rows,0,0,wet_levels,fld_type_p,qgraup_inc,         &amp;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;     &amp;    1, at_extremity,                                              &amp;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;     &amp;    l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,cf_inc,              &amp;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,cfl_inc,             &amp;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;     &amp;   row_length,rows,0,0,wet_levels,fld_type_p,cff_inc,             &amp;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;     &amp;   row_length,n_rows,offx,offy,model_levels,fld_type_v,v_inc,   &amp;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;<span class="comment">! DEPENDS ON: zero_lateral_boundaries</span></div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        <span class="keyword">CALL </span><a class="code" href="zero__lateral__boundaries-setlbc1a_8f90.xhtml#a1b81ce1a41233c40aea95ff41b0f55c1" title="Fills the LBC region of a LAM model with zeros. ">zero_lateral_boundaries</a>(                                   &amp;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;     &amp;   row_length,rows,offx,offy,model_levels,fld_type_u,u_inc,     &amp;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;     &amp;   1, at_extremity,                                               &amp;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;     &amp;   l_zero_boundaries,l_zero_halos)</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="keywordflow">      End If</span>  <span class="comment">!  model_domain == mt_LAM .and. L_lbc_old</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      <span class="keywordflow">If</span> (l_pc2) <span class="keywordflow">then</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      <span class="keyword">Allocate</span>( t_inc_diag(row_length,rows,model_levels) )</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="keyword">Allocate</span>( q_inc_diag(row_length,rows,wet_levels) )</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      <span class="keyword">Allocate</span>( qcl_inc_diag(row_length,rows,wet_levels) )</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <span class="keyword">Allocate</span>( qcf_inc_diag(row_length,rows,wet_levels) )</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      <span class="keyword">Allocate</span>( cf_inc_diag(row_length,rows,wet_levels) )</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keyword">Allocate</span>( cfl_inc_diag(row_length,rows,wet_levels) )</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keyword">Allocate</span>( cff_inc_diag(row_length,rows,wet_levels) )</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment">! Now call a consistency check for the moisture and cloud fields.</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment">! The catch is that _inc variables hold the increments and not the</span></div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="comment">! full variables yet, so temporarily form them as _inc, check them,</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="comment">! then rewrite them as increments.</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment">! 1. Create full variables (not increments). Only need to do this</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment">!    on wet_levels for theta_inc (theta_inc and T_n hold potential</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">!    temperature) since the checking is only over wet levels.</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;            theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = (t_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   + theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>))        &amp;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;     &amp;                         * exner_theta_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="comment">! theta_inc now holds temperature, t_n still holds potential temp</span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;            q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)     = q_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   + q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;            qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = qcl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;            qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = qcf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;            cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)    = cf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)  + cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;            cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = cfl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;            cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = cff_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) + cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;            t_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;            q_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;            qcl_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;            qcf_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;            cf_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)  = cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;            cfl_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;            cff_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;<span class="comment">! 2. Call the checking routine (needs to use temperature, not</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;<span class="comment">!    potential temperature)</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="comment">! DEPENDS ON: pc2_checks</span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      <span class="keyword">call </span><a class="code" href="pc2__checks_8f90.xhtml#a8911867cba750b966170c0bc73e1f0e7" title="Subroutine Interface: ">pc2_checks</a>(p_layer_centres(1,1,1)                            &amp;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;                     ,theta_inc, cf_inc, cfl_inc                        &amp;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                     ,cff_inc, q_inc, qcl_inc, qcf_inc                  &amp;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                     ,l_mixing_ratio)</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment">! Now form the increment diagnostics in t_inc_diag etc.</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;            t_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) - t_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;            q_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)     - q_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;            qcl_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - qcl_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;            qcf_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - qcf_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;            cf_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)  = cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)    - cf_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            cfl_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - cfl_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;            cff_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - cff_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="keywordflow">          End Do</span> <span class="comment">! i</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="keywordflow">        End Do</span> <span class="comment">! j</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="keywordflow">      End Do</span> <span class="comment">! k</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment">! 3. Update fields to produce the net increments which are written to</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment">!    the _star variables. Note that theta_inc</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment">!    currently holds the full temperature value up to wet_levels, and</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment">!    the increment in potential temp from there to model_levels</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = wet_levels+1, model_levels</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;            theta_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;            t_inc_diag(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = 0.0<span class="keywordflow">          End Do</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="preprocessor">#if defined(SCMA)</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment">!     SCM PC2 Diagnostics Package</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      <span class="keywordflow">If</span> (l_scmdiags(scmdiag_pc2)) <span class="keywordflow">Then</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment">!         Stash 4,141</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(t_inc_diag,                                    &amp;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;               <span class="stringliteral">&#39;dt_pc2ck&#39;</span>,<span class="stringliteral">&#39;Temperature inc PC2 checks in AP1&#39;</span>,<span class="stringliteral">&#39;K&#39;</span>,      &amp;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;               t_avg,d_all,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="comment">!         Stash 4,142</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(q_inc_diag,                                    &amp;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;               <span class="stringliteral">&#39;dq_pc2ck&#39;</span>,<span class="stringliteral">&#39;Specific humidity inc PC2 checks in AP1&#39;</span>,    &amp;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;               <span class="stringliteral">&#39;kg/kg&#39;</span>,                                                 &amp;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;               t_avg,d_wet,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment">!         Stash 4,143</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(qcl_inc_diag,                                  &amp;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;               <span class="stringliteral">&#39;dqcl_pc2ck&#39;</span>,<span class="stringliteral">&#39;QCL inc PC2 checks in AP1&#39;</span>,<span class="stringliteral">&#39;kg/kg&#39;</span>,        &amp;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;               t_avg,d_wet,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="comment">!         Stash 4,144</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(qcf_inc_diag,                                  &amp;</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;               <span class="stringliteral">&#39;dqcf_pc2ck&#39;</span>,<span class="stringliteral">&#39;QCF inc PC2 checks in AP1&#39;</span>,<span class="stringliteral">&#39;kg/kg&#39;</span>,        &amp;</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;               t_avg,d_wet,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment">!         Stash 4,152</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(cf_inc_diag,                                   &amp;</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;               <span class="stringliteral">&#39;dbcf_pc2ck&#39;</span>,<span class="stringliteral">&#39;Bulk cloud fraction inc PC2 checks in AP1&#39;</span>,&amp;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;               <span class="stringliteral">&#39;Fraction&#39;</span>,                                              &amp;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;               t_avg,d_wet,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="comment">!         Stash 4,153</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(cfl_inc_diag,                                  &amp;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;               <span class="stringliteral">&#39;dcfl_pc2ck&#39;</span>,                                            &amp;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;               <span class="stringliteral">&#39;Liquid cloud fraction inc PC2 checks in AP1&#39;</span>,<span class="stringliteral">&#39;Fraction&#39;</span>,&amp;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;               t_avg,d_wet,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="comment">!         Stash 4,154</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="comment">! DEPENDS ON: scmoutput</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;          <span class="keyword">Call </span><a class="code" href="scmoutput_8f90.xhtml#a1ebaa1ca3d36d0fc74ab3a09f13c6d78" title="Create a SCM output diagnostic. ">scmoutput</a>(cff_inc_diag,                                  &amp;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;               <span class="stringliteral">&#39;dcff_pc2ck&#39;</span>,                                            &amp;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;               <span class="stringliteral">&#39;Ice cloud fraction inc PC2 checks in AP1&#39;</span>,<span class="stringliteral">&#39;Fraction&#39;</span>,   &amp;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;               t_avg,d_wet,default_streams,<span class="stringliteral">&#39;&#39;</span>,routinename)</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;<span class="keywordflow">      End If</span> <span class="comment">! L_SCMDiags(SCMDiag_PC2)</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="comment">!                                                                          ! 4. Call diagnostic writing subroutine.                                   ! Not called for SCM.!                                                                          ! Check that checking diagnostics requested this timestep                  #if !defined(SCMA)      If (sf(0,4)) Then                                                              Call diagnostics_pc2checks(                                   &amp;</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;               &amp;                row_length, rows, model_levels          &amp;        &amp;,                      wet_levels                                 &amp;        &amp;,                      <a class="code" href="namespaceum__parcore.xhtml#aa2c9f33748c85a26e676730601ad75d9" title="Note: These vars were formally part of parvars, but do not &#39;switch&#39; with decomposition, and hence were inappropriately homed there, and also cause circular dependencies when used from very basic routines. ">mype</a>,timestep, at_extremity                &amp;        &amp;,                      t_inc_diag,q_inc_diag,qcl_inc_diag         &amp;        &amp;,                      qcf_inc_diag,cf_inc_diag,cfl_inc_diag      &amp;        &amp;,                      cff_inc_diag                               &amp;        &amp;,                                                                 &amp;   <span class="preprocessor">#include &quot;argsts.h&quot;                                                      &amp; STASHwork4                                                       &amp;        &amp;       )                                                                                                                                              End If   ! on error_code and sf(0,4)                                 #endif                                            !                                                                          ! 5. Deallocate fields                                                     !                                                                                Deallocate( T_inc_diag )                                                   Deallocate( q_inc_diag )                                                   Deallocate( qcl_inc_diag )                                                 Deallocate( qcf_inc_diag )                                                 Deallocate(  cf_inc_diag )                                                 Deallocate( cfl_inc_diag )                                                 Deallocate( cff_inc_diag )   !</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;<span class="preprocessor"></span><span class="comment">! 6. Update fields to produce the net increments which are written to</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;<span class="comment">!    the _star variables.</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;            theta_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)                        &amp;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;     &amp;                         /exner_theta_levels(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) - t_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="comment">! theta_star now holds the potential temperature increment</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;            q_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)     = q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)     - q_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;            qcl_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - qcl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;            qcf_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - qcf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;            cf_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)    = cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)    - cf_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;            cfl_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - cfl_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;            cff_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   = cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)   - cff_n(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;      <span class="keywordflow">Else</span>  <span class="comment">! L_pc2</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, model_levels</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;            theta_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = theta_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      <span class="keywordflow">Do</span> <a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a> = 1, wet_levels</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="keywordflow">Do</span> j = 1, rows</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;          <span class="keywordflow">Do</span> i = 1, row_length</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;            q_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = q_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;            qcl_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;            qcf_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = qcf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;            cf_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cf_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;            cfl_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cfl_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;            cff_star(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>) = cff_inc(i,j,<a class="code" href="arg__atm__fields_8h.xhtml#a746e8233330aed561ffa6fdbd8b8fea9">k</a>)</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="keywordflow">          End Do</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="keywordflow">        End Do</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;<span class="keywordflow">      End Do</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="keywordflow">      End If</span>  <span class="comment">! L_pc2</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="comment">! prognostic second cloud ice in use</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;      <span class="keywordflow">IF</span> (l_mcr_qcf2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;        qcf2_star(1:row_length, 1:rows, 1:wet_levels) =                      &amp;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;                                                   qcf2_inc(:,:,1:wet_levels)</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;<span class="comment">! prognostic rain in use</span></div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      <span class="keywordflow">IF</span> (l_mcr_qrain) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        qrain_star(1:row_length, 1:rows, 1:wet_levels) =                     &amp;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;                                                   qrain_inc(:,:,1:wet_levels)</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;<span class="comment">! prognostic graupel in use</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <span class="keywordflow">IF</span> (l_mcr_qgraup)<span class="keywordflow">THEN</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        qgraup_star(1:row_length, 1:rows, 1:wet_levels) =                    &amp;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;                                                  qgraup_inc(:,:,1:wet_levels)</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="keywordflow">      END IF</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      <span class="comment">! Deallocate additional microphysics variables</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      <span class="keyword">Deallocate</span> ( qcf2_inc )</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      <span class="keyword">Deallocate</span> ( qrain_inc )</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      <span class="keyword">Deallocate</span> ( qgraup_inc )</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      <span class="keyword">Deallocate</span> ( qcf2_n )</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;      <span class="keyword">Deallocate</span> ( qrain_n )</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      <span class="keyword">Deallocate</span> ( qgraup_n )</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="comment">! Deallocate arrays required for moisture conservation checking</span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      <span class="keywordflow">IF</span> (l_check_moist_inc .AND. model_domain == mt_global .AND.          &amp;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;           (l_rain .OR. l_use_methox)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        <span class="keyword">DEALLOCATE</span> (ep1)</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        <span class="keyword">DEALLOCATE</span> (ep2)</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;        <span class="keyword">DEALLOCATE</span> (ep3)</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;        <span class="keyword">DEALLOCATE</span> (ep4)</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="keyword">DEALLOCATE</span> (rho_con)</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;        <span class="keyword">DEALLOCATE</span> (dqt)</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;<span class="keywordflow">      END IF</span>    </div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="comment">! end of routine Atmos_physics1</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      <span class="keywordflow">IF</span> (lhook) <span class="keyword">CALL </span>dr_hook(<span class="stringliteral">&#39;ATMOS_PHYSICS1&#39;</span>,zhook_out,zhook_handle)</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="keyword">      END SUBROUTINE </span><a class="code" href="atmos__physics1_8f90.xhtml#ae8d55d89da6ed68f5f8d7e9eec99bc76" title="Interface to Atmos Physics parametrizations before S-L advection. ">atmos_physics1</a></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
